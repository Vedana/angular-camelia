/* Camelia (c) 2014 Vedana http://www.vedana.com
 License: Creative Commons - The licensor permits others to copy, distribute, display, and perform the work. In return, licenses may not use the work for commercial purposes -- unless they get the licensor's permission.
 Author: olivier.oeuillot@vedana.com */

!function(a,b,c){"use strict";var d=b.module("camelia.core",[]);d.factory("camelia.core",["$q","$rootScope","$log","$exceptionHandler","$injector",function(a,d,e,f,g){function h(a){return parseInt(a,10)}var i;return{Assert:function(a,b){if(!a){var c=Array.prototype.slice.call(arguments,2);c.unshift("Assert error:'",b||"?","':");var d=this.format(c),e=new Error(d);f(e)}},IsMSIE:function(){if(i!==c)return i;var a=navigator.userAgent.toLowerCase();return i=h((/msie (\d+)/.exec(a)||[])[1]),isNaN(i)&&(i=h((/trident\/.*; rv:(\d+)/.exec(a)||[])[1])),i},createElement:function(a,d,e){a.injector&&(a=a[0]);var f;9==a.nodeType?(f=a,a=f.body.parentNode):f=a.ownerDocument;for(var g,h=1;h<arguments.length;){d=arguments[h++],e=arguments[h++],this.Assert("string"==typeof d,"createElement","Invalid 'tagName' parameter ("+d+")"),this.Assert(e===c||"object"==typeof e,"createElement","Invalid properties parameter ("+e+")"),this.IsMSIE()<=6&&"input"==d.toLowerCase()&&e&&e.type&&e.name?(g=f.createElement('<input name="'+e.name+'" type="'+e.type+'">'),delete e.name,delete e.type):g=f.createElement(d);var i=null,j=null;if(e)for(var k in e){var l=e[k];switch(k.toLowerCase()){case"classname":case"styleclass":case"class":b.isArray(l)&&(l=l.join(" ")),g.className=l;break;case"textnode":i=l;break;case"innerhtml":j=l;break;case"role":case"aria-live":case"aria-atomic":case"aria-relevant":g.setAttribute(k,l);break;case"style":for(var m=l.split(";"),n=0;n<m.length;n++){var o=m[n].split(":"),p=this.trim(o[0]),q=this.trim(o[1]);g.style[p]=q}break;default:if(!k.indexOf("css")){g.style[k.substring(3,4).toLowerCase()+k.substring(4)]=l;break}switch(typeof l){case"function":case"object":g[k]=l;break;default:"$"!=k.charAt(0)?g.setAttribute(k,l):g[k.substring(1)]=l}}}a.appendChild?a.appendChild(g):a.append(g),null!==i&&g.appendChild(f.createTextNode(i)),null!==j&&(g.innerHTML=j),a=g}return b.element(g)},MixClasses:function(a,b,c,d){function e(a,b,d){for(var f=d;f<c.length;){var g=b+c[f++];a.push(g),e(a,g,f)}}for(var f=[],g=0;g<b.length;g++){var h=this.trim(b[g]);h&&(f.push(h),e(f,h,0))}a.injector&&(a=a[0]),d&&(f=f.concat(d));var i=f.join(" ");return a.className==i?!1:(a.className=i,!0)},BubbleEvent:function(a,c,d){a[0]&&(a=a[0]);var e=b.element,g=e.cache,h=e.expando;d=d||[];var i={type:c,currentTarget:a,relatedTarget:a,preventDefault:b.noop,stopPropagation:function(){this.stop=!0}};b.extend(i,d);for(;a&&1==a.nodeType&&!i.stop;a=a.parentNode){var j=a[h];if(j){var k=g[j];if(k){var l=k.events;if(l){var m=l[c];m&&b.forEach(m,function(b){if(!i.stop)try{if(b.call)return void b.call(a,i);b.handler&&b.handler.call(a,i)}catch(c){f(c)}})}}}}},format:function(a){var d=[],e=[],f=this,g=function(a){b.forEach(a,function(a){if(b.isElement(a))return void e.push(a.tagName+"."+a.className+"#"+a.id);if(null===a)return void e.push("null");if(a===c)return void e.push("undefined");if(b.isFunction(a))return void e.push("<<FUNC>>");if(f.isPromise(a))return void e.push("<<PROMISE>>");if(b.isObject(a)){for(var h=0;h<d.length;h++)if(d[h]===a)return void e.push("**cycle**");d.push(a),e.push("{");var i=!0;return b.forEach(a,function(a,b){i?i=!1:e.push(","),e.push(b+":"),g([a])}),void e.push("}")}e.push(String(a))})};return g(a),e.join(" ")},log:function(){var a=this.format(arguments);e.info(a)},trim:function(a){return a.trim()},CloneArray:function(a){return a?a.slice?a.slice():Array.prototype.slice.call(a):a},LoadProvider:function(a){var c=g,d=a.indexOf(":");if(d>0){var e=a.substring(0,d);a=a.substring(d+1),c=b.injector(["ng","camelia.core",e])}var f=c.get(a);return f},CloneAttributes:function(a){for(var b={},c=a[0].attributes,d=0;d<c.length;d++){var e=c[d];b[e.name]=e.value}return b},isPromise:function(a){return a&&b.isFunction(a.then)},toBoolean:function(a,b){if(a===!0)return a;if(a&&a.length){var c=a.toLowerCase();return!("f"==c||"0"==c||"false"==c||"no"==c||"n"==c||"[]"==c)}return!!b},appendTextNode:function(a,b,c){if(b)for(var d=0;;){var e=b.indexOf("\n",d);if(0>e){a.appendChild(document.createTextNode(b.substring(d)));break}e>d+1&&(c||e++,a.appendChild(document.createTextNode(b.substring(d,e)))),c&&a.appendChild(document.createElement("br")),d=e+1}},setFocus:function(a){try{a.focus()}catch(b){e.error(b)}},lang:function(a,b,d){var e=a.en[b];if(!e||!d)return e;for(var f=[],g=/\{\w+\}/g,h=0;;){var i=g.exec(e);if(!i)break;i.index&&f.push(e.substring(h,i.index));var j=d[i[0].substring(1,i[0].length-1)];f.push(j===c?"?":j),h=g.lastIndex}return h?(f.push(e.substring(h)),f.join("")):e},setAudioDescription:function(a,c,d){a[0]&&(a=a[0]),d||(d="main");for(var e=a.querySelectorAll(".cm_audioDescription"),f=0;f<e.length;f++){var g=e[f];if(g.type==d){var h=b.element(g).empty();return void(c&&h.text(c))}}c&&this.createElement(a,"SPAN",{className:"cm_audioDescription",$type:d,textnode:c})},getProto:function(a){return Object.getPrototypeOf&&Object.getPrototypeOf(a)||a.__proto__},inheritScope:function(a,b,c){var e=this.getProto(a),f=(b||d).$new(c!==!1);return Object.setPrototypeOf?(Object.setPrototypeOf(a,f),void Object.setPrototypeOf(f,e)):(a.__proto__=f,void(f.__proto__=e))},extend:function(a,b,c){return this.extendProto(a,b.prototype,c)},extendProto:function(a,c,d){var e=Object.create(c);return a.prototype=e,b.extend(e,d||{}),e.constructor=a,e.$super=c,a},on:function(a,b,c,e,f){a[0]&&(a=a[0]);var g=function(a){var b,e=this;return(f||d).$apply(function(){b=c.call(e,a)}),b};return a.addEventListener(b,g,e),function(){a.removeEventListener(b,g,e)}}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.core");c.factory("camelia.cmTypes",["camelia.core",function(a){var c=/cm_([a-z]*)_.*/i;return{GetCMType:function(a){if(!a||1!=a.nodeType)return null;var b=a.cm_type;if(b)return b;var d=a.id;if(!d)return null;var e=c.exec(d);return e?b=e[1]:null},SearchElements:function(a,b,c){for(;c;c=c.parentNode){var d=this.GetCMType(c);if(d&&(a[d]=c,d==b))break}return a},MixElementClasses:function(b,c,d){b[0]&&(b=b[0]);var e=[];b._ascending&&e.push("_ascending"),b._collapsed&&e.push("_collapsed"),b._cursor&&e.push("_cursor"),b._descending&&e.push("_descending"),b._filtreable&&e.push("_filtreable"),b._filtred&&e.push("_filtred"),b._focus&&e.push("_focus"),b._mouseDown&&e.push("_mouseDown"),b._openedPopup&&e.push("_openedPopup"),b._over&&e.push("_over"),b._selected&&e.push("_selected"),b._sortable&&e.push("_sortable"),a.MixClasses(b,c,e,d)},ForEachElement:function(a,c,d){for(var e=!b.isString(c),f=a.length,g=0;f>g;g++){var h=a[g],i=this.GetCMType(h);if(i){if(e){if(!c[i])continue}else if(i!=c)continue;if(d(h,i)===!1)return!1}}},GetPreviousVisibleType:function(a,b,c,d){if(a[0]&&(a=a[0]),a.offsetHeight==a.scrollHeight)return this.GetPreviousType(b,c,d);var e=a.scrollTop,f=a.clientHeight,g=null;return this.GetPreviousType(b,c,function(a,b){return g?void 0:d&&d(a,b)!==!0?!1:void(a.offsetTop+a.offsetHeight/2-e>f||(g=a))}),g},GetPreviousType:function(a,c,d){for(var e=!b.isString(c);a;a=a.previousSibling)if(1==a.nodeType){var f=this.GetCMType(a);if(f){if(e){if(!c[f])continue}else if(f!=c)continue;if(!d||d(a,f)===!0)return a}}return null},GetNextVisibleType:function(a,b,c,d){if(a[0]&&(a=a[0]),a.offsetHeight==a.scrollHeight)return this.GetNextType(b,c,d);var e=a.scrollTop,f=(a.clientHeight,null);return this.GetNextType(b,c,function(a,b){return f?void 0:d&&d(a,b)!==!0?!1:void(a.offsetTop+a.offsetHeight/2<e||(f=a))}),f},GetNextType:function(a,c,d){for(var e=!b.isString(c);a;a=a.nextSibling)if(1==a.nodeType){var f=this.GetCMType(a);if(f){if(e){if(!c[f])continue}else if(f!=c)continue;if(!d||d(a,f)===!0)return a}}return null},SwitchOnState:function(c,d,e,f){var g="_"+e;b.forEach(d,function(b,d){var f=d+"_"+e,h=c[f];if(h&&(!b||h!=b.id)){c[f]=null;var i=document.getElementById(h);i&&i[g]&&(i[g]=!1,a.BubbleEvent(i,"cm_update"))}}),b.forEach(d,function(b,d){if(b){var f=d+"_"+e;c[f]||(c[f]=b.id,b[g]||(b[g]=!0,a.BubbleEvent(b,"cm_update")))}}),f&&f(d)},SwitchOffState:function(c,d,e,f){var g="_"+e;b.forEach(d,function(b,d){var f=d+"_"+e,h=c[f];if(h&&(!b||h!=b.id)){c[f]=null;var i=document.getElementById(h);i&&i[g]&&(i[g]=!1,a.BubbleEvent(i,"cm_update"))}}),f&&f(d)},ClearState:function(c,d,e,f){var g="_"+e,h={};b.forEach(d,function(b,d){var f=d+"_"+e,i=c[f];if(i){c[f]=null;var j=document.getElementById(i);j&&j[g]&&(j[g]=!1,h[d]=j,a.BubbleEvent(j,"cm_update"))}}),f&&f(h)}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.cursorProvider",["camelia.core"]);c.factory("camelia.CursorProvider",["$rootScope","camelia.core",function(a,b){function c(a){b.inheritScope(this,a)}var d=b.getProto(a);return c.CURSOR_REQUESTED="cm:cursorRequested",c.CURSOR_CHANGED="cm:cursorChanged",b.extendProto(c,d,{getRow:function(){var a=this._rowCursor;return a},getColumn:function(){var a=this._columnCursor;return a},setCursor:function(a,d,e){if(b.log("SetCursor row=",a," column=",d?d.id:null," event=",e),this._rowCursor!==a||this._columnCursor!==d){var f=this._rowCursor,g=this._columnCursor;this._rowCursor=a,this._columnCursor=d,this.$emit(c.CURSOR_CHANGED,{row:a,column:d,oldRow:f,oldColumn:g,sourceEvent:e})}},requestCursor:function(a,b,c){this.setCursor(a,b,c)}}),c}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.dataModel",["camelia.core","ngResource"]);d.factory("camelia.DataModel",["$q","$rootScope","camelia.core","$injector","$resource",function(a,d,e,f,g){function h(){e.inheritScope(this);var a=this;this.$on("$destroy",function(){var b=a._watcherDeRegistration;b&&(a._watcherDeRegistration=c,b()),a._wrappedData=c,a._sorters=c,a._filters=c,a._dataScope=c,a._fetchProperties=c})}var i=e.getProto(d),j=e.getProto(g());return h.DATA_REQUESTING="c:dataRequesting",h.DATA_LOADING="c:dataLoading",h.DATA_LOADED="c:dataLoaded",h.DATA_MODEL_CHANGED_EVENT="cm:dataModelChanged",h.DATA_MODEL_UPDATED_EVENT="cm:dataModelUpdated",h.From=function(a){if(a instanceof h)return a;var c=a&&e.getProto(a);return c===j?f.invoke(["camelia.ResourceDataModel",function(b){return new b(a)}]):b.isArray(a)?f.invoke(["camelia.ArrayDataModel",function(b){return new b(a)}]):new h},e.extendProto(h,i,{_rowIndex:-1,installWatcher:function(a,b){var c=this;this._watcherDeRegistration=a.$watch(b,function(a){c.$broadcast(h.DATA_MODEL_CHANGED_EVENT,a)})},isRowAvailable:function(){return!1},getRowCount:function(){return-1},getRowData:function(){return c},getRowIndex:function(){return this._rowIndex},setRowIndex:function(a){var b=this._rowIndex;this._rowIndex=a,this.$parent==d&&(0>b&&a>=0&&this.$broadcast("cm:begin"),b>=0&&0>a&&this.$broadcast("cm:end"))},getWrappedData:function(){return this._wrappedData},setWrappedData:function(a){this._wrappedData=a},setFetchProperties:function(a){this._fetchProperties=a},setSorters:function(a){return this._sorters===a?!1:(this._sorters=a,!0)},setFilters:function(a){return this._filters===a?!1:(this._filters=a,!0)},setGrouped:function(a){this._grouped=!!a},setDataScope:function(a){this._dataScope=a},isFilterSupport:function(){return this.filterSupport},isSortSupport:function(){return this.sortSupport},isGroupSupport:function(){return this.groupSupport},toArray:function(){function b(g){for(;g&&(f.setRowIndex(d),g=f.isRowAvailable(),g!==!1);d++){if(e.isPromise(g))return g.then(b);var h=f.getRowData();c.push(h)}return f.setRowIndex(-1),a.when(c)}var c=[],d=0,f=this,g=c;try{g=b(!0)}catch(h){throw this.setRowIndex(-1),h}return g},$destroyChildren:function(){for(;this.$$childHead;)this.$$childHead.$destroy()}}),h}]),d.factory("camelia.ArrayDataModel",["camelia.DataModel","camelia.core",function(a,d){function e(b){a.prototype.constructor.call(this),this.setWrappedData(b)}return d.extend(e,a,{installWatcher:function(b,d){var e=this;this._watcherDeRegistration=b.$watchCollection(d,function(b,d){d!==c&&(e.setWrappedData(b),e.$broadcast(a.DATA_MODEL_UPDATED_EVENT,b))})},isRowAvailable:function(){var a=this.getRowIndex(),b=this.getRowCount();return a>=0&&(0>b||b>a)?!0:!1},getRowCount:function(){var a=this.getWrappedData();return a?a.length:0},getRowData:function(){if(!this.isRowAvailable())throw new Error("Invalid rowIndex ("+this.getRowIndex()+"/"+this.getRowCount()+")");var a=this.getWrappedData(),b=this.getRowIndex();return a[b]},toArray:function(){var c=this.getWrappedData();return b.isArray(c)?c:a.prototype.toArray.call(this)}}),e}]),d.factory("camelia.WrappedArrayDataModel",["camelia.ArrayDataModel","camelia.core",function(a,d){function e(b){a.call(this,c),this.$parent=b}var f="$$DELAGATE_PARENT$$",g="$$NO-DATA$$";return d.extend(e,a,{setSorters:function(a){this.$parent.setSorters(a),e.prototype.$super.setSorters.call(this,a)},setFilters:function(a){this.$parent.setFilters(a),e.prototype.$super.setFilters.call(this,a)},setGrouped:function(a){this.$parent.setGrouped(a),e.prototype.$super.setGrouped.call(this,a)},setDataScope:function(a){this.$parent.setDataScope(a),e.prototype.$super.setDataScope.call(this,a)},isFilterSupport:function(){return e.prototype.$super.isFilterSupport.call(this)||this.$parent.isFilterSupport()},isSortSupport:function(){return e.prototype.$super.isSortSupport.call(this)||this.$parent.isSortSupport()},isGroupSupport:function(){return e.prototype.$super.isGroupSupport.call(this)||this.$parent.isGroupSupport()},setFetchProperties:function(a){this.$parent.setFetchProperties(a),e.prototype.$super.setFetchProperties.call(this,a)},setRowIndex:function(a){this.$parent.setRowIndex(a),e.prototype.$super.setRowIndex.call(this,a)},getRowCount:function(){var a=this.getWrappedData();return a===c?-1:a===f?this.$parent.getRowCount():e.prototype.$super.getRowCount.call(this)},getRowData:function(){var a=this.getWrappedData();return a===f?this.$parent.getRowData():e.prototype.$super.getRowData.call(this)},isRowAvailable:function(){function a(a){return h=i.processParentArray(a),i.setWrappedData(h),e.prototype.$super.isRowAvailable.call(i)}function c(){var c=i.$parent.toArray();if(d.isPromise(c))return c.then(function(b){return a(b)});if(c||(c=[]),b.isArray(c))return a(c);throw new Error("Invalid toArray return !")}var h=this.getWrappedData();if(h===f)return this.$parent.isRowAvailable();if(h===g)return!1;if(h)return e.prototype.$super.isRowAvailable.call(this);var i=this,j=this.$parent.isRowAvailable();return j===!1?(this.setWrappedData(g),!1):d.isPromise(j)?j.then(function(a){return a===!1?(i.setWrappedData(g),!1):i.delegateToParent()?(i.setWrappedData(f),!0):c()}):this.delegateToParent()?(this.setWrappedData(f),!0):c()},delegateToParent:function(){return!1},processParentArray:function(a){return a}}),e}]),d.factory("camelia.SortedDataModel",["camelia.WrappedArrayDataModel","camelia.core",function(a,c){function d(b){a.call(this,b),this.sortSupport=!0}return c.extend(d,a,{processParentArray:function(a){if(!this._sorters)return a;var c=this._dataScope.$new(!0);try{b.forEach(this._sorters,function(b){c.$array=a;var d=b.expression;"orderBy:"==d&&b.column.$scope.fieldName&&(d+="'"+b.column.$scope.fieldName+"'");var e=c.$eval("$array | "+d);b.ascending||(e=e.reverse()),a=e})}finally{c.$destroy()}return a},delegateToParent:function(){return this.$parent.isSortSupport()||!this._sorters}}),d}]),d.factory("camelia.FiltredDataModel",["camelia.WrappedArrayDataModel","camelia.core",function(a,c){function d(b,c){a.call(this,b),this.filterSupport=!0,this._rowVarName=c}return c.extend(d,a,{processParentArray:function(a){var c=this._filters;if(!c||!c.length)return a;var d=c.length,e=this._rowVarName,f=[],g=this._dataScope.$new(!0),h=this;try{b.forEach(a,function(a){g.$row=a,e&&(g[e]=a);for(var b=0;d>b;b++){var i=c[b];if(i(g,h)===!1)return}f.push(a)})}finally{g.$destroy()}return f},delegateToParent:function(){return this.$parent.isFilterSupport()||!this._filters}}),d}]),d.factory("camelia.GroupedDataModel",["camelia.WrappedArrayDataModel","camelia.core",function(a,c){function d(b,c,d){a.call(this,b),this.groupSupport=!0,this._groupProvider=c,this._rowVarName=d,this._groups=[],this._groupCount=[],this._groupValues=[];var e=this;this.$on("$destroy",function(){e._groupProvider=c,e._rowVarName=d,e._groups=[],e._groupCount=[],e._groupValues=[]})}return c.extend(d,a,{getGroup:function(a,b){var c=this._groupProvider.$scope.valueRawExpression;a.$row=b,this._rowVarName&&(a[this._rowVarName]=b);var d=a.$eval(c);return d},getGroupCount:function(a){var b=this._groups.indexOf(a);return 0>b?-1:this._groupCount[b]},getGroupValues:function(a){var b=this._groups.indexOf(a);return 0>b?-1:this._groupValues[b]},processParentArray:function(a){if(!this._grouped)return a;var d=this._dataScope.$new(!0);try{var e=this,f=this._groups,g=this._groupCount,h=this._groupValues;b.forEach(a,function(a){var b=e.getGroup(d,a),c=f.indexOf(b);0>c&&(c=f.length,g[c]=0),f[c]=b,g[c]++,h[c]||(h[c]=[]),h[c].push(a)});var i=c.CloneArray(f),j=this._groupProvider.$scope.sorter;j&&(d.$array=i,i=d.$eval("$array | "+j));var k=[];return b.forEach(i,function(a){var b=f.indexOf(a);k=k.concat(h[b])}),k}finally{d.$destroy()}},delegateToParent:function(){return this.$parent.isGroupSupport()||!this._grouped}}),d}]),d.factory("camelia.ResourceDataModel",["$q","camelia.DataModel","camelia.core",function(a,d,e){function f(a,e){d.call(this),b.extend(this,b.extend(g,e||{})),this.$resource=a,this._sessionId=0,this._rowCount=-1,this._cache=[];var f=this;this.$on("begin",function(){f._sessionId=h++}),this.$on("end",function(){f._sessionId=-1;var a=f._requestPromise;a&&(f._requestPromise=c,a.cancel())}),this.$on("clearState",function(){f._cache=[],f._rowCount=-1})}var g={pageSize:20,offsetMod:10,offsetParameter:"offset",countParameter:"count",sorterParameter:"sorter",filterParameter:"filter",actionName:"query",keepCache:!1},h=0;return e.extend(f,d,{isRowAvailable:function(){this.needRowAvailable=!1;var e=this.getRowIndex(),f=this._cache;if(f[e]!==c)return!0;if(this._rowCount>=0&&e>=this._rowCount)return!1;this.sortSupport=!1,this.filterSupport=!1;var g=a.defer(),h=this._fetchProperties,i=e,j=h&&h.rows||0,k=Math.max(j,this.pageSize);if(this.offsetMod>0){i-=i%this.offsetMod;var l=e+k-1;l-=l%this.offsetMod,k=(Math.floor((l-i)/this.pageSize)+1)*this.pageSize}if(this._keepCache===!1)f=[],this._cache=f;else for(var m=i+k-1;m>i&&f[m]!==c;m--)k--;var n=this._sessionId,o=this.actionName,p={};if(p[this.offsetParameter]=i,p[this.countParameter]=k,this._sorters&&this.sorterParameter){var q=[];p[this.sorterParameter]=q,b.forEach(this._sorters,function(a){var b=a.expression||a.column.$scope.fieldName||a.column.$scope.id;a.ascending||(b+=":desc"),q.push(b)}),this.sortSupport=!0}var r=this._filters;if(r&&this.filterParameter){var s=[];p[this.filterParameter]=s,b.forEach(r,function(a){if(a.toJson){var b=a.toJson();b&&s.push(b)}}),this.filterSupport=!0}this._rowCount<0&&this.requestRowCountParameter&&(p[this.requestRowCountParameter]=!0);var t=this._requestPromise;t&&(this._requestPromise=c,t.cancel());var u=this,v=this.$resource[o].call(this.$resource,p,function(a){if(u._requestPromise=c,u._sessionId!=n)return g.reject("Session canceled");g.notify({type:d.DATA_LOADED});for(var b=0;b<a.length;b++)f[b+i]=a[b];a.length<k&&(a.length||!i)&&(u._rowCount=i+a.length),g.resolve(f[e]!==c)},function(a){return g.reject("Query error: "+a)});return this._requestPromise=v.$promise,this._requestPromise.then(null,null,function(){u._sessionId==n&&(console.log("progress ..."),g.notify({type:d.DATA_LOADING}))}),g.promise},setRowIndex:function(a){f.prototype.$super.setRowIndex.call(this,a),this.needRowAvailable=!0},getRowData:function(){this.needRowAvailable;var a=this.getRowIndex(),b=this._cache[a];return b},getRowCount:function(){return this._rowCount},setSorters:function(a){f.prototype.$super.setSorters.call(this,a),this._cache=[],this._rowCount=-1},setFilters:function(a){f.prototype.$super.setFilters.call(this,a),this._cache=[],this._rowCount=-1},setGrouped:function(a){f.prototype.$super.setGrouped.call(this,a),this._cache=[],this._rowCount=-1}}),f}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.key",[]);c.factory("camelia.Key",[function(){return{VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_SEMICOLON:59,VK_EQUALS:61,VK_CONTEXTMENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,KF_SHIFT:1,KF_CONTROL:2,KF_ALT:4,KF_META:8}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.pagerRegistry",["camelia.core"]);c.factory("camelia.PagerRegistry",["$log","$q","camelia.core",function(a,c){var d=b.element(document),e=d.controller("cmPagerRegistry");e||(e={promisesByTargetId:{}},d.data("$cmPagerRegistryController",e));var f=e.promisesByTargetId,g={TARGET_DECLARED:"cm:targetDeclared",RegisterWaitingFor:function(a,b){var d=f[b];if(d===!0)return c.when(target);d||(d=[],f[b]=d);var e=c.defer();d.push(e);var g=a.$on("$destroy",function(){var a=d.indexOf(e);return 0>a?void g():(d.splice(a,1),e.reject("Pager destroyed"),void g())});return e.promise},DeclareTarget:function(a){a[0]&&(a=a[0]);var c=a.id,d=f[c];f[c]=!0,d&&b.forEach(d,function(b){b.resolve(a)})}};return g}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.selectionProvider",["camelia.core"]);d.factory("camelia.SelectionProvider",["$rootScope","$injector","camelia.core",function(a,d,e){function f(a){e.inheritScope(this,a)}var g=e.getProto(a);return f.SELECTION_CHANGING_EVENT="cm:selectionChanging",f.SELECTION_CHANGED_EVENT="cm:selectionChanged",f.SELECTION_SET_EVENT="cm:selectionSet",f.From=function(a,e){var f=d.invoke(["camelia.ArraySelectionProvider",function(a){return a}]);return a===c?new f(e,[]):b.isArray(a)?new f(e,a):new f(e,[a])},e.extendProto(f,g,{_lock:!1,get:function(){return null},getFirstElement:function(){return null},set:function(a){if(a===c||b.isArray(a)||(a=arguments),!this._lock){var d=this;return this.run(function(){return d._processSet(a)})}return this._processSet(a)},_processSet:function(){return-1},add:function(a){if(b.isArray(a)||(a=arguments),!this._lock){var c=this;return this.run(function(){return c._processAdd(a)})}return this._processAdd(a)},_processAdd:function(){return-1},remove:function(a){if(b.isArray(a)||(a=arguments),!this._lock){var c=this;return this.run(function(){return c._processRemove(a)})}return this._processRemove(a)},_processRemove:function(){return-1},clear:function(){if(!this._lock){var a=this;return this.run(function(){return a._processClear()})}return this._processClear()},_processClear:function(){return-1},run:function(a){var b=this._lock;b||(this._lock=!0,this._startLock());var c;try{c=a()}finally{b||(this._lock=b,this._endLock())}return c},_startLock:function(){this.$broadcast("cm:startLock")},_endLock:function(){this.$broadcast("cm:endLock")},contains:function(){return!1},containsAll:function(){return!1},count:function(){return-1}}),f}]),d.factory("camelia.ArraySelectionProvider",["camelia.core","camelia.SelectionProvider",function(a,d){function e(a,b){d.prototype.constructor.call(this,a),this._array=b}function f(a,c,d,e,f){f&&f.length&&b.forEach(f,function(b){if(e){var f=e.indexOf(b);f>=0&&e.splice(f,1)}if(d){var g=d.indexOf(b);if(g>=0)return void d.splice(g,1)}a&&a.indexOf(b)<0&&(a.push(b),c&&c.indexOf(b)<0&&c.push(b))})}return e.prototype=Object.create(d.prototype),b.extend(e.prototype,{constructor:e,_array:[],get:function(){return this._array},getFirstElement:function(){var a=this.get();return a&&a.length?a[0]:c},_processList:function(b){var c=this._array;c||(c=[],this._array=c),this._targetArray||(this._targetArray=this._array?a.CloneArray(this._array):[],this._added=[],this._removed=[]);var d=this._added.length,e=this._removed.length;return b.call(this),this._added.length-d+(e-this._removed.length)},_processSet:function(b){return b===this._array?0:this._processList(function(){return f(this._removed,null,this._added,null,this._targetArray),b&&b.length?(this._targetArray=a.CloneArray(b),void f(this._added,null,this._removed,null,this._targetArray)):void(this._targetArray=[])})},_processAdd:function(a){return this._processList(function(){f(this._added,this._targetArray,this._removed,null,a)})},_processRemove:function(a){return this._processList(function(){f(this._removed,null,this._added,this._targetArray,a)})},_processClear:function(){return this._processList(function(){this._removed=a.CloneArray(this._array),this._added=[],this._targetArray=[]})},contains:function(a){var b=this._array;return b?b.indexOf(a)>=0:!1},containsAll:function(a){if(!b.isArray(a)){if(b.isObject(a))return this.contains(a);throw new Error("Invalid paramater for containsAll(<array>) method")}var c=this._array;if(!c)return!1;for(var d=0;d<a.length;d++)if(c.indexOf(a[d])<0)return!1;return!0},count:function(){return this._array?this._array.length:0},_endLock:function(){d.prototype._endLock.call(this);var a=this._array||[],b=this._targetArray||[];this._targetArray=c;var e=this._added||[];this._added=c;var f=this._removed||[];this._removed=c;var g=!!this._clearAll;if(this._clearAll=c,e.length||f.length||g){var h={oldSelection:a,newSelection:b,added:e,removed:f,clearAll:g},i=this.$emit(d.SELECTION_CHANGING_EVENT,h);i.defaultPrevented||(this._array=b.slice(),this.$emit(d.SELECTION_SET_EVENT,h),this.$emit(d.SELECTION_CHANGED_EVENT,h))}}}),e}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.selectionStrategy",["camelia.core"]);c.factory("camelia.SelectionStrategy",["$rootScope","$injector","camelia.core",function(a,b,c){function d(a,b){c.inheritScope(this,a),this._cardinality=d._GetCardinality(b)}var e=c.getProto(a);return d.BASE_CHANGED_EVENT="cm:baseChanged",d.OPTIONAL="optional",d.ZEROMANY="zeroMany",d.ONE="one",d.ONEMANY="oneMany",d._GetCardinality=function(a){switch(a.toLowerCase()){case"optional":case"?":return 0;case"zeromany":case"*":return 2;case"one":case"1":return 1;case"onemany":case"+":return 3}throw new Error("Invalid '"+a+"' cardinality")},d.CreateDefault=function(a,c){return b.invoke(["camelia.WinSelectionStrategy",function(b){return new b(a,c)}])},c.extendProto(d,e,{getBase:function(){return null},select:function(){return null}}),d}]),c.factory("camelia.WinSelectionStrategy",["camelia.SelectionStrategy","camelia.core",function(a,b){var c=function(b,c){a.prototype.constructor.call(this,b,c)};return b.extend(c,a,{getBase:function(){return this._base},select:function(b,c,d,e,f,g){var h=e&&e.type&&!e.type.indexOf("key");if(!h||!e.ctrlKey||g){if(1==this._cardinality)return this._base=d,this.$emit(a.BASE_CHANGED_EVENT,d),void b.set(c);if(e&&e.shiftKey){var i=f(this.getBase());if(i)return e.ctrlKey?void b.add(i):void b.set(i)}if(e&&e.ctrlKey){var j=b.count();if(b.containsAll(c)){if(3==this._cardinality&&2>j)return;return void b.remove(c)}if(this._cardinality)return void b.add(c)}this._base=d,this.$emit(a.BASE_CHANGED_EVENT,d),b.set(c)}}}),c}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.criteria",["camelia.i18n.criteria"]),d=0;c.factory("camelia.criteria.Criteria",["$log",function(){var a=function(a,b,c){var e=a.id;e||(e="cm_criteria_"+d++),this.id=e,this.name=c.name};return a.prototype={contributeFilters:function(){return[]},filterData:function(){return!1}},a}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.criteria");c.factory("camelia.criteria.Alphabetic",["$log","camelia.core","camelia.criteria.Criteria","camelia.i18n.Criteria",function(a,c,d,e){var f=function(a,b,c){d.call(this,a,b,c),this.type="Alphabetic"};return c.extend(f,d,{contributeFilters:function(){var a=[];b.forEach(["A-D","E-K","L-P","Q-Z","0-9"],function(b){var c=new RegExp("^["+b+"]","i");a.push({name:b,regExp:c,id:"alphabetic_"+b,toJson:function(){return{startsWith:b}}})});var d=new RegExp("^[^A-Z0-9]","i");return a.push({name:c.lang(e,"alphabetic_others"),regExp:d,id:"alphabetic_OTHERS",toJson:function(){return{others:!0}}}),a},filterData:function(a,b){var c=!1;if("string"!=typeof b)return c;for(var d=0;d<a.length;d++){var e=a[d];if(e.enabled&&e.regExp.test(b))return!c}return c}}),f}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.criteria");d.factory("camelia.criteria.MinMax",["$log","camelia.criteria.Criteria","camelia.core",function(a,d,e){var f=function(a,c,e){function f(a){var c=e[a];b.isString(c)&&("="==c.charAt(0)&&(c=c.substring(1),g["_"+a+"Eq"]=!0),g["_"+a]=parseFloat(c))}d.call(this,a,c,e),this.type="MinMax",!e.min&&e.value&&(e.min=e.value);var g=this;f("min"),f("max"),this._false="true"==e.reverse};return e.extend(f,d,{contributeFilters:function(){var a=this;return[{name:this.name,toJson:function(){return{min:a._min,minEq:a._minEq,max:a._max,maxEq:a._maxEq,reverse:a._false}}}]},filterData:function(a,d){var e=this._false;if(!b.isNumber(d))return e;var f=this._min;if(f!==c&&(!this._minEq&&f>=d||f>d))return e;var g=this._max;return g!==c&&(!this._maxEq&&d>=g||d>g)?e:!e}}),f}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.criteria");c.factory("camelia.criteria.Number",["$log","camelia.criteria.Criteria","camelia.core",function(a,c,d){var e=function(a,b,d){c.call(this,a,b,d),this.type="Number";var e=d.value;if(!e)throw new Error("You must specify value attribute");"true"==d.integer?(this._integer=!0,e=parseInt(e,10)):e=parseFloat(e),this._value=e,this._false="true"==d.reverse};return d.extend(e,c,{contributeFilters:function(){var a=this;return[{name:this.name,toJson:function(){return{value:a._value,reverse:a._false}}}]},filterData:function(a,c){var d=this._false;return b.isNumber(c)?(this._integer&&(c=Math.floor(c)),this._value===c?!d:d):d}}),e}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.criteria");c.factory("camelia.criteria.RegExp",["$log","camelia.criteria.Criteria","camelia.core",function(a,b,c){var d=function(a,c,d){b.call(this,a,c,d),this.type="RegExp";var e=d.value;if(!e)throw new Error("You must specify value attribute");var f=d.modifiers||"";"true"==d.ignoreCase&&(f+="i"),"true"==d.global&&(f+="g"),this._false="true"==d.reverse,this._regexp=new RegExp(e,f)};return c.extend(d,b,{contributeFilters:function(){var a=this;return[{name:this.name,toJson:function(){return{regExp:a._regExp,reverse:a._false}}}]},filterData:function(a,b){var c=this._false;if("string"!=typeof b)return c;var d=this._regexp;return d.test(b)?!c:c}}),d}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.criteria");c.factory("camelia.criteria.StartsWith",["$log","camelia.criteria.Criteria","camelia.core",function(a,b,c){var d=function(a,c,d){b.call(this,a,c,d),this.type="StartsWidth";var e=d.value;if(!e)throw new Error("You must specify value attribute");var f="";"true"==d.ignoreCase&&(f+="i",this._ignoreCase=!0),this._value=e,this._regExp=new RegExp("^["+e+"]",f),this._false="true"==d.reverse};return c.extend(d,b,{contributeFilters:function(){var a=this;return[{name:this.name,toJson:function(){return{startsWidth:a._value,ignoreCase:!!a._ignoreCase,reverse:a._false}}}]},filterData:function(a,b){{var c=this._false;this._regExp}return rexExp.test(b)?!c:c}}),d}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.criteria");c.factory("camelia.criteria.Type",["$log","camelia.criteria.Criteria","camelia.core",function(a,b,c){var d=function(a,c,d){b.call(this,a,c,d),this.type="Type";var e=d.value;if(!e)throw new Error("You must specify value attribute");this._value=e,this._false="true"==d.reverse};return c.extend(d,b,{contributeFilters:function(){var a=this;
return[{name:this.name,toJson:function(){return{type:a._value,reverse:a._false}}}]},filterData:function(a,b){var c=this._false;return typeof b==this._value?!c:c}}),d}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.components.grid",["camelia.core","camelia.dataModel","camelia.cursorProvider","camelia.selectionProvider","camelia.selectionStrategy","camelia.pagerRegistry"]);d.value("cm_grid_rendererProviderName","camelia.renderers.grid:camelia.renderers.GridProvider"),d.value("cm_grid_dataModelProviderName","");var e=0,f=!1;d.factory("camelia.components.DataGrid",["$log","$injector","$interpolate","$q","$timeout","$rootScope","camelia.core","camelia.SelectionStrategy","camelia.SelectionProvider","camelia.CursorProvider","cm_grid_dataModelProviderName","cm_grid_rendererProviderName","camelia.PagerRegistry","camelia.DataModel",function(a,d,f,g,h,i,j,k,l,m,n,o,p,q){var r=function(a,c,d){this.$scope=a,this.directiveInterpolate=d||f;var g=a.id;g||(g="cm_grid_"+e++),this.id=g,this.readyState="uninitialized";var h=a.rendererProvider;if(!h){var i=a.rendererProviderName||o;h=j.LoadProvider(i)}this.rendererProvider=h;var p=a.dataModelProvider;if(!p){var q=a.dataModelProviderName||n;q&&(p=j.LoadProvider(q))}this.dataModelProvider=p,this.$scope.$watchCollection("value",function(b){a.$broadcast("cm:valueChanged",b)}),this.cursorProvider=new m(a);var r=a.selectionProvider;if(!r){var s=j.toBoolean(a.selectable)||a.selectionCardinality;s&&(r=l.From(a.selection,a),a.$watch("selection",function(a,b){j.log("WATCH selection newSelection=",a," oldSelection=",b),r.set(a)}))}this.selectionProvider=r,a.$on(l.SELECTION_SET_EVENT,function(b,c){j.log("EVENT selection newSelection=",c.newSelection),a.selection=c.newSelection});var t=a.selectionStrategy;!t&&r&&(t=k.CreateDefault(a,a.selectionCardinality||"*")),this.selectionStrategy=t;var u=this;if(this.cursorProvider){var v=null;a.$watch(function(a){return v&&v.cursor===a.cursor&&v.columnCursorId===a.columnCursorId?v:v={cursor:a.cursor,columnCursorId:a.columnCursorId}},function(c){var d=c.cursor,e=c.columnCursorId;if(d){var f;e&&b.forEach(a.columns,function(a){a.id==e&&(f=a)}),u.cursorProvider.setCursor(d,f)}}),a.$on(m.CURSOR_CHANGED,function(b,c){a.cursor=c.row,a.columnCursorId=c.column?c.column.id:null})}a.getCurrentPositions=function(){return u.getCurrentPositions()}};return r.prototype={getCursorValue:function(){var a=this.selectionStrategy;return a?a.getCursor():null},construct:[function(){var a=this.$scope;this.constructing=!0,this.element=null,this.readyState="constructing";var c=b.element(document.createDocumentFragment()),d={$scope:a,$interpolate:this.directiveInterpolate,dataGrid:this,columns:a.columns,selectionProvider:this.selectionProvider,selectionStrategy:this.selectionStrategy,cursorProvider:this.cursorProvider,groupProviders:a.groupProviders},e=this,f=new this.rendererProvider(d);this.gridRenderer=f,a.$watch("first",function(a,c){!b.isNumber(a)||a==c||0>a&&0>c||"complete"==e.readyState&&h(function(){f.updateData()},10,!1)}),a.$watch("rows",function(a,c){!b.isNumber(a)||a==c||0>a&&0>c||"complete"==e.readyState&&f.updateData()});var i=f.render(c);return j.isPromise(i)||(i=g.when(i)),i.then(function(d){return d[0]&&(d=d[0]),e.readyState="complete",e.element=d,b.element(d).data("$scope",a),p.DeclareTarget(d),e._updateDataModel(f.$scope.value),f.$scope.$on("cm:valueChanged",function(a,b){e._updateDataModel(b)}),c},function(){return e.readyState="error",c})}],_updateDataModel:function(a){var b=this.gridRenderer,d=b.dataModel;d&&(b.dataModel=c,d.$destroy());var e=this.normalizeDataModel(a);j.isPromise(e)||(e=g.when(e));var f=this;e.then(function(a){b.dataErrored=!1,b.dataModel=a,a&&(a.$on(q.DATA_MODEL_CHANGED_EVENT,function(a,b){f._updateDataModel(b)}),a.$on(q.DATA_MODEL_UPDATED_EVENT,function(){b.updateData()})),b.updateData()},function(){b.dataErrored=!0,b.dataModel=null,b.updateData()})},normalizeDataModel:function(a){var b=this.dataModelProvider;return b?new b(a):q.From(a)},getCurrentPositions:function(){return{first:this.first||0,rows:this.rows||0,rowCount:this.rowCount||0,maxRows:this.maxRows||0}},setFirst:function(a){var b=this;this.$scope.$apply(function(){b.$scope.first=a})}},r}]),d.factory("camelia.components.DataColumn",["$log","camelia.core",function(a,b){function d(a,d){this.$scope=a;var f=a.id;f||(f="cm_data_column_"+(d||e++)),this.id=f,this.visible=a.visible===c||b.toBoolean(a.visible)!==!1,this.editable=a.editable===c||b.toBoolean(a.editable)!==!1;var g=a.titleAlign;g&&/^(center|left|right)$/i.test(g)&&(this.titleAlign=g);var h=a.cellAlign;h&&/^(center|left|right)$/i.test(h)>=0&&(this.cellAlign=h);var i=a.width;if(i&&(i=i.trim(),i.length)){var j=parseFloat(i),k=i.indexOf("px"),l=i.indexOf("%");k>0?this.specifiedWidthPx=j:l>0&&(this.specifiedWidthPercent=j)}var m=a.minWidth;m&&m.indexOf("px")>0&&(this.minWidth=parseFloat(m));var n=a.maxWidth;n&&n.indexOf("px")>0&&(this.maxWidth=parseFloat(n))}return d.prototype={addCriteria:function(a){this._criterias||(this._criterias=[],this._criteriasContext={}),this._criterias.push(a)},removeCriteria:function(a){var b=this._criterias;if(!b)return!1;var c=b.indexOf(a);return 0>c?!1:(b.splice(c,1),!0)}},d}]),d.factory("camelia.components.DataGroup",["$log","camelia.SelectionProvider",function(a,b){function c(a,c){this.$scope=a;var d=a.id;d||(d="cm_data_group_"+(c||e++)),this.id=d;var g=a.collapsedProvider;g||(g=b.From(a.collapsedGroups),a.$watch("collapsedGroups",function(){try{f=!0,g.set(a.collapsedGroups)}finally{f=!1}})),this.collapsedProvider=g,g&&g.$on(b.SELECTION_SET_EVENT,function(b,c){a.collapsedGroups=c.newSelection,f||a.$apply()})}return c.prototype={getCollapsedProvider:function(){return this.collapsedProvider}},c}]),d.factory("camelia.components.GridProvider",["camelia.components.DataGrid","camelia.components.DataColumn","camelia.components.DataGroup",function(a,b,c){return{DataGrid:a,DataColumn:b,DataGroup:c}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.components.pager",["camelia.core","camelia.pagerRegistry"]);d.value("cm_pager_rendererProviderName","camelia.renderers.pager:camelia.renderers.Pager"),d.value("cm_pager_format","{bprev} {bpages} {bnext}"),d.value("xcm_pager_format","'first=' {first} 'last=' {last} 'rowCount=' {rowCount} 'pageCount=' {pageCount} 'pagePos=' {pagePosition} {bprev} {bnext}");var e=0;d.factory("camelia.components.PagerBase",["$log","$q","$timeout","$exceptionHandler","camelia.core","camelia.PagerRegistry",function(a,d,e,f,g,h){var i=function(a,c,e){this.$scope=a;var f=a.rendererProvider;if(!f){var i=a.rendererProviderName||e;f=g.LoadProvider(i)}this.rendererProvider=f;var j=a.target;if(!j){var k=a.forElementId;if(!k)throw new Error("No target or for attribute to attach the pager !");var l=document.getElementById(k);l&&(j=b.element(l).scope()._component)}var m;j?m=d.when(j):a.forElementId&&(m=h.RegisterWaitingFor(a,a.forElementId)),this.targetPromise=m};return i.prototype={construct:["$q",function(){this.constructing=!0,this.constructed=!1,this.element=null;var a=this;return this.targetPromise.then(function(c){g.Assert(c&&b.element(c).scope(),"pager","Invalid target component ",c);var d=b.element(c).scope();delete a.targetPromise;var e={pager:a,targetScope:d,$scope:a.$scope};return a.constructFromTarget(e)},function(){return a.constructing=!1,a.constructed=!1,doc})}],constructFromTarget:function(a){var e,f=a.targetScope,h=b.element(document.createDocumentFragment()),i=this,j=f.$on("$destroy",function(){i.targetDestroyed(f),a.targetScope=c}),k=f.$on("cm:positionsChanged",function(a,b){return i.element?(e=c,void i.updatePositions(b)):void(e=b)});this.$scope.$on("$destroy",function(){j(),k()});var l=new this.rendererProvider(a);this.pagerRenderer=l;var m=l.render(h);return g.isPromise(m)||(m=d.when(m)),m.then(function(a){i.constructing=!1,i.constructed=!0,i.element=a,b.element(a).data("$scope",i.$scope);var d=e;return e=c,!d&&f.getCurrentPositions&&(d=f.getCurrentPositions()),d&&i.updatePositions(d),h})},_targetDestroyed:function(){},updatePositions:function(a){this.pagerRenderer.pagerPositionsUpdate(a)}},i}]),d.factory("camelia.components.Pager",["$log","cm_pager_rendererProviderName","cm_pager_format","camelia.components.PagerBase",function(a,c,d,f){var g=function(a,b){var d=a.id;d||(d="cm_pager_"+e++),this.id=d,b.attr("id",d),f.call(this,a,b,c)};return g.prototype=Object.create(f.prototype),b.extend(g.prototype,{constructor:g,constructFromTarget:function(a){var c=this.$scope.format;b.isString(c)||(c=d),a.format=c;var e=this;return this.$scope.$watch("format",function(c){var f=a.targetScope,g=f.getCurrentPositions();b.isString(c)||(c=d),a.format=c,e.updatePositions(g)}),f.prototype.constructFromTarget.call(this,a)}}),g}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.components.popup",["camelia.core"]);c.value("cm_popup_rendererProviderName","camelia.renderers.popup:camelia.renderers.Popup"),c.factory("camelia.components.popup",["$log","$q","$timeout","$exceptionHandler","camelia.core","cm_popup_rendererProviderName",function(a,b,c,d,e){var f=function(a,b,c){this.$scope=a,b.data("cm_component",this);var d=a.rendererProvider;if(!d){var f=a.rendererProviderName||c;d=e.LoadProvider(f)}this.rendererProvider=d};return f.prototype={construct:["$q",function(a){this.constructing=!0,this.constructed=!1,this.element=null;var b=this;return a.when(function(a){e.Assert(a&&a.$scope,"pager","Invalid target component ",a),b.targetComponent=a;var c={pager:b,target:a,rendererProvider:b.rendererProvider,$scope:b.$scope};return b.constructFromTarget(c)},function(){return b.constructing=!1,b.constructed=!1,doc})}],open:function(){}},f}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.components.template",["camelia.core"]);c.factory("camelia.components.Template",["$log","$timeout","$exceptionHandler","$compile","camelia.core",function(){var a=0,b=function(b,c,d,e){this.$scope=b,this._transcludeFunc=e,this.id="template_"+a++,d.templates||(d.templates=[]),d.templates.push(this)};return b.markContainer=function(a,b){a.data("$cmTemplateContainerController",b)},b.prototype={transclude:function(a,b){var c=this._transcludeFunc,d=c(b,function(b){a.append(b)});return d}},b}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.renderers.grid",["camelia.dataModel","camelia.selectionProvider","camelia.cursorProvider","camelia.selectionStrategy","camelia.key","camelia.renderers.popup","camelia.components.grid","camelia.animations.grid","camelia.i18n.grid"]);c.value("cm_grid_rowIndentPx",16),c.value("cm_grid_className","cm_dataGrid"),c.value("cm_grid_sizerPx",6),c.factory("camelia.renderers.GridProvider",["$log","camelia.renderers.grid.core","camelia.renderers.grid.group","camelia.renderers.grid.row","camelia.renderers.grid.table","camelia.renderers.grid.title","camelia.renderers.grid.utils",function(a,c,d,e,f,g,h){return b.forEach([d,e,f,g,h],function(a){b.extend(c.prototype,a)}),c}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.renderers.grid");d.value("cm_grid_animation_pageChange","camelia.animations.grid.PageChange");var e={row:!0,group:!0},f={cell:!0,groupTitle:!0},g=300;d.factory("camelia.renderers.grid.core",["$log","$q","$window","$timeout","$exceptionHandler","camelia.core","camelia.cmTypes","camelia.animations.Animation","cm_grid_className","cm_grid_rowIndentPx","camelia.Key","camelia.SelectionProvider","camelia.CursorProvider","camelia.renderers.FiltersPopup","cm_grid_sizerPx","cm_grid_animation_pageChange",function(a,d,h,i,j,k,l,m,n,o,p,q,r,s,t,u){function v(a){var b=l.SearchElements({tcell:null,title:null,cell:null,row:null,table:null,grid:null,group:null,groupExpand:null},"grid",a);return b}var w=function(a){b.extend(this,a)};return w.prototype={render:function(a){var f=this.$scope;f.$broadcast("cm:dataGrid_rendering");var g=k.createElement(a,"div",{id:this.dataGrid.id,$cm_type:"grid"});this.container=g[0],f.$watch("style",function(a){a=a||"",g.attr("style",a)});var i=this;f.$watch("className",function(){i.gridStyleUpdate(g)});var j=f.tabIndex;(!j||0>j)&&(j=0),this.tabIndex=j,this.rowIndent=0,this.setupGroupProviders(),this.tableInstallWatchs(),f.$on(r.CURSOR_CHANGED,function(a,d){var f=i._selectionSourceEvent;if(console.log("SourceEvent=",f),d.oldRow){var g=i.getElementFromValue(d.oldRow,e);g&&g._cursor&&(g._cursor=c,k.BubbleEvent(g,"cm_update"))}if(d.row){var h=i.getElementFromValue(d.row,e);h&&!h._cursor&&(h._cursor=!0,k.BubbleEvent(h,"cm_update"))}var j=i.selectionProvider;if(j){var l=d.row,m=l;if(i.groupProviders){var n=i.getElementFromValue(l,"group");n&&(m=b.element(n).data("cm_rowValues"))}j.run(function(){i.selectionStrategy.select(j,m,l,f,function(a){return i._computeRowRangeFromCursor(l,a)})})}}),g.on("mouseover",this._onMouseOver()),g.on("mouseout",this._onMouseOut()),g.on("mousedown",this._onMouseDown()),g.on("dblclick",this._onDoubleClick()),g.on("click",this._onSimpleClick()),g.on("mouseup",this._onMouseUp()),g.on("keydown",this._onKeyPress()),this._offFocus=k.on(g,"focus",this._onFocus(),!0,f),this._offBlur=k.on(g,"blur",this._onBlur(),!0,f),f.$on("$destroy",function(){i._offFocus(),i._offBlur(),i.tableDestroy()}),g.on("cm_update",this._onGridStyleUpdate()),f.$broadcast("cm:dataGrid_title_rendering");var l=this.titleRenderer(g);return k.isPromise(l)||(l=d.when(l)),l.then(function(a){return f.$broadcast("cm:dataGrid_title_rendered"),i._title=a,f.$broadcast("cm:dataGrid_body_rendering"),i._monitorPositions(function(){var a=b.element(document.createDocumentFragment()),c=k.createElement(a,"div",{styleClass:"cm_dataGrid_bcontainer"});i.bodyContainer=c[0];var e=i.tableRenderer(c);k.isPromise(e)||(e=d.when(e)),e.then(function(){g.append(a),f.$broadcast("cm:dataGrid_body_rendered");var c=b.element(h),e=i._onResize();c.on("resize",e),f.$on("$destroy",function(){c.off("resize",e)});var j=i.gridLayout();k.isPromise(j)||(j=d.when(j)),j.then(function(){f.$broadcast("cm:dataGrid_rendered"),f.$on(q.SELECTION_CHANGED_EVENT,i._onSelectionChanged()),i._gridReady(g),f.$broadcast("cm:dataGrid_ready")})})}),g})},setupGroupProviders:function(){this.selectedGroupProvider=null;var a=this.groupProviders;if(a)for(var b=0;b<a.length;b++){var c=a[b];if(!k.toBoolean(c.disabled)){this.selectedGroupProvider=c;break}}if(this.selectedGroupProvider){this.rowIndent=1;var d=this;this.selectedGroupProvider.collapsedProvider.$on(q.SELECTION_CHANGED_EVENT,d._onCollapsedChanged())}},_gridReady:function(a,b){var c,d;if(this.focusCellId&&(d=document.getElementById(this.focusCellId),d&&(c=d.parentNode)),!c&&this.selectionProvider){var e=this.selectionProvider.getFirstElement();e&&(c=this.getElementFromValue(e,"row"))}return c||(c=this.getFirstRow())?d||(d=l.GetNextType(c.firstChild,f))?b?d.getBoundingClientRect().width?(k.setFocus(d),!0):(i(function(){k.setFocus(d)},50,!1),!0):(this._setCursor(d),!0):!1:!1},_setCursor:function(a,c){k.log("SetCursor ",a);var d=this.focusCellId;if(d&&(!a||a.id!=d)){this.focusCellId=null;var e=document.getElementById(d);e&&(e.tabIndex=-1)}if(a&&(this.focusCellId=a.id,a.tabIndex=this.tabIndex,this.cursorProvider)){var f=a.parentNode,g=b.element(f).data("cm_value");this.registerElement(f,g);var h=a.cm_lindex,i=this.columns[h];this.cursorProvider.requestCursor(g,i,c)}},gridStyleUpdate:function(a){var b=n.split(" "),c=this.$scope.className;return c&&b.push(c),l.MixElementClasses(a,b)},gridLayout:function(){var c=this.container;if(this.layoutState="uninitialized",a.debug("GridLayout beginning (containerSize="+this._containerSizeSetted+")"),!this._containerSizeSetted){var e=this.container.style;if(e.width||e.height){var f=this.container.getBoundingClientRect();if(f.height&&f.width){this._containerSizeSetted=!0;var g=(this.titleViewPort.getBoundingClientRect(),this.tableViewPort.style);g.width=f.width+"px"}}else this._containerSizeSetted=!0}var h=this,j=this.tableViewPort.getBoundingClientRect();if(!j||j.width<1&&j.height<1)return a.debug("No bounding client rect ",j,"  => timeout 10ms"),this._hideBody(),i(function(){h.gridLayout()},10,!1);if(this.gridWidth==j.width&&this.gridHeight==j.height)return a.debug("Begin layout : Already done"),h._alignColumns(!0),h._showBody(),this.layoutState="complete",!0;a.debug("Begin layout to "+j.width+","+j.height),this.gridWidth=j.width,this.gridHeight=j.height,this.$scope.$broadcast("cm:dataGrid_layout_begin");var l=b.element(c),m=this.titleLayout(l,j.width);return k.isPromise(m)||(m=d.when(m)),m.then(function(){h.layoutState="titleDone";var a=h.tableLayout(l,j.width,j.height);k.isPromise(a)||(a=d.when(a)),a.then(function(){h.layoutState="bodyDone",h._alignColumns(!0),h._showBody();var a=h._cursor;if(a){for(var b=a.parentNode;b&&1==b.nodeType;b=b.parentNode);b&&9==b.nodeType||(a=null,h._cursor=null)}h.layoutState="complete",h.$scope.$broadcast("cm:dataGrid_layout_end")})})},_hasData:function(){var a=this.getTableBody();return a&&a.firstChild},_alignColumns:function(c){var d=0,e=this.rowIndent;b.forEach(this.visibleColumns,function(a){var b=a.width,f=b;!a.visibleIndex&&e&&(f-=e*o);var g=a.titleElement.style;g.width=b+"px",a.bodyColElement.style.width=c?f+"px":"auto",d+=b});var f=(this.gridWidth,0);this.hasResizableColumnVisible&&(f=t),this.rightColElement&&(this.rightColElement.style.width=f+"px",d+=f),this.tableElement.style.width=c?d+"px":"auto",a.debug("AlignColumns ... total="+d+" sizer="+f)},_computeRowRangeFromCursor:function(a,c){var d,f,g=[],h=this.getTableBody();if(!h)return null;for(var i=h.firstChild;i;i=i.nextSibling)if(1==i.nodeType){var j=l.GetCMType(i);if(e[j]){var k=b.element(i).data("cm_value");if(d||k!==c||(d=!0),f||k!==a||(f=!0),(d||f)&&g.push(k),d&&f)return g}}return null},_emitClick:function(a,c,d){var e=a.row;if(e){var f=b.element(e).data("cm_value"),g={grid:this.grid,event:d,row:e,rowValue:f},h=a.cell;if(h){g.cell=h;var i=h.cm_lindex;g.column=this.columns[i]}this.$scope.$emit(c,g)}},onKeyPress_Cell:function(a,d,g){function h(){if((!r||r.id==n.id)&&w.rows>0){var a=w.first-w.rows;0>a&&(a=0),w.first>a&&w.setFirst(a),r=null}}function i(){if((!r||r.id==n.id)&&w.rows>0){var a=w.first+w.rows;(w.rowCount<0||a<w.rowCount)&&w.setFirst(a),r=null}}var j,m,n=a.parentNode,o=n.parentNode,q=a.cm_lindex,r=n,s=!1,t=!1,u=!1,v=this.tableViewPort;g&&(j=b.element(g).data("cm_value"),m=this.selectedGroupProvider.getCollapsedProvider());var w=this.dataGrid;switch(d.keyCode){case p.VK_DOWN:s=!0,r=l.GetNextType(n.nextSibling,e),i();break;case p.VK_PAGE_DOWN:s=!0,r=l.GetPreviousVisibleType(v,o.lastChild,e),r&&r.id==n.id&&v.scrollHeight>v.offsetHeight&&(v.scrollTop+=v.clientHeight-n.offsetHeight,r=l.GetPreviousVisibleType(v,o.lastChild,e)),i();break;case p.VK_END:s=!0,r=l.GetPreviousType(o.lastChild,e),i();break;case p.VK_UP:s=!0,r=l.GetPreviousType(n.previousSibling,e),h();break;case p.VK_PAGE_UP:s=!0,r=l.GetNextVisibleType(v,o.firstChild,e),r&&r.id==n.id&&(v.scrollTop-=v.clientHeight-n.offsetHeight,r=l.GetNextVisibleType(v,o.firstChild,e)),h();break;case p.VK_HOME:s=!0,r=l.GetNextType(o.firstChild,e),h();break;case p.VK_SPACE:s=!0,t=!0;break;case p.VK_RIGHT:if(s=!0,g)m.contains(j)&&this._toggleGroupExpand(g);else if(b.isNumber(q)){var x=this.columns[q],y=this.visibleColumns[x.visibleIndex+1];y&&(q=y.logicalIndex,u=!0)}break;case p.VK_LEFT:if(s=!0,g)m.contains(j)||this._toggleGroupExpand(g);else if(b.isNumber(q)){var x=this.columns[q];if(x.visibleIndex>0){var y=this.visibleColumns[x.visibleIndex-1];q=y.logicalIndex,u=!0}}}var z=this;if(t){var A=this.selectionStrategy;if(A){var B=b.element(r).data("cm_value");this.registerElement(r,B);var C=B;if(this.groupProviders){var g=this.getElementFromValue(C,"group");g&&(B=b.element(g).data("cm_rowValues"))}A.select(this.selectionProvider,B,C,d,function(a){return z._computeRowRangeFromCursor(C,a)},!0)}}if(r&&r.id!=n.id&&(this.registerElement(r),u=!0),u){var a=l.GetNextType(r.firstChild,f,function(a){return a.cm_lindex===c||q===c?!0:a.cm_lindex==q});a&&(this._registerSelectionEvent(d),k.setFocus(a))}s&&(d.stopPropagation(),d.preventDefault())},_onCollapsedChanged:function(){var a=this;return function(c,d){a._switchElementsFromEvent(d,"group","_collapsed",function(b,c){a.removeRowsOfGroup(c,b)},function(c){var d=b.element(c).data("cm_value");a.addRowsOfGroup(d,c)})}},_onSelectionChanged:function(){var a=this;return function(b,c){a._switchElementsFromEvent(c,"row","_selected")}},_switchElementsFromEvent:function(a,d,e,f,g){var h=a.removed.length+a.added.length,i=h>1?{}:null,j=this;a.clearAll&&!a.removed.length?this.forEachBodyElement(d,function(a){a[e]&&(a[e]=c,k.BubbleEvent(a,"cm_update"),g&&g(a))},d):b.forEach(a.removed,function(a){var b=j.getElementFromValue(a,d,i);b&&b[e]&&(b[e]=c,k.BubbleEvent(b,"cm_update"),g&&g(b))}),b.forEach(a.added,function(a){var b=j.getElementFromValue(a,d,i);b&&!b[e]&&(b[e]=!0,k.BubbleEvent(b,"cm_update"),f&&f(b,a))})},_onResizeColumnMoving:function(a,b){var c=b.clientX-this.columnMoveClientX,d=this.columnResizingWidth+c;d<a.computedMinWidth&&(d=a.computedMinWidth),a.maxWidth&&d>a.maxWidth&&(d=a.maxWidth),d!=a.width&&(a.width=d,a.specifiedWidthPx=d+"px",this._alignColumns(!0)),b.preventDefault(),b.stopPropagation()},_onResizeColumnMouseUp:function(a,b){console.log("On resize column mouse up"),this._onResizeColumnRelease(),this.$scope.$broadcast("cm:dataGrid_resized",a),b.preventDefault(),b.stopPropagation()},_onResizeColumnRelease:function(){console.log("On resize column release"),this.columnMouseMoveListener&&(document.removeEventListener("mousemove",this.columnMouseMoveListener,!0),this.columnMouseMoveListener=c),this.columnMouseUpListener&&(document.removeEventListener("mouseup",this.columnMouseUpListener,!0),this.columnMouseUpListener=c),this.columnResizing=c,this.columnResizingWidth=c},_onResizeColumn:function(a,c,d){console.log("On resize column "+a),this._allWidthSpecified||(this._allWidthSpecified=!0,b.forEach(this.visibleColumns,function(a){a.specifiedWidthPx=a.width+"px"})),this.$scope.$broadcast("cm:dataGrid_resizing",a),this.columnResizing&&this._onResizeColumnRelease();var e=this;this.columnMouseUpListener=function(b){return e._onResizeColumnMouseUp(a,b)},this.columnMouseMoveListener=function(b){return e._onResizeColumnMoving(a,b)},document.addEventListener("mousemove",this.columnMouseMoveListener,!0),document.addEventListener("mouseup",this.columnMouseUpListener,!0),this.columnResizing=!0,this.columnResizingWidth=a.width,this.columnMoveClientX=d.clientX,d.preventDefault(),d.stopPropagation()},_toggleColumnSort:function(a){this.$scope.$broadcast("cm:dataGrid_sorting");var d=this.sorters,e={},f=!0;d&&b.forEach(d,function(b){var d=b.column;d===a&&(f=!b.ascending);var g=d.titleElement;g&&(g._ascending=c,g._descending=c),e[d.columnId]=d});var g=[];this.sorters=g,g.push({column:a,ascending:f}),b.forEach(g,function(a){var b=a.column,c=b.titleElement,d=!!a.ascending;c._ascending=d,c._descending=!d,e[b.columnId]=b}),b.forEach(e,function(a){var b=a.titleElement;b&&k.BubbleEvent(b,"cm_update")});var h=this._refreshRows(),i=this;return h.then(function(){i.$scope.$broadcast("cm:dataGrid_sorted")})},_monitorPositions:function(a){var b=this.dataGrid.first,c=this.dataGrid.rows,e=this.dataGrid.rowCount,f=this.dataGrid.maxRows,g=a.call(this);k.isPromise(g)||(g=d.when(g));var h=this;return g.then(function(){var a=h.dataGrid,d=h.$scope,g=a.first,i=a.rows,j=a.rowCount,k=a.maxRows,l={first:g,rows:i,rowCount:j,maxRows:k},m=!1;b!=a.first&&(l.firstChanged=!0,m=!0,d.$broadcast("cm:firstChanged",a.first)),c!=a.rows&&(l.rowsChanged=!0,m=!0,d.$broadcast("cm:rowsChanged",a.rows)),e!=a.rowCount&&(l.rowCountChanged=!0,m=!0,d.rowCount=j,d.$broadcast("cm:rowCountChanged",a.rowCount)),f!=a.maxRows&&(l.maxRowsChanged=!0,m=!0,d.maxRows=k,d.$broadcast("cm:maxRowsChanged",a.maxRows)),m&&d.$broadcast("cm:positionsChanged",l)})},updateData:function(a){a===c&&(a=!0);var b=this;this._monitorPositions(function(){return b._refreshRows(a)}).then(function(){})},_hideBody:function(){var b=this.tableViewPort.style;b.width="auto",b.visibility="hidden",a.debug("Hide body")},_showBody:function(){var b=this.tableViewPort.style;b.visibility="",a.debug("Show body")},_clearPageAnimation:function(){var a=this._pageAnimation;if(a){this._pageAnimation=c;try{a.cancel()}catch(b){j(b,"Page Animation cancel() error")}finally{try{a.$destroy()}catch(b){}}}},_refreshRows:function(e,f){function g(a){n.end(),p._gridReady(p.container,f!==!1),p.$scope.$broadcast(a||"cm:dataGrid_refreshed")}a.debug("Refresh rows"),e&&(this._naturalWidths=c,this._containerSizeSetted=c,this.gridWidth=-1),this._clearPageAnimation();var h=this.dataGrid,j=this.$scope.first;(!b.isNumber(j)||0>j)&&(j=0),h.first=j;var l=this.$scope.rows;b.isNumber(l)||(l=-1),h.rows=l;var n=m.newInstance(u,this.$scope,{first:j,oldFirst:this._renderedFirst,rows:l,renderer:this});this._pageAnimation=n,n.start();var o=this.tableRowsRenderer(),p=this;return k.isPromise(o)||(o=d.when(o)),o.then(function(){var a=p.dataGrid;if(console.log("first="+a.first+" visibleRows="+a.visibleRows+" rows="+a.rows+" maxRows="+a.maxRows+" rowCount="+a.rowCount),!a.visibleRows&&a.first){var b=0;a.maxRows>0&&(b=Math.floor((a.maxRows-1)/a.rows)*a.rows,0>b&&(b=0)),i(function(){console.log("Change first to "+b),p.$scope.first=b,p.$scope.$digest()},10,!1)}return g()},function(a){return console.error("Catch process failed message "+a),g("cm_dataGrid_errored")},function(){})},_moveColumn:function(a,e,f){var g=this.visibleColumns,h=g[e+(e>a.visibleIndex?1:0)];this._lastVisibleColumn=g[g.length-1],g.splice(a.visibleIndex,1),g.splice(e,0,a);var i=0;b.forEach(g,function(a){a.beforeMovingVisibleIndex=a.visibleIndex,a.visibleIndex=i++});var j=this.moveColumnTitle(a,h);k.isPromise(j)||(j=d.when(j));var l=this;j.then(function(){var b=l.moveColumnTable(a,h);k.isPromise(b)||(b=d.when(b)),b.then(function(){l._lastVisibleColumn=c,a.beforeMovingVisibleIndex&&a.visibleIndex||l._alignColumns(!0),f!==!1&&a.buttonElement.focus()})})},_registerSelectionEvent:function(a){console.log("Register event ",a),this._selectionSourceEvent=a;var b=this;i(function(){console.log("Unregister event ",a),b._selectionSourceEvent=c},10,!1)},_toggleGroupExpand:function(a){var c=b.element(a),d=c.data("cm_value"),e=this.selectedGroupProvider.getCollapsedProvider(),f=!e.contains(d);f?e.add(d):e.remove(d)},_onTitleCellMouseDown:function(a,c){var d=a.clientX,e=b.element(c).data("cm_column");this._onTitleCellClear(),this.titleCellMoving=!0,this.titleCellMovingClientX=d,this.titleCellMovingLayerX=a.layerX;var f=this;this.titleCellMouseUpListener=function(a){return f._onTitleCellMouseUp(c,a,e)},this.titleCellMouseMoveListener=function(a){return f._onTitleCellMouseMoving(c,a,e)},document.addEventListener("mousemove",this.titleCellMouseMoveListener,!0),document.addEventListener("mouseup",this.titleCellMouseUpListener,!0)},_onTitleCellMouseMoving:function(a,b,c){var d=b.clientX-this.titleCellMovingClientX;(-20>d||d>20)&&(this.titleCellColumnMoving||(this.titleCellColumnMoving=c,this.beginMovingTitleCell(c,b,d,this.titleCellMovingLayerX))),this.titleCellColumnMoving&&this.movingTitleCell(c,b,d,this.titleCellMovingLayerX)},_onTitleCellMouseUp:function(a,c,d){var e=v(c.target);if(this.titleCellColumnMoving){var f=c.clientX-this.titleCellMovingClientX,g=this.endMovingTitleCell(d,c,f);b.isNumber(g)&&this._moveColumn(d,g)}else e.tcell&&e.tcell.id==a.id&&(e.tparams?this._showFilterPopup(d,e.tparams,c,e):a._sortable&&this._toggleColumnSort(d,c));return this._onTitleCellClear(),l.ClearState(this,e,"mouseDown"),c.stopPropagation(),!1},_showFilterPopup:function(a,b,c,d){var e=this.dataModel,f=this,g=new s(this.$scope,{},a,e,function(){var a=f._monitorPositions(function(){return f._refreshRows(!1,!1)});return a.then(function(){f.gridLayout(),f.$scope.$broadcast("cm_dataGrid_filtred")})});g.$scope.$on("cm:popup_opened",function(){l.SwitchOnState(f,d,"openedPopup")}),g.$scope.$on("cm:popup_closed",function(){l.ClearState(f,d,"openedPopup")}),g.open({reference:b,valign:"bottom",deltaY:2})},_onTitleCellClear:function(){this.titleCellColumnMoving&&(this.endMovingTitleCell(this.titleCellColumnMoving),this.titleCellColumnMoving=c),this.titleCellMouseMoveListener&&(document.removeEventListener("mousemove",this.titleCellMouseMoveListener,!0),this.titleCellMouseMoveListener=c),this.titleCellMouseUpListener&&(document.removeEventListener("mouseup",this.titleCellMouseUpListener,!0),this.titleCellMouseUpListener=c),this.titleCellMoving=c,this.titleCellColumnMoving=c},onKeyPress_Title:function(a,c,d){var e=a,f=!1,g=b.element(a).data("cm_column");switch(c.keyCode){case p.VK_LEFT:f=!0,c.ctrlKey?g.visibleIndex&&this._moveColumn(g,g.visibleIndex-1):(e=l.GetPreviousType(a.previousSibling,"tcell"),e||(e=l.GetPreviousType(a.parentNode.lastChild,"tcell")));break;case p.VK_RIGHT:f=!0,c.ctrlKey?g.visibleIndex<this.visibleColumns.length-1&&this._moveColumn(g,g.visibleIndex+1):(e=l.GetNextType(a.nextSibling,"tcell"),e||(e=l.GetNextType(a.parentNode.firstChild,"tcell")));break;case p.VK_HOME:f=!0,e=l.GetNextType(a.parentNode.firstChild,"tcell");break;case p.VK_END:f=!0,e=l.GetPreviousType(a.parentNode.lastChild,"tcell");break;case p.VK_SPACE:f=!0,this._toggleColumnSort(g,c);break;case p.VK_DOWN:f=!0,g.titleElement._filtreable&&(d.tparams=g.parametersElement,this._showFilterPopup(g,d.tparams,c,d))}if(e&&e.id!=a.id){var g=b.element(e).data("cm_column");g.buttonElement.focus()}f&&(c.stopPropagation(),c.preventDefault())},_onResize:function(){a.debug("On resize ...");var b=this;return function(){try{b.gridLayout()}catch(a){j(a,"Exception while resizing")}}},_onMouseOver:function(){var a=this;return function(b){var c=b.target;if(!a.columnResizing&&!a.titleCellMoving){var d=v(c);l.SwitchOnState(a,d,"over")}}},_onMouseOut:function(){var a=this;return function(b){var c=b.relatedTarget,d=v(c);l.SwitchOffState(a,d,"over")}},_onFocus:function(){var a=this;return function(b){var c=b.target,d=v(c);a._lastFocusEventData=Date.now(),l.SwitchOnState(a,d,"focus",function(c){var d=c.cell||c.groupTitle;d&&a._setCursor(d,b)})}},_onBlur:function(){var a=this;return function(b){var c=b.relatedTarget,d=v(c);l.SwitchOffState(a,d,"focus")}},_onDoubleClick:function(){var a=this;return function(b){var d=b.target,e=v(d);if(e.group){var f=a._groupSimpleClickPromise;return f&&(a._groupSimpleClickPromise=c,i.cancel(f)),void a._toggleGroupExpand(e.group)}a._emitClick(e,"RowDoubleClick",b)}},_onSimpleClick:function(){var a=this;return function(c){var d=c.target,e=v(d);if(!a._lastFocusEventData&&e.row&&e.cell){var f=b.element(e.row).data("cm_value");a.registerElement(e.row,f);var g=e.cell.cm_lindex,h=a.columns[g],i=a.cursorProvider,j=i.getRow(),k=i.getColumn();if(h===k&&f===j){var l=a.selectionProvider;l&&l.run(function(){a.selectionStrategy.select(l,f,f,c,function(b){return a._computeRowRangeFromCursor(f,b)})})}}a._lastFocusEventData=0,a._emitClick(e,"RowClick",c)}},_onMouseDown:function(){var a=this;return function(d){var e=d.target,f=v(e);l.SwitchOnState(a,f,"mouseDown",function(e){var f=e.tsizer;if(f){var h;if(e.tcell){var j=b.element(e.tcell).data("cm_column"),k=j.visibleIndex;h=a.visibleColumns[k-1]}else h=a.visibleColumns[a.visibleColumns.length-1];return a._onResizeColumn(h,f,d),!1}var l=e.groupExpand;if(l)return a._toggleGroupExpand(e.group),!1;var m=e.row;m&&(a.registerElement(m),a._registerSelectionEvent(d,!1));var n=e.tcell;if(n)return a._onTitleCellMouseDown(d,n),d.stopPropagation(),!1;if(e.group){var o=a._groupSimpleClickPromise;return o&&(a._groupSimpleClickPromise=c,i.cancel(o)),a._groupSimpleClickPromise=i(function(){a._groupSimpleClickPromise=c,a.registerElement(e.group),a._registerSelectionEvent(d,!1),e.groupTitle&&e.groupTitle.focus()},g,!1),d.stopPropagation(),d.preventDefault(),!1}return d.stopPropagation(),!1})}},_onMouseUp:function(){var a=this;return function(){var b=v();l.ClearState(a,b,"mouseDown",function(){})}},_onKeyPress:function(){var a=this;return function(b){var c=b.target,d=v(c);return d.tcell?a.onKeyPress_Title(d.tcell,b,d):d.cell?a.onKeyPress_Cell(d.cell,b):d.groupTitle?a.onKeyPress_Cell(d.groupTitle,b,d.group):void 0
}},_onGridStyleUpdate:function(){var a={grid:"gridStyleUpdate",table:"tableStyleUpdate",row:"rowStyleUpdate",cell:"cellStyleUpdate",title:"titleStyleUpdate",tcell:"titleCellStyleUpdate",group:"groupStyleUpdate"},c=this;return function(d){var e=d.relatedTarget,f=l.GetCMType(e);if(f){var g=b.element(e),h=c[a[f]];return h?(h.call(c,g),void d.stopPropagation()):void 0}}}},w}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.renderers.grid");d.factory("camelia.renderers.grid.group",["$log","camelia.core","camelia.cmTypes",function(a,d,e){var f=0;return{groupRenderer:function(a,e,g,h,i,j){var k=(a.ownerDocument||document,d.createElement(a,"tr",{id:"cm_group_"+f++,role:"row",tabIndex:-1,$cm_groupIndex:h})),l=k[0];l._collapsed=i;var m=e.titleClassMode;if(m===c){m=0;var n=e.$scope.titleClassRawExpression;if(n&&n.length){var o=this.$interpolate,p=n;m=3,n.indexOf(o.startSymbol())>=0?(m=1,p=this.$interpolate(n)):"{"==n.charAt(0)&&"}"==n.charAt(n.length-1)&&(m=2),e.titleClassExpression=p}e.titleClassMode=m}if(m){var q=e.titleClassExpression;if(3!=m&&(q=g.$eval(q)),q)if(b.isString(q))l.cm_groupClasses=q.split(" ");else if(b.isObject(q)){var r=[];b.forEach(q,function(a,b){a&&r.push(b)}),r.length&&(l.cm_groupClasses=r)}}this.groupStyleUpdate(k);{var s=d.createElement(k,"td",{id:"cm_groupTitle_"+f++,tabIndex:-1,nowrap:"nowrap",role:"rowgroup",className:"cm_dataGrid_gcell",colspan:this.visibleColumns.length+1+this.rowIndent});this.groupTitleRenderer(s,e,g,h,j)}return k},groupTitleRenderer:function(a,b,c){var e=d.createElement(a,"div",{className:"cm_dataGrid_gcontainer"}),g=(d.createElement(e,"div",{className:"cm_dataGrid_gexpand",id:"cm_groupExpand_"+f++}),d.createElement(e,"label",{className:"cm_dataGrid_glabel"})),h=null,i=b.interpolatedTitleExpression;if(!i){var j=b.$scope.titleRawExpression;j&&(i=this.$interpolate(j),b.interpolatedTitleExpression=i)}if(i){var h=c.$eval(i);h&&g.text(h)}d.createElement(e,"div",{className:"cm_dataGrid_gline"})},groupStyleUpdate:function(a){var b=a;b[0]&&(b=b[0]);var c=["cm_dataGrid_group"];return b.cm_groupClasses&&c.push.apply(c,b.cm_groupClasses),e.MixElementClasses(b,c)}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.renderers.grid");d.factory("camelia.renderers.grid.row",["$log","$interpolate","camelia.core","camelia.cmTypes",function(a,d,e,f){var g=0;return{rowRenderer:function(a,d,f,h,i){if(!d)throw new Error("RowScope is invalid "+d);var j=(a.ownerDocument||document,e.createElement(a,"tr",{id:"cm_row_"+g++,role:"row",tabIndex:-1,$cm_rowIndex:f})),k=j[0];k._rowIdent=h;var l=this.rowClassMode;if(l===c){l=0;var m=this.$scope.rowClassRawExpression;if(m&&m.length){var n=this.$interpolate,o=m;l=3,m.indexOf(n.startSymbol())>=0?(l=1,o=this.$interpolate(m)):"{"==m.charAt(0)&&"}"==m.charAt(m.length-1)&&(l=2),this.rowClassExpression=o}this.rowClassMode=l}if(l){var p=this.rowClassExpression;if(3!=l&&(p=d.$eval(p)),p)if(b.isString(p))k.cm_rowClasses=p.split(" ");else if(b.isObject(p)){var q=[];b.forEach(p,function(a,b){a&&q.push(b)}),q.length&&(k.cm_rowClasses=q)}}var r=this.selectionProvider;r&&r.contains(d.$row)&&(k._selected=!0),this.rowStyleUpdate(j);for(var s=0;h>s;s++){e.createElement(j,"td",{id:"cm_cindent_"+g++,"aria-hidden":"true"})}var t=this,u=0;return b.forEach(this.visibleColumns,function(a){var b=a.scope?"th":"td",c=g++,h=e.createElement(j,b,{id:"cm_cell_"+c,"aria-labelledBy":a.labelElement.id+" cm_cell_"+c,tabIndex:-1,nowrap:"nowrap",role:"gridcell",$cm_lindex:a.logicalIndex});a.scope&&h.attr("scope","row"),t.cellStyleUpdate(h),t.cellRenderer(h,d,f,a,u,i),u++}),e.createElement(j,"td",{"aria-hidden":"true"}),j},rowStyleUpdate:function(a){var b=a;b[0]&&(b=b[0]);var c=b.cm_rowIndex,d=["cm_dataGrid_row","cm_dataGrid_row_"+(c%2?"odd":"even")];b.cm_rowClasses&&d.push.apply(d,b.cm_rowClasses);var e=0;return b._selected&&(e|=1),b.ariaState!=e&&(b.ariaState=e,b._selected?b.setAttribute("aria-selected",b._selected):b.removeAttribute("aria-selected")),f.MixElementClasses(b,d)},cellRenderer:function(a,b,d,f,g,h){var i,j=f.templates;if(j)for(var k=0;k<j.length;k++){var l=j[k],m=f.templatesIE[l.id];if(!m||b.$eval(m)!==!1){var n=l.transclude(a,b);return h.value=!1,f.editable===!1,n}}var o=e.createElement(a,"label",{className:"cm_dataGrid_clabel"}),p=f.valueExpression;return p?(f.$scope.watched?(h.value=!1,b.$watch(f.interpolatedExpression,function(a){o.text(a==c?"":a)})):(p&&(i=p(b)),i&&o.text(i)),o):o},cellStyleUpdate:function(a){var b=a;b[0]&&(b=b[0]);var c=b.cm_lindex,d=this.columns[c],e=[],g=["cm_dataGrid_cell"];return d.visibleIndex||g.push("cm_dataGrid_cfirst"),d.visibleIndex==this.visibleColumns.length-1&&g.push("cm_dataGrid_clast"),d.cellAlign&&e.push("cm_dataGrid_calign_"+d.cellAlign),d.cellClasses&&g.push.apply(g,d.cellClasses),b.cm_cellClasses&&g.push.apply(g,tr.cm_cellClasses),f.MixElementClasses(b,g,e)},computeColumnsNaturalWidths:function(){var a=this.getFirstRow();if(a){var c=a.getBoundingClientRect();if(c.width<1)return!1;var d=a.cells,e=this.rowIndent;b.forEach(this.visibleColumns,function(a){var b=d[a.visibleIndex+e];if(b){var c=b.getBoundingClientRect();a.naturalWidth=c.width}})}},moveColumnRow:function(a,b,c){var d=a.cells,e=a._rowIdent,f=this.visibleColumns,g=b.beforeMovingVisibleIndex,h=d[g+e],i=c&&d[c.beforeMovingVisibleIndex+e];if(i||(i=d[this._lastVisibleColumn.beforeMovingVisibleIndex+e].nextSibling),a.removeChild(h),a.insertBefore(h,i),b.visibleIndex){if(b.visibleIndex==f.length-1){this.cellStyleUpdate(h);var j=d[e+f.length-1];c&&j.id==c.id||this.cellStyleUpdate(j)}}else{this.cellStyleUpdate(h);var k=d[e];c&&k.id==c.id||this.cellStyleUpdate(k)}}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.renderers.grid");d.value("cm_grid_group_animation",0);var e=200;d.factory("camelia.renderers.grid.table",["$log","$q","$timeout","$injector","$interpolate","$exceptionHandler","camelia.core","camelia.cmTypes","cm_grid_rowIndentPx","cm_grid_group_animation",function(a,d,f,g,h,i,j,k,l,m){function n(a){return function(){a.$destroy()}}var o=0;return{tableInstallWatchs:function(){var a=this;this.$scope.$watch("caption",function(c){var d=a.tableElement;if(d){var e=d.getElementsByTagName("caption")[0];if(!e){if(!c)return;e=j.createElement(d,"caption",{className:"cm_dataGrid_caption"})}e.text(b.isString(c)?c:"")}});var c=this.visibleColumns;b.forEach(c,function(a){a.$scope.$watch("title",function(c){var d=a.bodyTitleElement;d&&b.element(d).text(c?c:"")})})},tableRenderer:function(a){var c=j.createElement(a,"div",{id:"cm_table_"+o++,className:"cm_dataGrid_table"});this.tableViewPort=c[0];var d=this;c.on("scroll",function(){d.titleViewPort.scrollLeft=d.tableViewPort.scrollLeft});var e=j.createElement(c,"table",{role:"grid",className:"cm_dataGrid_ttable",cellPadding:0,cellSpacing:0});this.tableElement=e[0];var f=this.$scope.caption;if(f){var g=j.createElement(e,"caption",{className:"cm_dataGrid_caption"});g.text(b.isString(f)?f:"")}var h=this.rowIndent;if(h)for(var i=j.createElement(e,"colgroup",{className:"cm_dataGrid_colgroupIndent","aria-hidden":"true"}),k=0;h>k;k++){var m=j.createElement(i,"col",{className:"cm_dataGrid_colIndent"});m[0].style.width=l+"px"}var n=j.createElement(e,"colgroup",{className:"cm_dataGrid_colgroup"}),p=this.visibleColumns;if(b.forEach(p,function(a){var b=j.createElement(n,"col",{className:"cm_dataGrid_col"});a.bodyColElement=b[0]}),this.hasResizableColumnVisible){var q=j.createElement(n,"col",{"aria-hidden":!0,className:"cm_dataGrid_colSizer"});this.rightColElement=q[0]}for(var r=j.createElement(e,"thead",{className:"cm_dataGrid_thead"}),s=j.createElement(r,"tr"),k=0;h>k;k++)j.createElement(s,"th",{className:"cm_dataGrid_thIndent","aria-hidden":"true"});return b.forEach(p,function(a){var b=j.createElement(s,"th",{id:a.columnId,scope:"col"});a.bodyTitleElement=b[0],0===a.visibleIndex&&h&&(b.colspan=1+h);var c=a.$scope.title;c&&b.text(c)}),this.tableStyleUpdate(c),c},tableDestroy:function(){this.lastDataModel=c,this.lastParametersKey=c},newCriteriasExpression:function(a,c){var d=function(b,d){var e=a.$scope.criteriaValue;if(!e&&(e=a.interpolatedExpression,!e))return!1;for(var f=b.$eval(e),g=a._criterias,h=0;h<g.length;h++){var i=g[h],j=c[i.id];if(j&&i.filterData(j,f,b,d,a)!==!1)return!0}return!1};return d.toJson=function(){{var d=[],e={id:a.$scope.criteriaValue||a.$scope.fieldName||a.$scope.id,filters:d};a._criterias}return b.forEach(c,function(a){b.forEach(a,function(b){if(b.enabled){var c={type:b.type||a.type||b.id};d.push(c);var e=b.toJson&&b.toJson();e&&(c.parameters=e)}})}),d.length?e:null},d},tableClearRows:function(a){f(function(){b.element(a).empty()},50,!1)},tablePrepareDataModel:function(a){var c,d=this.visibleColumns,e=this.$scope.varName,f={varName:e},h=null,i=this;b.forEach(d,function(a){var d=a._criterias;if(d&&d.length){var e=a._criteriasContext,g={},k=0;b.forEach(d,function(a){var c=e[a.id];b.forEach(c,function(b){if(b.enabled){var c=g[a.id];c||(c=[],c.type=a.type,g[a.id]=c),c.push(b),k++}})});var l=!!k,m=a.titleElement;if(m._filtred!=l&&(m._filtred=l,j.BubbleEvent(m,"cm_update")),k){h||(h=[]);var n=i.newCriteriasExpression(a,g);h.push(n);var o=n.toJson();o&&(c||(c=[],f.filters=c),c.push(o))}}});var k,l=this.sorters;if(l&&l.length){k=[];var m=[];f.sorters=m,b.forEach(l,function(a){var b=a.column,c=b.$scope.sorter;c&&(k.push({expression:c,column:b,ascending:a.ascending}),m.push({expression:c,column:b.$scope.id||b.$scope.fieldName||b.id,ascending:a.ascending}))})}var n=this.selectedGroupProvider;n&&(f.groupProvider=n.$scope.id||n.id);var o=b.toJson(f);if(this.lastDataModel===a&&this.lastParametersKey==o)return this.lastDecoratedDataModel;this.lastDataModel=a,this.lastParametersKey=o,this.lastDecoratedDataModel&&(this.lastDecoratedDataModel.$destroyChildren(),this.lastDecoratedDataModel=null),h&&(a.isFilterSupport()||(a=g.invoke(["camelia.FiltredDataModel",function(b){return new b(a,e)}]))),a.setFilters(h),k&&(a.isSortSupport()||(a=g.invoke(["camelia.SortedDataModel",function(b){return new b(a)}]))),a.setSorters(k);var p=!1;n&&(a.isGroupSupport()||(a=g.invoke(["camelia.GroupedDataModel",function(b){return new b(a,n,e)}])),a.setGrouped(p)),a.setDataScope(this.$scope.$parent),this.lastDecoratedDataModel=a;var q=this.dataGrid;return q.rowCount=-1,q.maxRows=-1,q.visibleRows=-1,a},tablePrepareColumns:function(){var a=this,d=this.visibleColumns;b.forEach(d,function(d){var e=d.valueExpression;if(e===c){e=!1;var f=d.$scope.valueRawExpression;if(!f){var g=d.$scope.fieldName||d.$scope.id;g&&(d.$scope.watched?f=h.startSymbol()+"$row."+g+h.endSymbol():e=function(a){return!a.$row,a.$row[g]})}var i=null;f&&(i=a.$interpolate(f),e=function(a){return a.$eval(i)}),d.interpolatedExpression=i,d.valueExpression=e}var j=d.templates;if(j===c){j=[];var k=d.$scope.templates;if(k){var l={};d.templatesIE=l,b.forEach(k,function(b){if("cell"==b.$scope.name){var c=b.$scope.enabledExpresion;if(c){if("false"===c)return;l[b.id]=a.$interpolate(c)}j.push(b)}})}d.templates=j.length?j:!1}})},tableRowsRenderer:function(){var a=this.dataModel;if(!a)return d.when(!1);var c=this,e=b.element(document.createDocumentFragment()),f=this.tableViewPort,g=this.tableRenderer(e);return j.isPromise(g)||(g=d.when(g)),g.then(function(){return c._tableRowsRenderer1(c.tableViewPort,f,e)})},_tableRowsRenderer1:function(a,c,f){function g(a){i._renderedFirst=s,x?(a&&(l.rowCount=s+x),l.maxRows=Math.max(l.maxRows,s+x)):s||(l.rowCount=0,l.maxRows=0),l.visibleRows=x}function h(a){if(!a)return p.setRowIndex(-1),z&&z.$destroy(),A&&A.$destroy(),g(!0),!1;for(var b=!1;0>t||t>x;){var c;if(D){var f=Date.now();f>E&&(E=f+e,D.notify({count:x,rows:t}))}try{var k=p.getRowData();if(q){A||(A=i.$scope.$parent.$new()),A.$group=null,A.$count=null,A.$row=k,F&&(A[F]=k);var l=q.getGroup(A,k);if(l!==B){B=l,C++,b=groupProvider.getCollapsedProvider().contains(l),A.$group=l,A.$count=q.getGroupCount(l);var m={value:!0},o=i.groupRenderer(y,groupProvider,A,C,b,m);o.data("cm_rowValues",q.getGroupValues(l)),o.data("cm_value",l),m.value||(o.on("$destroy",n(A)),o.data("$isolateScope",A),A.$digest(),A=null);var s=o[0];s._visibleIndex=x,s._rowIndex=u}}if(!b){z||(z=i.$scope.$parent.$new()),z.$index=x,z.$odd=!(1&x),z.$even=!z.$odd,z.$first=0===x,z.$pageNumber=-1,z.$pageCount=-1,z.$rowIndex=u,z.$row=k,F&&(z[F]=k);var v={value:!0},w=i.rowRenderer(y,z,u,r,v);w.data("cm_value",k),v.value||(w.on("$destroy",n(z)),w.data("$isolateScope",z),z.$digest(),z=null)}if(u++,x++,t>0&&x>=t)break;p.setRowIndex(u),c=p.isRowAvailable()}catch(G){throw p.setRowIndex(-1),z&&z.$destroy(),A&&A.$destroy(),G}if(j.isPromise(c))return c.then(h);if(c!==!0)break}return p.setRowIndex(-1),z&&z.$destroy(),A&&A.$destroy(),g(t>0&&t>x),d.when(!1)}var i=this,k=this.tableElement,l=this.dataGrid,m=j.createElement(k,"tbody",{className:"cm_dataGrid_tbody",id:"cm_tbody_"+o++});this._alignColumns(!0),this.$scope.$broadcast("cm:pageCreated",{tableViewPort:a,oldTableViewPort:c,fragment:f}),this.tablePrepareColumns();var p=this.dataModel;p=this.tablePrepareDataModel(p);var q=p.getGroup&&p,r=q?1:0,s=l.first,t=l.rows,u=s;b.isNumber(l.maxRows)||(l.maxRows=-1),t>0&&p.setFetchProperties({rows:t});var v=p.getRowCount(!1);0>v&&(v=-1),l.rowCount=v;var w,x=0,y=m[0]||m,z=null,A=null,B=null,C=-1,D=null,E=0,F=this.$scope.varName;try{p.setRowIndex(u),w=p.isRowAvailable()}catch(G){throw p.setRowIndex(-1),z&&z.$destroy(),l.rowCount=-1,l.maxRows=-1,l.visibleRows=x,G}return j.isPromise(w)?(D=null,w.then(h)):h(w)},tableStyleUpdate:function(a){return k.MixElementClasses(a,["cm_dataGrid_table"],["cm_dataGrid_table_scroll"])},tableLayout:function(){},moveColumnTable:function(a,b){function c(c){var e=a[c],f=b&&b[c];f||(f=d._lastVisibleColumn[c].nextSibling);var g=e.parentNode;g.removeChild(e),g.insertBefore(e,f)}var d=this;c("bodyColElement"),c("bodyTitleElement"),this.forEachBodyElement("row",function(c){d.moveColumnRow(c,a,b)})},removeRowsOfGroup:function(a,c){function d(){var a=e.shift();return b.element(a).remove(),e.length?f(d,m,!1):void 0}for(var e=[],g=c.nextSibling;g;){var h=g.nextSibling,i=k.GetCMType(g);if("group"==i)break;m?e.push(g):b.element(g).remove(),g=h}e.length&&f(d,m,!1)},addRowsOfGroup:function(a,c){function d(){var a=p.$scope.$parent.$new(),b={value:!0};try{var j=h.shift();a.$index=e,a.$odd=!(1&e),a.$even=!a.$odd,a.$first=0===e,a.$pageNumber=-1,a.$pageCount=-1,a.$rowIndex=g,a.$row=j,k&&(a[k]=j);var q=p.rowRenderer(i,a,g,l,b);q.data("cm_value",j),b.value||(q.on("$destroy",n(a)),q.data("$isolateScope",a),a.$digest(),a=null),g++,e++}finally{a&&a.$destroy()}return m&&(c.parentNode.insertBefore(i,o),h.length)?f(d,m,!1):void 0}var e=c._visibleIndex,g=c._rowIndex,h=j.CloneArray(b.element(c).data("cm_rowValues"));if(h.length){var i=document.createDocumentFragment(),k=this.$scope.varName,l=this.rowIndent,o=c.nextSibling,p=this;if(!m){for(;h.length;)d();return void c.parentNode.insertBefore(i,o)}f(d,m,!1)}}}}])}(window,window.angular),function(a,b,c){"use strict";var d=32,e=b.module("camelia.renderers.grid");e.factory("camelia.renderers.grid.title",["$log","$timeout","camelia.core","camelia.cmTypes","cm_grid_rowIndentPx","cm_grid_sizerPx","camelia.i18n.Grid",function(a,e,f,g,h,i,j){var k=0;return{titleRenderer:function(a){var c=f.createElement(a,"div",{id:"cm_title_"+k++,className:"cm_dataGrid_title"});this.titleViewPort=c[0];var d=f.createElement(c,"ul",{className:"cm_dataGrid_ttitle"});this.titleBarElement=d[0],this.titleStyleUpdate(c);var e=this.columns,g=0,h=-1,i=[];this.visibleColumns=i,this.hasResizableColumnVisible=!1;var j=this;b.forEach(e,function(a){if(a.logicalIndex=g,a.visibleIndex=-1,a.columnId="cm_column_"+k++,a.scope&&(h>=0?a.scope=!1:h=g),a.visible){var b=f.createElement(d,"li",{id:"cm_tcell_"+k++,$cm_columnIndex:g});a.titleElement=b[0],a.visibleIndex=i.length,b.data("cm_column",a),j.titleCellRenderer(b,a,g),j.titleCellStyleUpdate(b),i.push(a),a.$scope.resizeable&&(j.hasResizableColumnVisible=!0)}g++}),0>h&&e[0]&&(e[0].scope=!0);var l=f.createElement(d,"li",{className:["cm_dataGrid_tcell","cm_dataGrid_tcell_right"],"aria-hidden":!0});return f.createElement(l,"span"),this.titleCellRenderer(l),this.lastTitleCellElement=l[0],c},titleStyleUpdate:function(a){return g.MixElementClasses(a,["cm_dataGrid_title"])},titleCellRenderer:function(a,b){a[0]&&(a=a[0]);var c=a,d=null,e=!1;if(b){var g=k++,h=c,i=f.createElement(h,"button",{className:"cm_dataGrid_tbutton",tabIndex:this.tabIndex,role:"columnheader"});b.buttonElement=i[0],h=i;var j=b.$scope.sorter;if(j){{f.createElement(c,"div",{className:"cm_dataGrid_tcursor"})}c._sortable=!0}var l=(b.$scope.title,f.createElement(h,"label",{id:"cm_tlab_"+g,className:"cm_dataGrid_tlabel"}));b.labelElement=l[0];var m=this;if(b.$scope.$watch("title",function(c){l.text(c?c:""),m.titleAriaMessages(a,b,!0)}),b._criterias&&b._criterias.length){var n=f.createElement(c,"button",{className:"cm_dataGrid_tparams",tabIndex:-1,"aria-hidden":!0,id:"cm_tparams_"+k++});b.parametersElement=n[0],i.attr("aria-expanded",!1),f.createElement(n,"div",{className:"cm_dataGrid_tpArrow"}),f.createElement(n,"div",{className:"cm_dataGrid_tpFiltred"}),e=!0,c._filtreable=!0}var o=b.visibleIndex-1;o>=0&&(d=this.visibleColumns[o])}else d=this.visibleColumns[this.visibleColumns.length-1];var p=f.createElement(c,"div",{className:"cm_dataGrid_tsizer "+(e?"cm_dataGrid_tsizerHP":""),id:"cm_tsizer_"+k++}),q=p[0];b?b.sizerElement=q:this.lastSizerElement=q,d&&f.toBoolean(d.$scope.resizeable)||(q.style.display="none")},titleCellStyleUpdate:function(a){a[0]&&(a=a[0]);var c=a,d=c.cm_columnIndex,e=this.columns[d];this.titleAriaMessages(a,e);var f=null,h=b.isString(e.titleAlign)?e.titleAlign:e.cellAlign;return h&&(f=["cm_dataGrid_talign_"+h]),g.MixElementClasses(a,["cm_dataGrid_tcell"],f)},titleAriaMessages:function(a,b,c){var d=0,e=null;a._sortable&&(d|=1,e="sortableColumn",a._ascending?(d|=2,e="sortAscending"):a._descending&&(d|=4,e="sortDescending")),(c||b._ariaSorter!=d)&&(b._ariaSorter=d,f.setAudioDescription(b.buttonElement,e&&f.lang(j,e),"sorter"));var g=0,h=null;a._filtreable&&(g|=1,h="filtreableColumn",a._filtred&&(d|=2,h="filtredColumn")),(c||b._ariaFiltred!=g)&&(b._ariaFiltred=g,f.setAudioDescription(b.buttonElement,h&&f.lang(j,h),"filtred"))},titleLayout:function(a,f){var g=this;if(this._hasData()&&!this._naturalWidths){var j=this.computeColumnsNaturalWidths();if(j===!1)return e(function(){return g.titleLayout(a,f)},10,!1)}var k=f,l=0,m=0,n=[],o=this.rowIndent;if(this.hasResizableColumnVisible&&(k-=i),b.forEach(this.visibleColumns,function(a){var b=!a.visibleIndex&&o*h,e=a.minWidth||0;(!e||d+b>e)&&(e=d+b),a.computedMinWidth=e;var f=a.specifiedWidthPx;if(f!==c&&f>0)return k-=f,a.width=f,void(a.widthType="specified");var g=a.specifiedWidthPercent;if(g!==c&&g>0)return m++,a.widthType="percent",a.layoutFinished=c,a.width=e,k-=e,a.naturalWidth>e&&(l+=a.naturalWidth-e),void n.push(a);var i=a.naturalWidth||0;i<a.computedMinWidth&&(i=a.computedMinWidth),a.maxWidth&&i>a.maxWidth&&(i=a.maxWidth),a.width=i,k-=i,a.widthType="natural"}),m)for(var p=!0;p&&k>=1;){var q=0;b.forEach(n,function(a){a.layoutFinished||(q+=a.specifiedWidthPercent)});var r=k;b.forEach(n,function(a){if(!a.layoutFinished){var b=r*(a.specifiedWidthPercent/q);b>k&&(b=k);var c=a.width+b;if(a.minWidth&&c<a.minWidth&&(c=a.minWidth),a.maxWidth&&c>a.maxWidth&&(c=a.maxWidth),c==a.width)return void(a.layoutFinished=!0);k-=c-a.width,a.width=c,p=!0}})}else this.fillWidth},titleCellLayout:function(){},moveColumnTitle:function(a,b){var c=a.titleElement,d=b&&b.titleElement;d||(d=this._lastVisibleColumn.titleElement.nextSibling);var e=c.parentNode;e.removeChild(c),e.insertBefore(c,d);for(var g=this.visibleColumns,h=0;h<g.length;h++){var i=g[h].sizerElement,j=h&&f.toBoolean(g[h-1].$scope.resizeable);i.style.display=j?"block":"none"}if(this.lastSizerElement){var j=f.toBoolean(g[h-1].$scope.resizeable);this.lastSizerElement.style.display=j?"block":"none"}},beginMovingTitleCell:function(a){var c=this.titleBarElement,d=c.getBoundingClientRect(),e=c.style;e.height=d.height+"px",b.forEach(this.visibleColumns,function(a){var b=a.titleElement;a._movingLeft=b.offsetLeft});var f=this.lastTitleCellElement.offsetLeft;a.titleElement.style.zIndex="1000",a.titleElement.style.backgroundColor="transparent",b.forEach(this.visibleColumns,function(a){var b=a.titleElement,c=b.style;c.left=a._movingLeft+"px",c.position="absolute"}),e=this.lastTitleCellElement.style,e.left=f+"px",e.height=d.height+"px",e.position="absolute"},movingTitleCell:function(a,d,e,f){var g=a._movingLeft+e;a.titleElement.style.left=g+"px";var h=g+f;this._movingOverColumnIndex=c;var i=this;b.forEach(this.visibleColumns,function(b){var c=b.titleElement;if(c.id!=a.titleElement.id){var d=b._movingLeft;h<b._movingLeft+b.width&&b._movingLeft<a._movingLeft&&(d+=a.width),h>=b._movingLeft&&(b._movingLeft>a._movingLeft&&(d-=a.width),h<b._movingLeft+b.width&&(i._movingOverColumnIndex=b.visibleIndex)),c.style.left=d+"px",c.style.transition="300ms ease-in-out"}})},endMovingTitleCell:function(a){var d=this._movingOverColumnIndex;this._movingOverColumn=c,a.titleElement.style.zIndex="",a.titleElement.style.backgroundColor="",b.forEach(this.visibleColumns,function(a){var b=a.titleElement,d=b.style;d.left="",d.position="",d.transition="",a._movingLeft=c});var e=this.lastTitleCellElement.style;e.left="",e.height="",e.position="";var f=this.titleBarElement;return e=f.style,e.height="",e.width="",d}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.renderers.grid");d.factory("camelia.renderers.grid.utils",["$log","$timeout","camelia.core","camelia.cmTypes",function(a,d,e,f){return{getTableBody:function(){var a=this.tableElement;if(a)return a.tBodies[0]},getFirstRow:function(){var a=this.getTableBody();return a?f.GetNextType(a.firstChild,"row"):null},forEachBodyElement:function(a,b){var c=this.getTableBody();if(c){var d=c.rows;return f.ForEachElement(d,a,b)}},registerElement:function(a,e){if(!this._cacheValues){this._cacheValues=[],this._cacheElements=[],this._cacheFilled=!1;var f=this;d(function(){delete f._cacheValues,delete f._cacheElements,delete f._cacheFilled},50,!1)}e===c&&(e=b.element(a).data("cm_value"),e===c||this._cacheValues.indexOf(e)>=0)||(this._cacheElements.push(a),this._cacheValues.push(e))},getElementFromValue:function(a,c,d){var e=this._cacheValues;if(e){var g=e.indexOf(a);if(g>=0){var h=this._cacheElements[g];if(c){var i=f.GetCMType(h);if(b.isString(c)){if(i!=c)return null}else if(!c[i])return null}return h}if(this._cacheFilled)return null}var j=this,k=null;return this.forEachBodyElement(c,function(c){var e=b.element(c).data("cm_value");return j.registerElement(c,e),e!==a||(k=c,d)?void 0:!1},c),d&&(this._cacheFilled=!0),k}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.renderers.grid");d.value("cm_filtersPopup_className","cm_popup cm_filtersPopup");var e=0,f="rfilter";d.factory("camelia.renderers.FiltersPopup",["$log","$q","$exceptionHandler","$timeout","camelia.core","camelia.cmTypes","cm_filtersPopup_className","camelia.Key","camelia.renderers.Popup",function(a,d,g,h,i,j,k,l,m){function n(a){return j.SearchElements({lfilter:null,ifilter:null,rfilter:null,popup:null},"popup",a)}var o=function(a,b,c,d,e){b=b||{},b.className="cm_filtersPopup",m.call(this,a.$new(!0),b),this._refreshFunc=e,this._column=c,this._dataModel=d,this._closeDestroy=!0};return o.prototype=Object.create(m.prototype),b.extend(o.prototype,{constructor:o,_fillBody:function(a){var c=i.createElement(a,"ul",{className:"cm_filtersPopup_list"}),d=this._column._criterias,g=this._column._criteriasContext,h=this;b.forEach(d,function(a){var d=a.contributeFilters(h.dataModel),j=g[a.id]||{},k={};g[a.id]=k;var l=0;b.forEach(d,function(b){var d=b.id;d||(d=a.id+"__"+l++,b.id=d);var g=j[d];g||(g=b),k[d]=g;var m=e++,n=i.createElement(c,"li",{id:"cm_"+f+"_"+m});n.data("context",g);var o=i.createElement(n,"input",{id:"cm_ifilter_"+m,type:"checkbox",className:"cm_filtersPopup_input","aria-labelledby":"cm_llfilter_"+m,name:d});g.enabled&&(o[0].checked=!0);{var p=i.createElement(n,"div",{id:"cm_lfilter_"+m,$inputTarget:o[0].id});i.createElement(p,"label",{id:"cm_llfilter_"+m,className:"cm_filtersPopup_label","for":o[0].id,textNode:b.name||"### unknown ###"})}b.contributeDOM&&b.contributeDOM(c,g,a,column),h._labelStyleUpdate(p),h._rowStyleUpdate(n)})}),this._popupStyleUpdate(a)},_open:function(a){a.on("keydown",this._onKeyPress()),a.on("mouseover",this._onMouseOver()),a.on("mouseout",this._onMouseOut()),a.on("mouseleave",this._onMouseLeave()),a.on("click",this._onClick()),this._mouseDownListener=this._onMouseDown(),document.body.addEventListener("mousedown",this._mouseDownListener,!0),this._focusListener=this._onFocus(),document.body.addEventListener("focus",this._focusListener,!0),this._blurListener=this._onBlur(),document.body.addEventListener("blur",this._blurListener,!0),a.on("cm_update",this._onStyleUpdate());var b=a.isolateScope(),c=this;b.$on("$destroy",function(){c._close()});var d=a[0].querySelector(".cm_filtersPopup_input");d&&i.setFocus(d)},_close:function(){var a=this._focusListener;a&&(this._focusListener=c,document.body.removeEventListener("focus",a,!0)),a=this._blurListener,a&&(this._blurListener=c,document.body.removeEventListener("blur",a,!0)),a=this._mouseDownListener,a&&(this._mouseDownListener=c,document.body.removeEventListener("mousedown",a,!0))},_popupStyleUpdate:function(a){return j.MixElementClasses(a,["cm_popup","cm_filtersPopup"])},_rowStyleUpdate:function(a){return j.MixElementClasses(a,["cm_filtersPopup_item"])},_labelStyleUpdate:function(a){return j.MixElementClasses(a,["cm_filtersPopup_right"])},_refreshDatas:function(){this._column;this._refreshFunc()},_onMouseOver:function(){var a=this;return function(b){var c=b.target,d=n(c);j.SwitchOnState(a,d,"over")}},_onMouseOut:function(){var a=this;return function(b){var c=b.relatedTarget,d=n(c);j.SwitchOffState(a,d,"over")}},_onMouseLeave:function(){var a=this;return function(b){var c=b.target,d=n(c);j.SwitchOffState(a,d,"over")}},_onFocus:function(){var a=this;return function(b){var c=b.target,d=n(c);return i.log("FiltersPopup.OnFocus ",c,d,b.relatedTarget),d.popup?void j.SwitchOnState(a,d,"focus",function(){}):void a.close()}},_onBlur:function(){var a=this;return function(b){var c=b.relatedTarget,d=n(c);return i.log("FiltersPopup.OnBlur relatedTarget=",c,"target=",b.target,d),c||b.target?void j.SwitchOffState(a,d,"focus"):void a.close()}},_onClick:function(){var a=this;return function(c){var d=c.target,e=n(d);e.ifilter&&(b.element(e.rfilter).data("context").enabled=!!e.ifilter.checked,a._refreshDatas())}},_onMouseDown:function(){var a=this;return function(c){var d=c.target,e=n(d);if(i.log("FiltersPopup.OnMouseDown ",d,e),!e.popup)return a.close(),c.stopPropagation(),void c.preventDefault();if(e.lfilter){var f=document.getElementById(e.lfilter.inputTarget);f.checked=!f.checked,b.element(e.rfilter).data("context").enabled=f.checked,a._refreshDatas(),h(function(){a.close()},!1)}j.SwitchOnState(a,e,"mouseDown",function(){}),c.stopPropagation(),c.preventDefault()}},_onStyleUpdate:function(){var a={popup:"_popupStyleUpdate",rfilter:"_rowStyleUpdate",lfilter:"_labelStyleUpdate"},c=this;return function(d){var e=d.relatedTarget,f=j.GetCMType(e);if(f){var g=b.element(e),h=c[a[f]];return h?(h(g),void d.stopPropagation()):void 0}}},_onKeyPress:function(){var a=this;return function(b){var c=b.target,d=n(c);return d.ifilter?a.performKeyPress_input(d.ifilter,b,d):void 0}},performKeyPress_input:function(a,b,c){var d,e=c.rfilter,g=e.parentNode,k=null,m=this.container,n=this;switch(b.keyCode){case l.VK_DOWN:d=!0;var k=j.GetNextType(e.nextSibling,f);k||(k=j.GetNextType(g.firstChild,f));break;case l.VK_PAGE_DOWN:d=!0,k=j.GetPreviousVisibleType(m,g.lastChild,f),k&&k.id==e.id&&m.scrollHeight>m.offsetHeight&&(m.scrollTop+=m.clientHeight-e.offsetHeight,k=j.GetPreviousVisibleType(m,g.lastChild,f));break;case l.VK_END:d=!0,k=j.GetPreviousType(g.lastChild,f);break;case l.VK_UP:d=!0;var k=j.GetPreviousType(e.previousSibling,f);k||(k=j.GetPreviousType(g.lastChild,f));break;case l.VK_PAGE_UP:d=!0,k=j.GetNextVisibleType(m,g.firstChild,f),k&&k.id==e.id&&(m.scrollTop-=m.clientHeight-e.offsetHeight,k=j.GetNextVisibleType(m,g.firstChild,f));break;case l.VK_HOME:d=!0,k=j.GetNextType(g.firstChild,f);break;case l.VK_ESCAPE:d=!0,h(function(){n.close()},0,!1)}if(k){var a=k.querySelector(".cm_filtersPopup_input");a&&i.setFocus(a)}d&&(b.stopPropagation(),b.preventDefault())}}),o}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.renderers.pager",["camelia.components.pager","camelia.key","camelia.i18n.pager"]);d.value("cm_pager_className","cm_pager"),d.factory("camelia.renderers.Pager",["$log","$q","$exceptionHandler","camelia.core","camelia.cmTypes","cm_pager_className","camelia.Key","camelia.i18n.Pager",function(a,d,e,f,g,h,i,j){function k(a){return g.SearchElements({lpager:null,vpager:null,bpager:null,pager:null},"pager",a)}var l=0,m=function(a){b.extend(this,a)};return m.prototype={render:function(a){var b=this.$scope,c=f.createElement(a,"div",{id:this.pager.id,$cm_type:"pager"});return this.containerElement=c[0],c.on("mouseover",this._onMouseOver()),c.on("mouseout",this._onMouseOut()),c.on("mousedown",this._onMouseDown()),c.on("click",this._onSimpleClick()),c.on("mouseup",this._onMouseUp()),c.on("keydown",this._onKeyPress()),this._offFocus=f.on(c,"focus",this._onFocus(),!0,b),this._offBlur=f.on(c,"blur",this._onBlur(),!0,b),b.$on("$destroy",function(){self._offFocus(),self._offBlur()}),c.on("cm_update",this._onStyleUpdate()),c},_onMouseOver:function(){var a=this;return function(b){var c=b.target,d=k(c);g.SwitchOnState(a,d,"over")}},_onMouseOut:function(){var a=this;return function(b){var c=b.relatedTarget,d=k(c);g.SwitchOffState(a,d,"over")}},_onFocus:function(){var a=this;return function(b){var c=b.target,d=k(c);g.SwitchOnState(a,d,"focus")}},_onBlur:function(){var a=this;return function(b){var c=b.relatedTarget,d=k(c);g.SwitchOffState(a,d,"focus")}},_onMouseDown:function(){var a=this;return function(b){var c=b.target,d=k(c);g.SwitchOnState(a,d,"mouseDown")}},_onMouseUp:function(){var a=this;return function(){var b=k();g.ClearState(a,b,"mouseDown")}},_onKeyPress:function(){return function(a){{var b=a.target;k(b)}}},_onSimpleClick:function(){var a=this;return function(b){var c=b.target,d=k(c),e=d.bpager;e&&e.value&&(a.targetScope.first=parseInt(e.value,10),a.targetScope.$digest())}},_onStyleUpdate:function(){var a={pager:"pagerStyleUpdate",vpager:"valueStyleUpdate",bpager:"buttonStyleUpdate",lpager:"labelStyleUpdate"},c=this;return function(d){var e=d.relatedTarget,f=g.GetCMType(e);if(f){var h=b.element(e),i=c[a[f]];return i?(i.call(c,h),void d.stopPropagation()):void 0}}},pagerPositionsUpdate:function(a){var c=b.element(this.containerElement);c.empty();var d=document.createDocumentFragment();this.renderExpression(d,this.format,a),c.append(d)},renderExpression:function(a,b,d){var e=this.$scope;e.first=d.first,e.rowCount=d.rowCount,e.maxRows=d.maxRows,e.rows=d.rows;for(var f=null,g=0;g<b.length;){var h=b.charAt(g++);if("{"!=h)if("'"!=h)f||(f=new Array),f.push(h);else{f||(f=new Array);for(var i=g;;){var j=b.indexOf("'",i);if(0>j){f.push(b.substring(i)),g=b.length;break}{if("'"!=b.charAt(j+1)){f.push(b.substring(i,j)),g=j+1;break}f.push(b.substring(i,j),"'"),i=j+2}}}else{var j=b.indexOf("}",g),k=b.substring(g,j).toLowerCase();g=j+1,f&&f.length&&(this.renderSpan(a,f.join("")),f=null);var l=c,m=k.indexOf(":");if(m>=0){var n=k.substring(m+1);k=k.substring(0,m),l=new Object;for(var o=n.split(";"),i=0;i<o.length;i++){var p=o[i],q="",r=p.indexOf("=");r>=0&&(q=p.substring(r+1),p=p.substring(0,r)),l[p]=q}}this.renderType(a,k,l)}}f&&f.length&&this.renderSpan(a,f.join(""))},renderSpan:function(a,b){var c=f.createElement(a,"span",{textNode:b,id:"cm_lpager_"+l++});return this.labelStyleUpdate(c),c},renderButton:function(a,b,c,d){var e=f.lang(j,c+"_label",d),g=f.lang(j,c+"_tooltip",d),h=f.createElement(a,"button",{textNode:e,id:"cm_bpager_"+l++,$value:b,$pagerType:c});
return g&&h.attr("title",g),0>b&&h.attr("disabled",!0),this.buttonStyleUpdate(h),h},renderValue:function(a,b,c){var d=f.createElement(a,"span",{textNode:b,id:"cm_vpager_"+l++,$pagerType:c});return this.valueStyleUpdate(d),d},renderType:function(a,b,c){var d=this.$scope,e=d.first,f=d.rowCount,g=d.maxRows,h=d.rows;if(h)switch(b){case"first":case"position":this.renderValue(a,e+1,"first");break;case"last":var i=e+h;f>=0&&i>=f?i=f:g>0&&i>=g&&(i=g),this.renderValue(a,i,"last");break;case"rowcount":if(0>f)return;this.renderValue(a,f,"rowCount");break;case"pagecount":if(0>f||0>=h)return;var j=Math.floor((f-1)/h+1);this.renderValue(a,j,"pageCount");break;case"pageposition":if(0>=h)return;var k=Math.floor(e/h)+1;this.renderValue(a,k,"pagePosition");break;case"bprev":var l=e-h;0>l&&(l=0),this.renderButton(a,e>0?l:-1,"bprev");break;case"bnext":var l=e+h,m=-1;f>=0?(l+h>f&&(l=f-(f+h-1)%h-1,0>l&&(l=0)),l>e&&(m=l)):m=l,this.renderButton(a,m,"bnext");break;case"bpages":this.appendBPages(a,c)}},appendBPages:function(a,b){var c=this.$scope,d=c.first,e=c.rowCount,g=c.maxRows,h=c.rows;if(!g)return void this.renderValue(a,f.lang(j,"noPages"),"noPages");var i=7,k=null;b&&(b.separator&&(k=b.separator),b.pages&&(i=parseInt(b.pages,10)));var l,m=Math.floor(d/h);l=0>e?Math.floor((g+h-1)/h)+1:Math.floor((e+h-1)/h);var n=l;n>i&&(n=i);var o=0;l>n&&(o=m-Math.floor(n/2),o+n>l&&(o=l-n),0>o&&(o=0)),null===k&&(k=f.lang(j,"separator"));for(var p=0;n>p;p++){p>0&&this.renderSpan(a,k,"sep");var q=o+p,r="index",s=q+1;0>e&&q+1==l?(s="...",r="uindex"):q==m&&(r="cindex");var t={pageIndex:q+1};this.renderButton(a,q==m?-1:q*h,r,t)}},pagerStyleUpdate:function(a){var b=h.split(" "),c=this.$scope.className;return c&&b.push(c),g.MixElementClasses(a,b)},labelStyleUpdate:function(a){return a[0]&&(a=a[0]),g.MixElementClasses(a,["cm_pager_label"])},valueStyleUpdate:function(a){return a[0]&&(a=a[0]),g.MixElementClasses(a,["cm_pager_value","cm_pager_value_"+a.pagerType])},buttonStyleUpdate:function(a){return a[0]&&(a=a[0]),g.MixElementClasses(a,["cm_pager_button","cm_pager_button_"+a.pagerType])}},m}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.renderers.popup",["camelia.components.popup","camelia.key"]);d.value("cm_popup_className","cm_popup"),d.factory("camelia.renderers.Popup",["$log","$q","$exceptionHandler","$timeout","$rootScope","camelia.core","camelia.cmTypes","cm_popup_className","camelia.Key",function(a,d,e,f,g,h,i,j){function k(a,b){b&&(this.configuration=b),this._releaseScope=!0,this.$scope=a||g.$new(!0)}var l=0;return k.INITIALIZING=1,k.INITIALIZED=2,k.RENDERING=4,k.RENDERED=8,k.OPENED=16,k.CLOSED=32,k.DESTROYED=64,k.prototype={_setState:function(a,b){var c=this._state&~a|(b||0);this._state!=c&&(this._state=c)},_addState:function(a){this._state&a||(this._state|=a)},containsState:function(a){return a?this._state&a:this._state},initialize:function(){if(this.containsState(k.DESTROYED))throw new Error("Already destroyed");if(!this.containsState(k.INITIALIZING)){this._addState(k.INITIALIZING);var a=this._initialize.apply(this,arguments);h.isPromise(a)||(a=d.when(a));var b=this;return a.then(function(){b._addState(k.INITIALIZED);var a=b.render();return h.isPromise(a)||(a=d.when(a)),a})}},_initialize:function(){},render:function(){if(this.containsState(k.DESTROYED))throw new Error("Already destroyed");if(!this.containsState(k.RENDERING)){this._addState(k.RENDERING),this.$emit("cm:popup_rendering");var a=b.element(document.createDocumentFragment()),c=j;this.configuration.className&&(c+=" "+this.configuration.className);var e=h.createElement(a,"div",{id:"cm_popup_"+l++,className:c});this.container=e[0],e.data("$isolateScope",this.$scope);var f=this._render(b.element(this.container));h.isPromise(f)||(f=d.when(f));var g=this;return f.then(function(){document.body.appendChild(g.container),g._addState(k.RENDERED),g.$emit("cm:popup_rendered")})}},_render:function(a){return this._fillBody(a,a)},open:function(a){function c(){var d=e.container;return d.offsetWidth||d.offsetHeight?(e.$emit("cm:popup_DOMReady"),d.style.display="",e._updatePosition(d,a),e.$emit("cm:popup_opened"),e._addState(k.OPENED),e._open(b.element(d)),d):f(c,10,!1)}var e=this;if(this.containsState(k.DESTROYED))throw new Error("Already destroyed");if(!this.containsState(k.RENDERED)){if(!this.containsState(k.INITIALIZING)){var g=this.initialize();return h.isPromise(g)||(g=d.when(g)),g.then(function(){return e.open(a)})}return null}return this.containsState(k.OPENED)?null:(this._setState(k.CLOSED,0),this._position=a,f(c,10,!1))},_open:function(){},_updatePosition:function(a,c){c=c||{};var d,e;if(b.isNumber(c.X)&&b.isNumber(c.Y))d=c.X,e=c.Y;else if(c.reference){var f=c.reference.getBoundingClientRect();switch(d=f.left,e=f.top,c.halign){case"right":d+=f.width,c.deltaX&&(d+=c.deltaX)}switch(c.valign){case"bottom":e+=f.height,c.deltaY&&(e+=c.deltaY)}}if(!b.isNumber(d))return!1;var g=a.style;return g.left=d+"px",g.top=e+"px",!0},close:function(){if(this.containsState(k.DESTROYED))throw new Error("Already destroyed");if(this.containsState(k.CLOSED)||!this.containsState(k.OPENED))return!1;this._setState(k.OPENED,k.CLOSED);var a=this.container;return a?(a.style.display="none",this._close(b.element(a)),this.$emit("cm:popup_closed"),this._closeDestroy&&this.destroy(),!0):!1},_close:function(){},destroy:function(){if(!this.containsState(k.CLOSED)||this.containsState(k.DESTROYED))return!1;this._setState(k.OPENED,k.DESTROYED);var a=this.container;return a?(this.container=c,b.element(a).remove(),this.$emit("cm:popup_destroyed"),this.$scope&&this._releaseScope&&(this.$scope.$destroy(),this.$scope=c),!0):!1},_fillBody:function(a,b){return b.fillPopup?b.fillPopup(a):void 0},$emit:function(){this.$scope&&this.$scope.$emit.apply(this.$scope,arguments)}},k}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.directives.grid",["camelia.core","camelia.components.template"]);c.value("cm_grid_componentProviderName","camelia.components.grid:camelia.components.GridProvider"),c.directive("cmDatagrid",["$injector","$interpolate","$log","$q","camelia.core","cm_grid_componentProviderName","camelia.components.Template",function(a,b,c,d,e,f,g){return{restrict:"E",scope:{dataModelProvider:"=?",dataModelProviderName:"@datamodelprovider",componentProvider:"=?",componentProviderName:"@componentprovider",rendererProvider:"=?",rendererProviderName:"@rendererprovider",selectionProvider:"=?",selectionProviderName:"@selectionprovider",value:"=",varName:"@var",style:"@",className:"@class",caption:"@",tabIndex:"@",id:"@",selection:"=?",cursor:"=?",columnCursor:"=?",first:"=?",rows:"=?",rowCount:"=?rowcount",selectable:"@",selectionCardinality:"@selectioncardinality"},replace:!0,controller:["$scope",function(a){var b=a.componentProvider;if(!b){var c=a.componentProviderName||f;b=e.LoadProvider(c)}this.componentProvider=b,a.columns=[],this.appendColumn=function(b){a.columns.push(b)},this.getColumnIndex=function(){return a.columns.length},a.groupProviders=[],this.appendGroupProvider=function(b){a.groupProviders.push(b)},this.getProviderIndex=function(){return a.groupProviders.length}}],compile:function(){return{pre:function(a,c,d,e){a.rowClassRawExpression=c.attr("rowClass");var f=new e.componentProvider.DataGrid(a,c,b);e.dataGrid=f,g.markContainer(c,a)},post:function(b,f,g,h){var i=h.dataGrid,j=a.invoke(i.construct,i);e.isPromise(j)||(j=d.when(j)),j.then(function(a){c.info("Table created ",a),f.replaceWith(a)},function(a){c.error("Failed to create table ",a)})}}}}}]),c.directive("cmDatacolumn",["camelia.core","camelia.components.Template",function(a,c){return{require:"^cmDatagrid",restrict:"E",replace:!0,scope:{id:"@",visible:"@",titleAlign:"@titlealign",cellAlign:"@cellalign",width:"@",maxWidth:"@maxwidth",minWidth:"@minwidth",title:"@",cellClass:"@",columnClass:"@",sorter:"@",resizeable:"@",checkable:"@",fieldName:"@fieldname",checkList:"=?",columnImageURL:"@columnimageurl",cellImageURL:"@cellimageurl",criteriaValue:"@criteriavalue",watched:"@",editable:"@"},controller:function(){this.criterias=[]},compile:function(){return{pre:function(a,b){a.valueRawExpression=b.attr("text")||b.attr("value"),c.markContainer(b,a)},post:function(a,c,d,e){if(a.fieldName&&/[^\w]/.test(a.fieldName))throw new Error("Invalid fieldName expression '"+a.fieldName+"' use value='{{"+a.fieldName+"}}' instead !");var f=c.controller("cmDatacolumn"),g=new e.componentProvider.DataColumn(a,e.getColumnIndex()+1);b.forEach(f.criterias,function(a){g.addCriteria(a)}),e.appendColumn(g)}}}}}]),c.directive("cmDatagroup",["camelia.core","camelia.components.Template",function(a,b){return{require:"^cmDatagrid",restrict:"E",scope:{title:"@",value:"@",closeable:"@",disabled:"@",collapsedGroups:"=?collapsedgroups",className:"@class",sorter:"@"},compile:function(){return{pre:function(a,c){a.titleRawExpression=c.attr("title"),a.titleClassRawExpression=c.attr("titleclass"),a.valueRawExpression=c.attr("value"),b.markContainer(c,a)},post:function(a,b,c,d){var e=new d.componentProvider.DataGroup(a,datagridController.getProviderIndex()+1);d.appendGroupProvider(e)}}}}}]),c.directive("cmCriteria",["camelia.core","$log","$injector",function(a,c,d){return{require:"^cmDatacolumn",restrict:"E",scope:{type:"@"},compile:function(){return{pre:function(){},post:function(a,e,f,g){var h=a.type;if(!b.isString(h)||!h.length)throw new Error("Invalid criteria type ("+h+")");var i,j=h.indexOf(".");i=j>=0?h:"camelia.criteria."+h;var k=g.criterias;try{d.invoke([i,function(b){var c=new b(a,e,f);k.push(c)}])}catch(l){c.error("Can not instantiate criteria '"+i+"'",l)}}}}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.directives.pager",["camelia.core","camelia.components.template"]);c.value("cm_pager_componentProviderName","camelia.components.pager:camelia.components.Pager"),c.directive("cmPager",["$injector","$interpolate","$log","$q","camelia.core","cm_pager_componentProviderName","camelia.components.Template",function(a,b,c,d,e,f,g){return{restrict:"E",scope:{forElementId:"@for",target:"=?",style:"@",className:"@class",caption:"@",tabIndex:"@",id:"@",format:"=?"},replace:!0,controller:["$scope",function(a){var b=a.componentProvider;if(!b){var c=a.componentProviderName||f;b=e.LoadProvider(c)}this.componentProvider=b}],compile:function(){return{pre:function(a,b){g.markContainer(b,a)},post:function(b,f,g,h){var i=new h.componentProvider(b,f),j=a.invoke(i.construct,i);e.isPromise(j)||(j=d.when(j)),j.then(function(a){c.info("Pager created ",a),f.replaceWith(a)},function(a){c.error("Failed to create pager ",a)})}}}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.directives.template",["camelia.components.template"]);c.directive("cmTemplate",["$log","camelia.components.Template",function(a,b){return{require:"^cmTemplateContainer",restrict:"E",scope:{name:"@"},transclude:!0,compile:function(){return{pre:function(a,b){a.enabledExpresion=b.attr("enabled")},post:function(a,c,d,e,f){new b(a,c,e,f);c.remove()}}}}}])}(window,window.angular),function(a,b){"use strict";b.module("camelia.animations.grid",["camelia.animations"])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.animations",["camelia.core"]);d.factory("camelia.animations.Animation",["$log","$timeout","$rootScope","camelia.core",function(a,b,d,e){var f=e.getProto(d),g=function(a,d){e.inheritScope(this,a),this._params=d;var f=this;this.$on("$destroy",function(){f._params=c;var a=f._showTimerPromise;a&&b.cancel(a)})};return g.newInstance=function(a,b,c){var d=e.LoadProvider(a);if(!d)throw new Error("Can not animation '"+a+"'");return new d(b,c)},e.extendProto(g,f,{start:function(){if(this._timeout){var a=this;this._showTimerPromise=b(function(){a.end("timeout")},this._timeout,!1)}this._processStart()},_processStart:function(){},cancel:function(){if(!this.canceled&&!this.ended){this.canceled=!0;var a=this._showTimerPromise;a&&(this._showTimerPromise=null,b.cancel(a)),this._processCancel()}},_processCancel:function(){this._destroy()},end:function(a){if(!this.ended&&!this.canceled){this.ended=!0;var c=this._showTimerPromise;c&&(this._showTimerPromise=null,b.cancel(c)),this._processEnd(a)}},_processEnd:function(){this._destroy()},_destroy:function(){var a=this;b(function(){a.$destroy()},0,!1)}}),g}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.animations.grid");d.factory("camelia.animations.grid.PageChange",["$log","$timeout","camelia.animations.Animation","camelia.core",function(a,d,e,f){var g=function(a,b){e.call(this,a,b),this.renderer=b.renderer,this._timeout=this._params.timeout||500;var c=this,d=a.$on("cm:pageCreated",function(a,b){c._args=b,d()})};return f.extend(g,e,{_processStart:function(){this._hideBody();var a=this.renderer,c=a.container,e=c.style.height;if(!e||"auto"==e){this._forceHeight=!0;var g=c.getBoundingClientRect();c.style.height=g.height+"px"}var h=a.tableViewPort;h&&(this._oldTableViewPort=h);var i=f.createElement(a.bodyContainer,"div",{className:"pageSeparator"});i=i[0],this._pageSeparator=i,i.style.visibility="hidden";var j=this;this._targetY=0,d(function k(){var a=i.getBoundingClientRect();if(!a.height)return d(k,10,!1);var b=parseInt(h.style.top||"0",10),c=h.getBoundingClientRect();i.style.width=c.width+"px";var e=0;j._params.oldFirst>j._params.first?(e=b-a.height,j._targetY-=a.height):(e=b+c.height,j._targetY+=a.height),i.style.top=e+"px",i.style.visibility="visible"},10,!1),this._animation=d(function l(){function a(a){if(a){var b=a.style;b.top=parseInt(b.top||"0",10)+c+"px"}}console.log("Animation="+j._targetY);var c=0;if(j._targetY<0?c=Math.max(j._targetY,-48):j._targetY>0&&(c=Math.min(j._targetY,48)),j._targetY-=c,c)a(h),a(j._args.tableViewPort),a(i);else if(j._stopAnim)return b.element(i).remove(),void b.element(h).remove();return d(l,50,!1)},50,!1)},_processEnd:function(){var a=this._args.tableViewPort,e=(this._oldTableViewPort,this._args.fragment||a),f=this._pageSeparator,g=this.renderer;b.element(g.bodyContainer).append(e),g.tableElement.style.tableLayout="fixed",a.style.visibility="hidden";var h=this;d(function i(){var b=a.getBoundingClientRect();if(!b.height)return d(i,10,!1);var e=f.getBoundingClientRect(),j=g.titleViewPort.getBoundingClientRect(),k=j.height+b.height;g.container.style.height=k+"px",g.bodyContainer.style.height=b.height+"px";var l=0,m=(b.height+e.height,parseInt(f.style.top,10));h._params.oldFirst>h._params.first?(l=m-b.height,h._targetY-=b.height):h._params.oldFirst===c?l=m+e.height:(l=m+e.height,h._targetY+=b.height),h._stopAnim=!0,a.style.top=l+"px",a.style.visibility="visible"},10,!1),this._showBody()},_hideBody:function(){{var b=this.renderer;b.tableViewPort.style}a.debug("Hide body")},_showBody:function(){{var b=this.renderer;b.tableViewPort.style}a.debug("Show body")}}),g}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.animations.grid");c.factory("camelia.animations.grid.Waiting",["$log","camelia.animations.grid.GridPageChange","camelia.core",function(a,b,c){var d=function(a,c){b.call(this,a,c),this.renderer=c.renderer,this._timeout=0;var d=this,e=a.$on("cm:pageCreated",function(a,b){var c=b.tbody;c[0]&&(c=c[0]),d._tbody=c,e()})};return c.extend(d,b,{_processStart:function(){this._hideBody();var a=this.renderer,b=a.container;if(!b.style.height||b.style.height.indexOf("px")<0){this.forceHeight=!0;var c=b.getBoundingClientRect();b.style.height=c.height+"px"}var d=a.tableTBody;d&&(d.parentNode.removeChild(d),a.tableClearRows(d))},_processEnd:function(){var a=this._tbody,b=this.renderer;b.tableTBody=11==a.nodeType?a.firstChild:a,b.tableElement.appendChild(a),this.forceHeight&&(b.container.style.height="auto",b.tableViewPort.style.height="auto"),this._showBody()},_hideBody:function(){var b=this.renderer,c=b.tableViewPort.style;c.width="auto",c.visibility="hidden",b.tableElement.style.tableLayout="",a.debug("Hide body")},_showBody:function(){var b=this.renderer,c=b.tableViewPort.style;b.tableElement.style.tableLayout="fixed",c.visibility="",a.debug("Show body")}}),PageChange}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.criteria",[]);c.factory("camelia.i18n.Criteria",[function(){return{en:{alphabetic_others:"Others"}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.criteria");c.config(["$provide",function(a){a.decorator("camelia.i18n.Criteria",["$delegate",function(a){return b.extend(a,{fr:{alphabetic_others:"Autres"}})}])}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.grid",[]);c.factory("camelia.i18n.Grid",[function(){return{en:{sortableColumn:"(Sortable)",ascending:"(Sorted order ascending)",descending:"(Sorted order descending)",filtreableColumn:"",filtredColumn:"(Filtred)"}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.grid");c.config(["$provide",function(a){a.decorator("camelia.i18n.Grid",["$delegate",function(a){return b.extend(a,{fr:{sortableColumn:"(Triable)",ascending:"(Trié ordre croissant)",descending:"(Trié ordre decroissant)",filtreableColumn:"",filtredColumn:"(Filtrée)"}})}])}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.pager",[]);c.factory("camelia.i18n.Pager",[function(){return{en:{bfirst_label:"First",blast_label:"Last",bprev_label:"<",bprev_tooltip:"Show previous page",bnext_label:">",bnext_tooltip:"Show next page",index_label:"{pageIndex}",index_tooltip:"Show page #{pageIndex}",cindex_label:"{pageIndex}",cindex_tooltip:"Current page #{pageIndex}",uindex_label:"...",uindex_tooltip:"Show next page",separator:" ",noPages:"No pages"}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.pager");c.config(["$provide",function(a){a.decorator("camelia.i18n.Pager",["$delegate",function(a){return b.extend(a,{fr:{bfirst_label:"Premier",blast_label:"Dernier",bprev_label:"Précédent",bprev_tooltip:"Voir la page précédente",bnext_label:"Suivant",bnext_tooltip:"Voir la page suivante",index_label:"{pageIndex}",index_tooltip:"Voir page #{pageIndex}",cindex_label:"{pageIndex}",cindex_tooltip:"Page courrante #{pageIndex}",uindex_label:"...",uindex_tooltip:"Voir la page suivante",separator:" ",noPages:"Aucune page"}})}])}])}(window,window.angular);
//# sourceMappingURL=dist/camelia.min.js.map