/* Camelia (c) 2016 Vedana http://www.vedana.com
 License: Creative Commons - The licensor permits others to copy, distribute, display, and perform the work. In return, licenses may not use the work for commercial purposes -- unless they get the licensor's permission.
 Author: olivier.oeuillot@vedana.com */

!function(a,b,c){"use strict";var d=b.module("camelia.core",[]);d.factory("camelia.core",["$q","$rootScope","$log","$exceptionHandler","$injector","$timeout",function(a,d,e,f,g,h){function i(a){return parseInt(a,10)}var j,k=/([\\\/\.\*\+\?\|\(\)\[\]\{\}\-\^])/g;return{EMPTY_IMAGE_SRC:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",Assert:function(a,b){if(!a){var c=Array.prototype.slice.call(arguments,2);c.unshift("Assert error:'",b||"?","':");var d=this.format(c),e=new Error(d);f(e)}},IsMSIE:function(){if(j!==c)return j;var a=navigator.userAgent.toLowerCase();return j=i((/msie (\d+)/.exec(a)||[])[1]),isNaN(j)&&(j=i((/trident\/.*; rv:(\d+)/.exec(a)||[])[1])),j},createElement:function(a,d,e){a.injector&&(a=a[0]);var f;a.nodeType===Node.DOCUMENT_NODE?(f=a,a=f.body.parentNode):f=a.ownerDocument;for(var g,h=1;h<arguments.length;){d=arguments[h++],e=arguments[h++],this.Assert("string"==typeof d,"createElement","Invalid 'tagName' parameter ("+d+")"),this.Assert(e===c||"object"==typeof e,"createElement","Invalid properties parameter ("+e+")"),this.IsMSIE()<=6&&"input"===d.toLowerCase()&&e&&e.type&&e.name?(g=f.createElement('<input name="'+e.name+'" type="'+e.type+'">'),delete e.name,delete e.type):g=f.createElement(d);var i=null,j=null;if(e)for(var k in e){var l=e[k];switch(k.toLowerCase()){case"classname":case"styleclass":case"class":b.isArray(l)&&(l=l.join(" ")),g.className=l;break;case"textnode":i=l;break;case"innerhtml":j=l;break;case"role":case"aria-live":case"aria-atomic":case"aria-relevant":g.setAttribute(k,l);break;case"style":for(var m=l.split(";"),n=0;n<m.length;n++){var o=m[n].split(":"),p=this.trim(o[0]),q=this.trim(o[1]);g.style[p]=q}break;default:if(l===c)break;if(!k.indexOf("css")){g.style[k.substring(3,4).toLowerCase()+k.substring(4)]=l;break}switch(typeof l){case"function":case"object":"$"===k.charAt(0)&&(k=k.substring(1)),g[k]=l;break;default:"$"!==k.charAt(0)?g.setAttribute(k,l):g[k.substring(1)]=l}}}a.appendChild?a.appendChild(g):a.append(g),null!==i&&g.appendChild(f.createTextNode(i)),null!==j&&(g.innerHTML=j),a=g}return b.element(g)},MixClasses:function(a,b,c,d){function e(a,b,d){for(var f=d;f<c.length;){var g=b+c[f++];a.push(g),e(a,g,f)}}for(var f=[],g=0;g<b.length;g++){var h=this.trim(b[g]);h&&(f.push(h),c&&e(f,h,0))}a[0]&&(a=a[0]),d&&(f=f.concat(d));var i=f.join(" ");return a.className===i?!1:(a.className=i,!0)},BubbleEvent:function(){},format:function(a){var d=[],e=[],f=this,g=function(a){b.forEach(a,function(a){if(b.isElement(a))return void e.push(a.tagName+"."+a.className+"#"+a.id);if(null===a)return void e.push("null");if(a===c)return void e.push("undefined");if(b.isFunction(a))return void e.push("<<FUNC>>");if(f.isPromise(a))return void e.push("<<PROMISE>>");if(f.isWindow(a))return void e.push("<<WINDOW>>");if(b.isObject(a)){for(var h=0;h<d.length;h++)if(d[h]===a)return void e.push("**cycle**");d.push(a),e.push("{");var i=!0;return b.forEach(a,function(a,b){i?i=!1:e.push(","),e.push(b+":"),g([a])}),void e.push("}")}e.push(String(a))})};return g(a),e.join(" ")},log:function(){var a=this.format(arguments);e.info(a)},trim:function(a){return a.trim()},CloneArray:function(a){return a?a.slice?a.slice():Array.prototype.slice.call(a):a},LoadProvider:function(a){var c=g,d="",f=a.indexOf(":");if(f>0&&(d=a.substring(0,f),a=a.substring(f+1),!c.has(a)))throw c=b.injector(["ng","camelia.core",d]),new Error("Provider '"+d+"' is not in the context !");var h=c.get(a);if(h)return h;var i=new Error("Can not find provider='"+a+"' moduleName='"+d+"'");throw e.error(i),i},CloneAttributes:function(a){for(var b={},c=a[0].attributes,d=0;d<c.length;d++){var e=c[d];b[e.name]=e.value}return b},isPromise:function(a){return a&&b.isFunction(a.then)},isWindow:function(a){return a&&a.document&&a.location&&a.alert&&a.setInterval},isScope:function(a){return a&&a.$evalAsync&&a.$watch},ensurePromise:function(b){return this.isPromise(b)?b:a.when(b)},toBoolean:function(a,b){if(a===!0)return a;if(a&&a.length){var c=a.toLowerCase();return!("f"===c||"0"===c||"false"===c||"no"===c||"n"===c||"[]"===c)}return!!b},appendTextNode:function(a,b,c){if(b)for(var d=0;;){var e=b.indexOf("\n",d);if(0>e){a.appendChild(document.createTextNode(b.substring(d)));break}e>d+1&&(c||e++,a.appendChild(document.createTextNode(b.substring(d,e)))),c&&a.appendChild(document.createElement("br")),d=e+1}},setFocus:function(a){a[0]&&(a=a[0]);try{a.focus()}catch(b){e.error(b)}},lang:function(a,b,d){var e=a.en[b];if(!e||!d)return e;for(var f=[],g=/\{\w+\}/g,h=0;;){var i=g.exec(e);if(!i)break;i.index&&f.push(e.substring(h,i.index));var j=d[i[0].substring(1,i[0].length-1)];f.push(j===c?"?":j),h=g.lastIndex}return h?(f.push(e.substring(h)),f.join("")):e},setAudioDescription:function(a,c,d){a[0]&&(a=a[0]),d||(d="main");for(var e=a.querySelectorAll(".cm_audioDescription"),f=0;f<e.length;f++){var g=e[f];if(g.type===d){var h=b.element(g).empty();return void(c&&h.text(c))}}c&&this.createElement(a,"SPAN",{className:"cm_audioDescription",$type:d,textnode:c})},getProto:function(a){return Object.getPrototypeOf&&Object.getPrototypeOf(a)||a.__proto__},extend:function(a,b,c){return this.extendProto(a,b.prototype,c)},extendProto:function(a,c,d){var e=Object.create(c);return a.prototype=e,b.extend(e,d||{}),e.constructor=a,e.$super=c,a},on:function(a,b,c,e,f,g){a[0]&&(a=a[0]);var i=function(a){var b=this;try{if(g!==!1)return h(function(){c.call(b,a),(f||d).$apply()},0,!1);var e;return(f||d).$apply(function(){e=c.call(b,a)}),e}catch(i){console.log(i)}};a.addEventListener(b,i,e);var j=function(){a.removeEventListener(b,i,e)};return f&&f.$on("$destroy",j),j},escapeRegexp:function(a){return a?a.replace(k,"\\$1"):""},callPromise:function(a,b,c){return function(){var d=a.call(b,c);return d}}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.selection",["camelia.core"]);c.factory("camelia.CursorProvider",["$rootScope","camelia.core","camelia.ScopeWrapper",function(a,b,c){function d(a){c.call(this,a.$new(!0))}return d.CURSOR_REQUESTED="cm:cursorRequested",d.CURSOR_CHANGED="cm:cursorChanged",b.extend(d,c,{getRow:function(){var a=this._rowCursor;return a},getColumn:function(){var a=this._columnCursor;return a},setCursor:function(a,b,c){if(this._rowCursor!==a||this._columnCursor!==b){var e=this._rowCursor,f=this._columnCursor;this._rowCursor=a,this._columnCursor=b,this.$emit(d.CURSOR_CHANGED,{row:a,column:b,oldRow:e,oldColumn:f,sourceEvent:c})}},requestCursor:function(a,b,c){this.setCursor(a,b,c)}}),d}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.core"),d=[/[áãàâäåāăąȁȃȧǎǟǡ]/g,"a",/[æǣǽ]/g,"ae",/[çćĉċč]/g,"c",/[éèêëēĕėęěȅȇȩ]/g,"e",/[íìîïĩīĭįıȉȋǐ]/g,"i",/[ĳ]/g,"ij",/[ñńņňŉŋ]/g,"n",/[óõòôöōŏőȍȏǒȫȭȯȱ]/g,"o",/[œ]/g,"oe",/[úùûüµũūŭůűųǔǖǘǚǜ]/g,"u",/[ýÿŷȳ]/g,"y",/[ÀÁÂÃÄÅĀĂĄȀȂȦǍǞǠ]/g,"A",/[ÆǢǼ]/g,"AE",/[ÇĆĈĊČ]/g,"C",/[ÈÉÊËĒĔĖĘĚȄȆȨ]/g,"E",/[ÌÍÎÏĨĪĬĮİȈȊǏ]/g,"I",/[Ĳ]/g,"IJ",/[ÑŃŅŇŊ]/g,"N",/[ÓÔÕÖÒŌŎŐȌȎǑȪȬȮȰ]/g,"O",/[ŔŖŘ]/g,/[Œ]/g,"OE","R",/[ÙÚÛÜŨŪŬŮŰŲǓǕǗǙǛ]/g,"U",/[ÝŶŸȲ]/g,"Y"];c.factory("camelia.CharsetUtils",["$log",function(a){return{removeAccents:function(b){for(var c=d,e=b,f=0;f<c.length;){var g=c[f++],h=c[f++];e=e.replace(g,h)}return a.debug("remove accents  of '"+b+"' to '"+e+"'"),e}}}])}(window,window.angular),function(a,b){"use strict";var c=0,d=b.module("camelia.core");d.factory("camelia.cmTypes",["camelia.core",function(a){var d=/cm_([a-z]*)_.*/i;return{GetCMType:function(a){if(!a||a.nodeType!==Node.ELEMENT_NODE)return null;var b=a.cm_type;if(b)return b;var c=a.id;if(!c)return null;var e=d.exec(c);return e?b=e[1]:null},SearchElements:function(a,b,c){for(;c;c=c.parentNode){var d=this.GetCMType(c);if(d&&(a[d]=c,d===b))break}return a},MixElementClasses:function(b,c,d){b[0]&&(b=b[0]),a.MixClasses(b,c,null,d)},ForEachElement:function(a,c,d){for(var e=!b.isString(c),f=a.length,g=0;f>g;g++){var h=a[g],i=this.GetCMType(h);if(i){if(e){if(!c[i])continue}else if(i!==c)continue;if(d(h,i)===!1)return!1}}},GetPreviousVisibleType:function(a,b,c,d){if(a[0]&&(a=a[0]),a.offsetHeight===a.scrollHeight)return this.GetPreviousType(b,c,d);var e=a.scrollTop,f=a.clientHeight,g=null;return this.GetPreviousType(b,c,function(a,b){return g?void 0:d&&d(a,b)!==!0?!1:void(a.offsetTop+a.offsetHeight/2-e>f||(g=a))}),g},GetPreviousType:function(a,c,d){for(var e=!b.isString(c);a;a=a.previousSibling)if(a.nodeType===Node.ELEMENT_NODE){var f=this.GetCMType(a);if(f){if(e){if(!c[f])continue}else if(f!==c)continue;if(!d||d(a,f)===!0)return a}}return null},GetNextVisibleType:function(a,b,c,d){if(a[0]&&(a=a[0]),a.offsetHeight===a.scrollHeight)return this.GetNextType(b,c,d);var e=a.scrollTop,f=null;return this.GetNextType(b,c,function(a,b){return f?void 0:d&&d(a,b)!==!0?!1:void(a.offsetTop+a.offsetHeight/2<e||(f=a))}),f},GetNextType:function(a,c,d){for(var e=!b.isString(c);a;a=a.nextSibling)if(a.nodeType===Node.ELEMENT_NODE){var f=this.GetCMType(a);if(f){if(e){if(!c[f])continue}else if(f!==c)continue;if(!d||d(a,f)===!0)return a}}return null},SwitchOnState:function(d,e,f,g){var h="_"+f,i="cm"+h;b.forEach(e,function(b,c){var e=c+"_"+f,g=d[e];if(g&&(!b||g!==b.id)){d[e]=null;var h=document.getElementById(g);h&&h.hasAttribute(i)&&(h.removeAttribute(i),a.BubbleEvent(h,"cm_update"))}}),b.forEach(e,function(b,e){if(b){var g=e+"_"+f;if(!d[g]){var h=b.id;h||(h="__cm_types_"+c++,b.id=h),d[g]=h,b.hasAttribute(i)||(b.setAttribute(i,!0),a.BubbleEvent(b,"cm_update"))}}}),g&&g(e)},SwitchOffState:function(c,d,e,f){var g="_"+e,h="cm"+g;b.forEach(d,function(b,d){var f=d+"_"+e,g=c[f];if(g&&(!b||g!==b.id)){c[f]=null;var i=document.getElementById(g);i&&i.hasAttribute(h)&&(i.removeAttribute(h),a.BubbleEvent(i,"cm_update"))}}),f&&f(d)},ClearState:function(c,d,e,f){var g="_"+e,h={},i="cm"+g;b.forEach(d,function(b,d){var f=d+"_"+e,g=c[f];if(g){c[f]=null;var j=document.getElementById(g);j&&j.hasAttribute(i)&&(j.removeAttribute(i),h[d]=j,a.BubbleEvent(j,"cm_update"))}}),f&&f(h)}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.core");c.factory("camelia.Key",[function(){return{VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_SEMICOLON:59,VK_EQUALS:61,VK_CONTEXTMENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,KF_SHIFT:1,KF_CONTROL:2,KF_ALT:4,KF_META:8}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.pagerRegistry",["camelia.core"]);c.factory("camelia.PagerRegistry",["$log","$q","camelia.core",function(a,c){var d=b.element(document),e=d.controller("cmPagerRegistry");e||(e={promisesByTargetId:{}},d.data("$cmPagerRegistryController",e));var f=e.promisesByTargetId,g={RegisterWaitingFor:function(a,d){var e=f[d],g=document.getElementById(d);if(g&&g.cmPagerRegistred)return delete f[d],e&&b.forEach(e,function(a){a.resolve(g)}),c.when(g);e||(e=[],f[d]=e);var h=c.defer();e.push(h);var i=a.$on("$destroy",function(){var a=e.indexOf(h);return 0>a?void i():(e.length>1?e.splice(a,1):delete f[d],h.reject("Pager destroyed"),void i())});return h.promise},DeclareTarget:function(a){a[0]&&(a=a[0]),a.cmPagerRegistred=!0;var c=a.id,d=f[c];delete f[c],d&&b.forEach(d,function(b){b.resolve(a)})}};return g}])}(window,window.angular),function(a,b){"use strict";var c=!0,d=b.module("camelia.core");d.factory("camelia.ScopeWrapper",["$rootScope","camelia.core",function(){function a(a){this.$scope=a,c&&(a.$cmLink=this)}return["$destroy","$emit","$broadcast","$on","$eval","$evalSync","$digest"].forEach(function(b){a.prototype[b]=function(){var a=this.$scope;return a[b].apply(a,arguments)}}),a.prototype.toString=function(){return"[Scoped object $id="+this.$scope.$id+"]"},a}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.selection");d.factory("camelia.SelectionProvider",["$rootScope","$injector","camelia.core","camelia.ScopeWrapper",function(a,d,e,f){function g(b){f.call(this,(b||a).$new(!0))}return g.SELECTION_CHANGING_EVENT="cm:selectionChanging",g.SELECTION_CHANGED_EVENT="cm:selectionChanged",g.SELECTION_SET_EVENT="cm:selectionSet",g.From=function(a,e){var f=d.invoke(["camelia.ArraySelectionProvider",function(a){return a}]);return a===c?new f(e,[]):b.isArray(a)?new f(e,a):new f(e,[a])},e.extend(g,f,{_lock:!1,get:function(){return null},getFirstElement:function(){return null},set:function(a){if(a===c||b.isArray(a)||(a=arguments),!this._lock){var d=this;return this.run(function(){return d._processSet(a)})}return this._processSet(a)},_processSet:function(){return-1},add:function(a){if(b.isArray(a)||(a=arguments),!this._lock){var c=this;return this.run(function(){return c._processAdd(a)})}return this._processAdd(a)},_processAdd:function(){return-1},remove:function(a){if(b.isArray(a)||(a=arguments),!this._lock){var c=this;return this.run(function(){return c._processRemove(a)})}return this._processRemove(a)},_processRemove:function(){return-1},clear:function(){if(!this._lock){var a=this;return this.run(function(){return a._processClear()})}return this._processClear()},_processClear:function(){return-1},run:function(a){var b=this._lock;b||(this._lock=!0,this._startLock());var c;try{c=a()}finally{b||(this._lock=b,this._endLock())}return c},_startLock:function(){this.$broadcast("cm:startLock")},_endLock:function(){this.$broadcast("cm:endLock")},contains:function(){return!1},containsAll:function(){return!1},count:function(){return-1}}),g}]),d.factory("camelia.ArraySelectionProvider",["camelia.core","camelia.SelectionProvider",function(a,d){function e(a,b){d.prototype.constructor.call(this,a),this._array=b}function f(a,c,d,e,f){f&&f.length&&b.forEach(f,function(b){if(e){var f=e.indexOf(b);f>=0&&e.splice(f,1)}if(d){var g=d.indexOf(b);if(g>=0)return void d.splice(g,1)}a&&a.indexOf(b)<0&&(a.push(b),c&&c.indexOf(b)<0&&c.push(b))})}return e.prototype=Object.create(d.prototype),b.extend(e.prototype,{constructor:e,_array:[],get:function(){return this._array},getFirstElement:function(){var a=this.get();return a&&a.length?a[0]:c},_processList:function(b){var c=this._array;c||(c=[],this._array=c),this._targetArray||(this._targetArray=this._array?a.CloneArray(this._array):[],this._added=[],this._removed=[]);var d=this._added.length,e=this._removed.length;return b.call(this),this._added.length-d+(e-this._removed.length)},_processSet:function(b){return b===this._array?0:this._processList(function(){return f(this._removed,null,this._added,null,this._targetArray),b&&b.length?(this._targetArray=a.CloneArray(b),void f(this._added,null,this._removed,null,this._targetArray)):void(this._targetArray=[])})},_processAdd:function(a){return this._processList(function(){f(this._added,this._targetArray,this._removed,null,a)})},_processRemove:function(a){return this._processList(function(){f(this._removed,null,this._added,this._targetArray,a)})},_processClear:function(){return this._processList(function(){this._removed=a.CloneArray(this._array),this._added=[],this._targetArray=[]})},contains:function(a){var b=this._array;return b?b.indexOf(a)>=0:!1},containsAll:function(a){if(!b.isArray(a)){if(b.isObject(a))return this.contains(a);throw new Error("Invalid paramater for containsAll(<array>) method")}var c=this._array;if(!c)return!1;for(var d=0;d<a.length;d++)if(c.indexOf(a[d])<0)return!1;return!0},count:function(){return this._array?this._array.length:0},_endLock:function(){d.prototype._endLock.call(this);var a=this._array||[],b=this._targetArray||[];this._targetArray=c;var e=this._added||[];this._added=c;var f=this._removed||[];this._removed=c;var g=!!this._clearAll;if(this._clearAll=c,e.length||f.length||g){var h={oldSelection:a,newSelection:b,added:e,removed:f,clearAll:g},i=this.$emit(d.SELECTION_CHANGING_EVENT,h);i.defaultPrevented||(this._array=b.slice(),this.$emit(d.SELECTION_SET_EVENT,h),this.$emit(d.SELECTION_CHANGED_EVENT,h))}}}),e}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.selection");c.factory("camelia.SelectionStrategy",["$rootScope","$injector","camelia.core","camelia.ScopeWrapper",function(a,b,c,d){function e(a,b){d.call(this,a.$new(!0)),this._cardinality=e._GetCardinality(b)}return e.BASE_CHANGED_EVENT="cm:baseChanged",e.OPTIONAL="optional",e.ZEROMANY="zeroMany",e.ONE="one",e.ONEMANY="oneMany",e._GetCardinality=function(a){switch(a.toLowerCase()){case"optional":case"?":return 0;case"zeromany":case"*":return 2;case"one":case"1":return 1;case"onemany":case"+":return 3}throw new Error("Invalid '"+a+"' cardinality")},e.CreateDefault=function(a,c){return b.invoke(["camelia.WinSelectionStrategy",function(b){return new b(a,c)}])},c.extend(e,d,{getBase:function(){return null},select:function(){return null}}),e}]),c.factory("camelia.WinSelectionStrategy",["camelia.SelectionStrategy","camelia.core",function(a,b){var c=function(b,c){a.prototype.constructor.call(this,b,c)};return b.extend(c,a,{getBase:function(){return this._base},select:function(b,c,d,e,f,g){var h=e&&e.type&&!e.type.indexOf("key");if(!h||!e.ctrlKey||g){if(1===this._cardinality)return this._base=d,this.$emit(a.BASE_CHANGED_EVENT,d),void b.set(c);if(e&&e.shiftKey){var i=f(this.getBase());if(i)return e.ctrlKey?void b.add(i):void b.set(i)}if(e&&e.ctrlKey){var j=b.count();if(b.containsAll(c)){if(3===this._cardinality&&2>j)return;return void b.remove(c)}if(this._cardinality)return void b.add(c)}this._base=d,this.$emit(a.BASE_CHANGED_EVENT,d),b.set(c)}}}),c}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.templateRegistry",["camelia.core"]);c.factory("camelia.TemplateRegistry",["$log","$q","camelia.core",function(a){var c=b.element(document),d=c.controller("cmTemplateRegistry");d||(d={templatesByScopeAndId:[]},c.data("$cmTemplateRegistryController",d));var e=d.templatesByScopeAndId,f={RegisterTemplates:function(a){var c=a.templates;if(c){var d=this;b.forEach(c,function(b){var c=b.id;c&&d.Register(a,b)})}},Register:function(a,b){var c,d=e.indexOf(a);d>=0?c=e[d]:(c={},e.unshift(c),a.$on("$destroy",function(){var b=e.indexOf(a);0>b||e.splice(b,1)})),c[b.id]=b},FindById:function(a){for(var b=0;b<e.length;b++){var c=e[b],d=c(a);if(d)return d}return null},PrepareTemplates:function(c,d,e){if(!c)return null;var f=[],g={},h=this;return b.forEach(c,function(b){var c=b.$scope;if(!e||c.name===e){var i=c.enabledExpresion;if(i){if("false"===i)return;g[b.id]=d(i)}var j=c.refId;if(j){var k=h.FindById(j);if(!k)return void a.error("Can not fin template id="+j);b=k}f.push(b)}}),f.length?{templates:f,enabledExpressions:g}:null}};return f}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.core");c.factory("camelia.UI",["$log","camelia.core",function(){return{IsFocusable:function(a){if(a.disabled)return!1;if(a.cm_focusable)return!0;if(a.tabIndex>=0)return!0;if(a.tabIndex<0)return!1;var b=a.tagName.toLowerCase();return"button"===b||"input"===b||"a"===b?!0:!1},GetNextFocusable:function(a,b){a[0]&&(a=a[0]);var c=null;if(!b&&(c=a.firstChild,!c))return null;for(;;){if(c===b)return null;if(c&&c.nodeType===Node.ELEMENT_NODE){if(this.IsFocusable(c))return c;if(!c.disabled&&c.firstChild){c=c.firstChild;continue}}if(c||(c=b),c.nextSibling)c=c.nextSibling;else for(;;){if(c=c.parentNode,!c)return null;if(c===a){c=c.firstChild;break}if(c.nextSibling){c=c.nextSibling;break}}}},GetPreviousFocusable:function(a,b){a[0]&&(a=a[0]);var c=null;if(!b&&(c=a.lastChild,!c))return null;for(;;){if(c===b)return null;if(c&&c.nodeType===Node.ELEMENT_NODE&&this.IsFocusable(c))return c;if(c||(c=b),c.previousSibling)for(c=c.previousSibling;c.lastChild&&!c.lastChild.disabled;)c=c.lastChild;else{if(c=c.parentNode,!c)return null;if(c===a)for(c=c.lastChild;c.lastChild&&!c.lastChild.disabled;)c=c.lastChild}}},EnsureVisible:function(a,b){return a[0]&&(a=a[0]),b.offsetTop-a.scrollTop<0?void(a.scrollTop=b.offsetTop):b.offsetTop+b.offsetHeight-a.scrollTop>a.clientHeight?void(a.scrollTop=b.offsetTop+b.offsetHeight-a.clientHeight):void 0}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.criteria",["camelia.i18n.criteria","camelia.core"]),d=0;c.factory("camelia.criteria.Criteria",["$log",function(){var a=function(a,b,c){var e=a.id;e||(e="cm_criteria_"+d++),this.id=e,this.name=c.name};return a.prototype={contributeFilters:function(){return[]},filterData:function(){return!1}},a}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.criteria");c.factory("camelia.criteria.Alphabetic",["$log","camelia.core","camelia.criteria.Criteria","camelia.i18n.Criteria",function(a,c,d,e){var f=function(a,b,c){d.call(this,a,b,c),this.type="Alphabetic"};return c.extend(f,d,{contributeFilters:function(){var a=[];b.forEach(["A-D","E-K","L-P","Q-Z","0-9"],function(b){var c=new RegExp("^["+b+"]","i");a.push({name:b,regExp:c,id:"alphabetic_"+b,toJson:function(){return{startsWithRegExp:b}}})});var d=new RegExp("^[^A-Z0-9]","i");return a.push({name:c.lang(e,"alphabetic_others"),regExp:d,id:"alphabetic_OTHERS",toJson:function(){return{others:!0}}}),a},filterData:function(a,b){var c=!1;if("string"!=typeof b)return c;for(var d=0;d<a.length;d++){var e=a[d];if(e.enabled&&e.regExp.test(b))return!c}return c}}),f}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.criteria");d.factory("camelia.criteria.MinMax",["$log","camelia.criteria.Criteria","camelia.core",function(a,d,e){var f=function(a,c,e){function f(a){var c=e[a];b.isString(c)&&("="===c.charAt(0)&&(c=c.substring(1),g["_"+a+"Eq"]=!0),g["_"+a]=parseFloat(c))}d.call(this,a,c,e),this.type="MinMax",!e.min&&e.value&&(e.min=e.value);var g=this;f("min"),f("max"),this._false="true"===e.reverse};return e.extend(f,d,{contributeFilters:function(){var a=this;return[{name:this.name,toJson:function(){return{min:a._min,minEq:a._minEq,max:a._max,maxEq:a._maxEq,reverse:a._false}}}]},filterData:function(a,d){var e=this._false;if(!b.isNumber(d))return e;var f=this._min;if(f!==c&&(!this._minEq&&f>=d||f>d))return e;var g=this._max;return g!==c&&(!this._maxEq&&d>=g||d>g)?e:!e}}),f}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.criteria");c.factory("camelia.criteria.Number",["$log","camelia.criteria.Criteria","camelia.core",function(a,c,d){var e=function(a,b,d){c.call(this,a,b,d),this.type="Number";var e=d.value;if(!e)throw new Error("You must specify value attribute");"true"===d.integer?(this._integer=!0,e=parseInt(e,10)):e=parseFloat(e),this._value=e,this._false="true"===d.reverse};return d.extend(e,c,{contributeFilters:function(){var a=this;return[{name:this.name,toJson:function(){return{value:a._value,reverse:a._false}}}]},filterData:function(a,c){var d=this._false;return b.isNumber(c)?(this._integer&&(c=Math.floor(c)),this._value===c?!d:d):d}}),e}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.criteria");c.factory("camelia.criteria.RegExp",["$log","camelia.criteria.Criteria","camelia.core",function(a,b,c){var d=function(a,c,d){b.call(this,a,c,d),this.type="RegExp";var e=d.value;if(!e)throw new Error("You must specify value attribute");var f=d.modifiers||"";"true"===d.ignoreCase&&(f+="i"),"true"===d.global&&(f+="g"),this._false="true"===d.reverse,this._regexp=new RegExp(e,f)};return c.extend(d,b,{contributeFilters:function(){var a=this;return[{name:this.name,toJson:function(){return{regExp:a._regExp,reverse:a._false}}}]},filterData:function(a,b){var c=this._false;if("string"!=typeof b)return c;var d=this._regexp;return d.test(b)?!c:c}}),d}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.criteria");c.factory("camelia.criteria.StartsWith",["$log","camelia.criteria.Criteria","camelia.core","camelia.CharsetUtils",function(a,b,c,d){var e=function(a,c,e){b.call(this,a,c,e),this.type="StartsWidth";var f=e.value;if(!f)throw new Error("You must specify value attribute");this._value=f;var g="";"true"===e.ignoreCase&&(g+="i",this._ignoreCase=!0),"true"===e.ignoreAccents&&(this._ignoreAccents=!0,f=d.removeAccents(f)),this._regExp=new RegExp("^["+f+"]",g),this._false="true"===e.reverse};return c.extend(e,b,{contributeFilters:function(){var a=this;return[{name:this.name,toJson:function(){return{startsWidthRegExp:a._value,ignoreCase:!!a._ignoreCase,reverse:a._false}}}]},filterData:function(a,b){var c=this._false;this._ignoreAccents&&(b=d.removeAccents(b));var e=this._regExp;return e.test(b)?!c:c}}),e}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.criteria");c.factory("camelia.criteria.Type",["$log","camelia.criteria.Criteria","camelia.core",function(a,b,c){var d=function(a,c,d){b.call(this,a,c,d),this.type="Type";var e=d.value;if(!e)throw new Error("You must specify value attribute");this._value=e,this._false="true"===d.reverse};return c.extend(d,b,{contributeFilters:function(){var a=this;return[{name:this.name,toJson:function(){return{type:a._value,reverse:a._false}}}]},filterData:function(a,b){var c=this._false;return typeof b===this._value?!c:c}}),d}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.components.combo",["camelia.core","camelia.renderers.combo"]);c.value("cm_combo_rendererProviderName","camelia.renderers.combo:camelia.renderers.Combo");var d=0;c.factory("camelia.components.Combo",["$log","$q","$exceptionHandler","$interpolate","camelia.core","cm_combo_rendererProviderName",function(a,c,e,f,g,h){var i=function(a,b,c,e){this.$scope=a,this.directiveInterpolate=c||f;var i=a.id;i||(i="cm_combo_"+d++),this.id=i;var j=a.rendererProvider;if(!j){var k=a.rendererProviderName||e||h;a.lookId&&(k+="-"+a.lookId),j=g.LoadProvider(k)}this.rendererProvider=j};return i.prototype={construct:[function(){this.constructing=!0,this.constructed=!1,this.element=null;var a={combo:this,items:this.$scope.items,$scope:this.$scope,$interpolate:this.directiveInterpolate},b=this;return b._construct(a).then(function(a){return b.constructing=!1,b.constructed=!0,a},function(a){b.constructing=!1,b.constructed=!1,c.reject(a)})}],_construct:function(a){var d=b.element(document.createDocumentFragment()),e=new this.rendererProvider(a);this.comboRenderer=e;var f=e.render(d);g.isPromise(f)||(f=c.when(f));var h=this;return f.then(function(){return h.constructing=!1,h.constructed=!0,d},function(a){return h.constructing=!1,h.constructed=!1,c.reject(a)})}},i}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.components.grid",["camelia.core","camelia.dataModel","camelia.selection","camelia.pagerRegistry","camelia.renderers.grid"]);d.value("cm_grid_rendererProviderName","camelia.renderers.grid:camelia.renderers.GridProvider"),d.value("cm_grid_dataModelProviderName","");var e=0,f=!1;d.factory("camelia.components.DataGrid",["$log","$injector","$interpolate","$q","$timeout","$rootScope","camelia.core","camelia.SelectionStrategy","camelia.SelectionProvider","camelia.CursorProvider","cm_grid_dataModelProviderName","cm_grid_rendererProviderName","camelia.PagerRegistry","camelia.DataModel",function(a,d,f,g,h,i,j,k,l,m,n,o,p,q){var r=function(c,d,g,h){this.$scope=c,this.directiveInterpolate=g||f;var i=c.id;i||(i="cm_grid_"+e++),this.id=i,this.readyState="uninitialized";var p=c.rendererProvider;if(!p){var q=c.rendererProviderName||h||o;c.lookId&&(q+="-"+c.lookId),p=j.LoadProvider(q)}this.rendererProvider=p;var r=c.dataModelProvider;if(!r){var s=c.dataModelProviderName||n;s&&(r=j.LoadProvider(s))}this.dataModelProvider=r,this.$scope.$watchCollection("value",function(a){c.$broadcast("cm:valueChanged",a)}),this.cursorProvider=new m(c);var t=c.selectionProvider;if(!t){var u=j.toBoolean(c.selectable)||c.selectionCardinality;u&&(t=l.From(c.selection,c),c.$watch("selection",function(b,c){a.debug("WATCH selection newSelection=",b," oldSelection=",c),t.set(b)}))}this.selectionProvider=t,c.$on(l.SELECTION_SET_EVENT,function(b,d){a.debug("EVENT selection newSelection=",d.newSelection),c.selection=d.newSelection});var v=c.selectionStrategy;!v&&t&&(v=k.CreateDefault(c,c.selectionCardinality||"*")),this.selectionStrategy=v;var w=this;if(this.cursorProvider){var x=null;c.$watch(function(a){return x&&x.cursor===a.cursor&&x.columnCursorId===a.columnCursorId?x:x={cursor:a.cursor,columnCursorId:a.columnCursorId}},function(a){var d=a.cursor,e=a.columnCursorId;if(d){var f;e&&b.forEach(c.columns,function(a){a.id===e&&(f=a)}),w.cursorProvider.setCursor(d,f)}}),c.$on(m.CURSOR_CHANGED,function(a,b){c.cursor=b.row,c.columnCursorId=b.column?b.column.id:null})}c.getCurrentPositions=function(){return w.getCurrentPositions()}};return r.prototype={getCursorValue:function(){var a=this.selectionStrategy;return a?a.getCursor():null},construct:[function(){var c=this.$scope;this.constructing=!0,this.element=null,this.readyState="constructing";var d=b.element(document.createDocumentFragment()),e={$scope:c,$interpolate:this.directiveInterpolate,dataGrid:this,columns:c.columns,selectionProvider:this.selectionProvider,selectionStrategy:this.selectionStrategy,cursorProvider:this.cursorProvider,groupProviders:c.groupProviders},f=this,i=new this.rendererProvider(e);this.gridRenderer=i,c.$watch("first",function(c,d){!b.isNumber(c)||c===d||0>c&&0>d||"complete"===f.readyState&&h(function(){a.debug("construct","First changed, update data"),i.updateData()},10,!1)}),c.$watch("rows",function(c,d){!b.isNumber(c)||c===d||0>c&&0>d||"complete"===f.readyState&&(a.debug("construct","Rows changed and readyState is not complete=",f.readyState),i.updateData())});var k=i.render(d);return j.isPromise(k)||(k=g.when(k)),k.then(function(e){return a.debug("construct","Container constructed"),e[0]&&(e=e[0]),f.readyState="complete",f.element=e,b.element(e).data("$scope",c),p.DeclareTarget(e),f._updateDataModel(i.$scope.value),i.$scope.$on("cm:valueChanged",function(b,c){a.debug("construct","valueChanged"),i.$scope.value!==c&&f._updateDataModel(c)}),d},function(){return f.readyState="error",d})}],_updateDataModel:function(b){var d=this.gridRenderer,e=d.dataModel;e&&(d.dataModel=c,e.$destroy());var f=this.normalizeDataModel(b);j.isPromise(f)||(f=g.when(f));var h=this;return f.then(function(b){return a.debug("_updateDataModel.onSuccess: new DataModel"),d.dataErrored=!1,d.dataModel=b,b&&(b.$on(q.DATA_MODEL_CHANGED_EVENT,function(b,c){a.debug("_updateDataModel: received DATA_MODEL_CHANGED event"),h._updateDataModel(c)}),b.$on(q.DATA_MODEL_UPDATED_EVENT,function(){a.debug("_updateDataModel: received DATA_MODEL_UPDATED event"),d.updateData()})),d.updateData(),b},function(b){return a.debug("_updateDataModel.onError: data model updated"),d.dataErrored=!0,d.dataModel=null,d.updateData(),g.reject(b)})},normalizeDataModel:function(a){var b=this.dataModelProvider;return b?new b(a):q.From(a)},getCurrentPositions:function(){return{first:this.first||0,rows:this.rows||0,rowCount:this.rowCount||0,maxRows:this.maxRows||0}},setFirst:function(a){var b=this;this.$scope.$apply(function(){b.$scope.first=a})}},r}]),d.factory("camelia.components.DataColumn",["$log","camelia.core",function(a,b){function d(a,d){this.$scope=a;var f=a.id;f||(f="cm_data_column_"+(d||e++)),this.id=f,this.visible=a.visible===c||b.toBoolean(a.visible)!==!1,this.editable=a.editable===c||b.toBoolean(a.editable)!==!1;var g=a.titleAlign;g&&/^(center|left|right)$/i.test(g)&&(this.titleAlign=g);var h=a.cellAlign;h&&/^(center|left|right)$/i.test(h)>=0&&(this.cellAlign=h);var i=a.width;if(i&&(i=i.trim(),i.length)){var j=parseFloat(i),k=i.indexOf("px"),l=i.indexOf("%");k>0?this.specifiedWidthPx=j:l>0&&(this.specifiedWidthPercent=j)
}var m=a.minWidth;m&&m.indexOf("px")>0&&(this.minWidth=parseFloat(m));var n=a.maxWidth;n&&n.indexOf("px")>0&&(this.maxWidth=parseFloat(n))}return d.prototype={addCriteria:function(a){this._criterias||(this._criterias=[],this._criteriasContext={}),this._criterias.push(a)},removeCriteria:function(a){var b=this._criterias;if(!b)return!1;var c=b.indexOf(a);return 0>c?!1:(b.splice(c,1),!0)}},d}]),d.factory("camelia.components.DataGroup",["$log","camelia.SelectionProvider",function(a,b){function c(a,c){this.$scope=a;var d=a.id;d||(d="cm_data_group_"+(c||e++)),this.id=d;var g=a.collapsedProvider;g||(g=b.From(a.collapsedGroups,a),a.$watch("collapsedGroups",function(){try{f=!0,g.set(a.collapsedGroups)}finally{f=!1}})),this.collapsedProvider=g,g&&g.$on(b.SELECTION_SET_EVENT,function(b,c){a.collapsedGroups=c.newSelection,f||a.$apply()})}return c.prototype={getCollapsedProvider:function(){return this.collapsedProvider}},c}]),d.factory("camelia.components.GridProvider",["camelia.components.DataGrid","camelia.components.DataColumn","camelia.components.DataGroup",function(a,b,c){return{DataGrid:a,DataColumn:b,DataGroup:c}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.components.items",["camelia.core","camelia.dataModel"]),e=0,f=/[\p{P}\p{Z}\p{S}]+/;d.factory("camelia.components.Item",["$log","camelia.core","camelia.CharsetUtils",function(a,c,d){var g=function(a,b,c){this.$scope=a,this.id=a.id||"item_"+e++,c.items||(c.items=[]),c.items.push(this)};return g.prototype={isVisible:function(){return this.$scope.visible!==!1},hasItem:function(a,c){var d=this.$scope;return b.equals(c,d.value)?!0:!1},filter:function(a,c){var e=this.$scope;if(!c)return void a.list.push(e);var g=this._words;if(!g){if(g=e.searchWords||e.label,!b.isArray(g)){var h=g.split(f);g=h}if(a.ignoreAccents)for(var i=0;i<g.length;i++)g[i]=d.removeAccents(g[i]);this._words=g}for(var j=a.filterRegexp,k=0;k<g.length;k++){var l=j.test(g[k]);if(l)return a.offset>0?void a.offset--:void a.list.push(e)}}},g}]),d.factory("camelia.components.Items",["$log","$q","camelia.core","camelia.DataModel",function(a,d,f,g){var h=function(a,b,c){this.$scope=a,this.id=a.id||"items_"+e++,c.items||(c.items=[]),c.items.push(this)};return h.prototype={isVisible:function(){return this.$scope.visible!==!1},hasItem:function(a,b){var d,e=this.$scope,f=e.itemLabel;if(f){var g=a.$interpolate(f),h=a.$scope.$parent.$new(!1);try{h.$item=b;var i=this.$scope.varName;if(i&&(h[i]=b),d=h.$eval(g),d!==c)return!0}finally{h.destroy()}}var j=this.$scope.itemColumn;return j&&(d=b[this.$scope.itemColumn],d!==c)?!0:(d=b.label,d?!0:!1)},filter:function(a,b){function c(){h.setRowIndex(-1);var a=l.$scope;a&&a.$destroy()}var e=this.$scope,h=g.From(e.value||[]),i={startsWith:b},j={};a.maxItems&&(j.rows=a.maxItems),a.ignoreAccents&&(j.ignoreAccents=!0,i.ignoreAccents=!0),a.ignoreCase&&(j.ignoreCase=!0,i.ignoreCase=!0);var k=e.itemColumn||e.id||"comboColumn";h.setFilters([{id:k,filters:[{type:"Alphabetic",parameters:i}]}]),h.setSorters([{column:k,ascending:!0}]),h.setFetchProperties(j);var l={listContext:a},m=h.getRowCount();m=f.ensurePromise(m);var n=this;return m.then(function(b){function e(a){c(),k.reject(a)}function g(a){k.notify(a)}function i(b){if(!b)return c(),k.resolve(!1);if(a.offset>0)a.offset--;else{var d=h.getRowData();if(n._processRow(l,a.list,d),j++,a.maxItems>0&&(a.maxItems--,!a.maxItems))return c(),k.resolve(!0)}return h.setRowIndex(j),m=h.isRowAvailable(),m=f.ensurePromise(m),m.then(i,e,g)}var j=0;if(b>=0&&a.offset>0){if(b<=a.offset)return a.offset-=b,d.when(!1);j=a.offset}var k=d.defer();h.setRowIndex(j);var m=h.isRowAvailable();return m=f.ensurePromise(m),m.then(i,e,g),k.promise})},_processRow:function(a,d,e){var f=a.$itemScope,g=a.listContext;if(!f){f=g.$scope.$parent.$new(!1),a.$itemScope=f;var h=g.$interpolate,i=this;b.forEach(["itemLabel","itemTooltip","itemClass","itemDisabled"],function(b){var c=i.$scope[b];c&&(a[b+"Expression"]=h(c))})}f.$item=e;var j=this.$scope.varName;j&&(f[j]=e);var k,l={$item:e};k=a.itemLabelExpression?f.$eval(a.itemLabelExpression):this.$scope.itemColumn?e[this.$scope.itemColumn]:"function"==typeof e.toItemText?e.toItemText():e.label!==c?e.label:String(e),l.label=k;var m=null;a.itemTooltipExpression?m=f.$eval(a.itemTooltipExpression):e.tooltip!==c&&(m=e.tooltip),m&&(l.tooltip=m);var n=null;a.itemClassExpression?n=f.$eval(a.itemClassExpression):e.className!==c&&(n=e.className),n&&(l.className=n);var o=!1;a.itemDisabledExpression?o=f.$eval(a.itemDisabledExpression):e.disabled!==c&&(o=e.disabled),o&&(l.disabled=o),d.push(l)}},h}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.components.pager",["camelia.core","camelia.pagerRegistry","camelia.renderers.pager"]);d.value("cm_pager_rendererProviderName","camelia.renderers.pager:camelia.renderers.Pager"),d.value("cm_pager_format","{bprev} {bpages} {bnext}"),d.value("xcm_pager_format","'first=' {first} 'last=' {last} 'rowCount=' {rowCount} 'pageCount=' {pageCount} 'pagePos=' {pagePosition} {bprev} {bnext}");var e=0;d.factory("camelia.components.PagerBase",["$log","$q","$exceptionHandler","camelia.core","camelia.PagerRegistry","cm_pager_rendererProviderName",function(a,d,e,f,g,h){var i=function(a,c,e){this.$scope=a;var i=a.rendererProvider;if(!i){var j=a.rendererProviderName||e||h;a.lookId&&(j+="-"+a.lookId),i=f.LoadProvider(j)}this.rendererProvider=i;var k=a.target;if(!k){var l=a.forElementId;if(!l)throw new Error("No target or for attribute to attach the pager !");var m=document.getElementById(l);m&&(k=b.element(m).scope()._component)}var n;k?n=d.when(k):a.forElementId&&(n=g.RegisterWaitingFor(a,a.forElementId)),this.targetPromise=n};return i.prototype={construct:[function(){this.constructing=!0,this.constructed=!1,this.element=null;var a=this;return this.targetPromise.then(function(c){f.Assert(c&&b.element(c).scope(),"pager","Invalid target component ",c);var d=b.element(c).scope();delete a.targetPromise;var e={pager:a,targetScope:d,$scope:a.$scope};return a.constructFromTarget(e).then(function(b){return a.constructing=!1,a.constructed=!0,b})},function(b){return a.constructing=!1,a.constructed=!1,d.reject(b)})}],constructFromTarget:function(a){var e,g=a.targetScope,h=b.element(document.createDocumentFragment()),i=this,j=g.$on("$destroy",function(){i._targetDestroyed(g),a.targetScope=c}),k=g.$on("cm:positionsChanged",function(a,b){return i.element?(e=c,void i.updatePositions(b)):void(e=b)});this.$scope.$on("$destroy",function(){j&&(j(),j=null),k&&(k(),k=null)});var l=new this.rendererProvider(a);this.pagerRenderer=l;var m=l.render(h);return f.isPromise(m)||(m=d.when(m)),m.then(function(a){i.element=a;var b=e;return e=c,!b&&g.getCurrentPositions&&(b=g.getCurrentPositions()),b&&i.updatePositions(b),h})},_targetDestroyed:function(){},updatePositions:function(a){this.pagerRenderer.pagerPositionsUpdate(a)}},i}]),d.factory("camelia.components.Pager",["$log","cm_pager_rendererProviderName","cm_pager_format","camelia.components.PagerBase",function(a,c,d,f){var g=function(a,b){var d=a.id;d||(d="cm_pager_"+e++),this.id=d,b.attr("id",d),f.call(this,a,b,c)};return g.prototype=Object.create(f.prototype),b.extend(g.prototype,{constructor:g,constructFromTarget:function(a){var c=this.$scope.format;b.isString(c)||(c=d),a.format=c;var e=this;return this.$scope.$watch("format",function(c){var f=a.targetScope,g=f.getCurrentPositions();b.isString(c)||(c=d),a.format=c,e.updatePositions(g)}),f.prototype.constructFromTarget.call(this,a)}}),g}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.components.popup",["camelia.core"]);c.value("cm_popup_rendererProviderName","camelia.renderers.popup:camelia.renderers.Popup"),c.factory("camelia.components.popup",["$log","$q","$exceptionHandler","camelia.core","cm_popup_rendererProviderName",function(a,b,c,d){var e=function(a,b,c){this.$scope=a,b.data("cm_component",this);var e=a.rendererProvider;if(!e){var f=a.rendererProviderName||c;e=d.LoadProvider(f)}this.rendererProvider=e};return e.prototype={construct:[function(){this.constructing=!0,this.constructed=!1,this.element=null;return b.when(!1)}],open:function(){}},e}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.components.template",["camelia.core"]),d=0;c.factory("camelia.components.Template",["$log","camelia.core",function(){var a=function(a,b,c,e){this.$scope=a,this._transcludeFunc=e,this.id=a.id||"template_"+d++,c.templates||(c.templates=[]),c.templates.push(this)};return a.prototype={transclude:function(a,b){var c=this._transcludeFunc,d=c(b,function(b){a.append(b)});return d}},a}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.dataModel",["camelia.core","ngResource"]);d.factory("camelia.DataModel",["$q","$rootScope","$injector","$resource","camelia.core","camelia.ScopeWrapper",function(a,d,e,f,g,h){function i(){h.call(this,d.$new(!0));var a=this;this.$on("$destroy",function(){var b=a._watcherDeRegistration;b&&(a._watcherDeRegistration=c,b()),a._wrappedData=c,a._sorters=c,a._filters=c,a._dataScope=c,a._fetchProperties=c})}var j=g.getProto(f());return i.DATA_REQUESTING="cm:dataRequesting",i.DATA_LOADING="cm:dataLoading",i.DATA_LOADED="cm:dataLoaded",i.DATA_MODEL_CHANGED_EVENT="cm:dataModelChanged",i.DATA_MODEL_UPDATED_EVENT="cm:dataModelUpdated",i.From=function(a){if(a instanceof i)return a;var c=a&&g.getProto(a);return c===j?e.invoke(["camelia.ResourceDataModel",function(b){return new b(a)}]):b.isArray(a)?e.invoke(["camelia.ArrayDataModel",function(b){return new b(a)}]):new i},g.extend(i,h,{_rowIndex:-1,installWatcher:function(a,b){var c=this;this._watcherDeRegistration=a.$watch(b,function(a){c.$broadcast(i.DATA_MODEL_CHANGED_EVENT,a)})},isRowAvailable:function(){return!1},getRowCount:function(){return-1},getRowData:function(){return c},getRowIndex:function(){return this._rowIndex},setRowIndex:function(a){var b=this._rowIndex;this._rowIndex=a,this.$parent===d&&(0>b&&a>=0&&this.$broadcast("cm:begin"),b>=0&&0>a&&this.$broadcast("cm:end"))},getWrappedData:function(){return this._wrappedData},setWrappedData:function(a){this._wrappedData=a},setFetchProperties:function(a){this._fetchProperties=a},setSorters:function(a){return this._sorters===a?!1:(this._sorters=a,!0)},setFilters:function(a){return this._filters===a?!1:(this._filters=a,!0)},setGrouped:function(a){this._grouped=!!a},isGrouped:function(){return this._grouped},setDataScope:function(a){this._dataScope=a},isFilterSupport:function(){return this.filterSupport},isSortSupport:function(){return this.sortSupport},isGroupSupport:function(){return this.groupSupport},toArray:function(){function b(f){for(;f&&(e.setRowIndex(d),f=e.isRowAvailable(),f!==!1);d++){if(g.isPromise(f))return f.then(b);var h=e.getRowData();c.push(h)}return e.setRowIndex(-1),a.when(c)}var c=[],d=0,e=this,f=c;try{f=b(!0)}catch(h){throw this.setRowIndex(-1),h}return f},$destroyChildren:function(){for(;this.$$childHead;)this.$$childHead.$destroy()}}),i}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.dataModel");d.factory("camelia.ArrayDataModel",["$log","camelia.DataModel","camelia.core",function(a,d,e){function f(a){d.prototype.constructor.call(this),this.setWrappedData(a)}return e.extend(f,d,{installWatcher:function(a,b){var e=this;this._watcherDeRegistration=a.$watchCollection(b,function(a,b){b!==c&&(e.setWrappedData(a),e.$broadcast(d.DATA_MODEL_UPDATED_EVENT,a))})},isRowAvailable:function(){function a(a){return b>=0&&(0>a||a>b)?!0:!1}var b=this.getRowIndex(),c=this.getRowCount();return e.isPromise(c)?c.then(function(b){return a(b)}):a(c)},getRowCount:function(){var a=this.getWrappedData();return a?a.length:0},getRowData:function(){if(!this.isRowAvailable())throw new Error("Invalid rowIndex ("+this.getRowIndex()+"/"+this.getRowCount()+")");var a=this.getWrappedData(),b=this.getRowIndex();return a[b]},toArray:function(){var a=this.getWrappedData();return b.isArray(a)?a:d.prototype.toArray.call(this)}}),f}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.dataModel");c.factory("camelia.FiltredDataModel",["$log","camelia.WrappedArrayDataModel","camelia.core",function(a,c,d){function e(a,b){c.call(this,a),this.filterSupport=!0,this._rowVarName=b}return d.extend(e,c,{processParentArray:function(a){var c=this._filters;if(!c||!c.length)return a;var d=c.length,e=this._rowVarName,f=[],g=this._dataScope.$new(!0),h=this;try{b.forEach(a,function(a){g.$row=a,e&&(g[e]=a);for(var b=0;d>b;b++){var i=c[b];if(i(g,h)===!1)return}f.push(a)})}finally{g.$destroy()}return f},delegateToParent:function(){return this.$parent.isFilterSupport()||!this._filters}}),e}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.dataModel");c.factory("camelia.GroupedDataModel",["camelia.WrappedArrayDataModel","camelia.core",function(a,c){function d(b,c,d){a.call(this,b),this.groupSupport=!0,this._groupInitialized=!1,this._groupProvider=c,this._rowVarName=d,this._groups=[],this._groupCount=[],this._groupValues=[];var e=this;this.$on("$destroy",function(){e._groupProvider=c,e._rowVarName=d,e._groups=[],e._groupCount=[],e._groupValues=[]})}return c.extend(d,a,{getGroup:function(a,b){var c=this._groupProvider.$scope.valueRawExpression;a.$row=b,this._rowVarName&&(a[this._rowVarName]=b);var d=a.$eval(c);return d},getGroupCount:function(a){var b=this._groups.indexOf(a);return 0>b?-1:this._groupCount[b]},getGroupValues:function(a){var b=this._groups.indexOf(a);return 0>b?-1:this._groupValues[b]},xxxisRowAvailable:function(){var b=a.prototype.isRowAvailable.call(this);if(!b||c.isPromise(b))return b;var d=this.toArray();if(c.isPromise(d)){var e=this;return d.then(function(a){return e.processParentArray(a),b})}return this.processParentArray(d),b},processParentArray:function(a){if(this._groupInitialized)return a;if(this._groupInitialized=!0,!this._grouped)return a;var d=this._dataScope.$new(!0);try{var e=this,f=this._groups,g=this._groupCount,h=this._groupValues;b.forEach(a,function(a){var b=e.getGroup(d,a),c=f.indexOf(b);0>c&&(c=f.length,g[c]=0),f[c]=b,g[c]++,h[c]||(h[c]=[]),h[c].push(a)});var i=c.CloneArray(f),j=this._groupProvider.$scope.sorter;j&&(d.$array=i,i=d.$eval("$array | "+j));var k=[];return b.forEach(i,function(a){var b=f.indexOf(a);k=k.concat(h[b])}),k}finally{d.$destroy()}},delegateToParent:function(){return this.$parent.isGroupSupport()||!this._grouped},getRowCount:function(){return this.$parent.getRowCount()}}),d}])}(window,window.angular),function(a,b,c){"use strict";var d=!1,e=0,f=b.module("camelia.dataModel");f.factory("camelia.ResourceDataModel",["$q","$timeout","$log","camelia.DataModel","camelia.core",function(a,f,g,h,i){function j(a,d){h.call(this),b.extend(this,b.extend(k,d||{})),this.$resource=a,this._sessionId=0,this._rowCount=-1,this._cache=[];var e=this;this.$on("begin",function(){e._sessionId=l++}),this.$on("end",function(){e._sessionId=-1;var a=e._requestPromise;a&&(e._requestPromise=c,a.cancel())}),this.$on("clearState",function(){e._cache=[],e._rowCount=-1})}var k={pageSize:20,offsetMod:10,offsetParameter:"offset",countParameter:"count",sorterParameter:"sorter",filterParameter:"filter",actionName:"query",keepCache:!1},l=0;return i.extend(j,h,{isRowAvailable:function(){this.needRowAvailable=!1;var i=this.getRowIndex(),j=this._cache;if(j[i]!==c)return!0;if(this._rowCount>=0&&i>=this._rowCount)return!1;this.sortSupport=!1,this.filterSupport=!1;var k=a.defer(),l=this._fetchProperties,m=i,n=l&&l.rows||0,o=Math.max(n,this.pageSize);if(this.offsetMod>0){m-=m%this.offsetMod;var p=i+o-1;p-=p%this.offsetMod,o=(Math.floor((p-m)/this.pageSize)+1)*this.pageSize}if(this._keepCache===!1)j=[],this._cache=j;else for(var q=m+o-1;q>m&&j[q]!==c;q--)o--;var r=this._sessionId,s=this.actionName,t={};if(t[this.offsetParameter]=m,t[this.countParameter]=o,this._sorters&&this.sorterParameter){var u=[];t[this.sorterParameter]=u,b.forEach(this._sorters,function(a){var b=a.expression||a.column;a.ascending||(b+=":desc"),u.push(b)}),this.sortSupport=!0}var v=this._filters;if(v&&this.filterParameter){var w=[];b.forEach(v,function(a){if(a.toJson){var c=a.toJson();return void(c&&w.push(c))}if("function"==typeof a)return void a(t);var d=b.toJson(a);return d?void w.push(d):void 0}),w.length&&(t[this.filterParameter]=w),this.filterSupport=!0}this._rowCount<0&&this.requestRowCountParameter&&(t[this.requestRowCountParameter]=!0);var x=this._requestPromise;x&&(this._requestPromise=c,x.cancel());var y=this,z=this.$resource[s].call(this.$resource,t,function(a){try{if(y._requestPromise=c,y._sessionId!==r)return k.reject("Session canceled");if(2===e)return void k.reject({type:"RESOURCE_ERROR",error:"Simulation 2"});if(3===e)throw new Error({type:"RESOURCE_ERROR",error:"Simulation 3"});d?f(function(){k.notify({type:h.DATA_LOADED,count:a.length})},4e3,!1):k.notify({type:h.DATA_LOADED,count:a.length});for(var b=0;b<a.length;b++)j[b+m]=a[b];a.length<o&&(a.length||!m)&&(y._rowCount=m+a.length),d?f(function(){k.resolve(j[i]!==c)},6e3,!1):k.resolve(j[i]!==c)}catch(g){k.reject({type:"RESOURCE_ERROR",error:g})}},function(a){return g.error("Resource got error ",a),k.reject({type:"RESOURCE_ERROR",error:a})});if(this._requestPromise=z.$promise,this._requestPromise.then(null,null,function(){y._sessionId===r&&(console.log("progress ..."),k.notify({type:h.DATA_LOADING}))}),f(function(){k.notify({type:h.DATA_REQUESTING})},0,!1),1===e)throw new Error({type:"RESOURCE_ERROR",error:"Simulation 1"});return d&&f(function(){k.notify({type:h.DATA_LOADING})},2e3,!1),k.promise},setRowIndex:function(a){j.prototype.$super.setRowIndex.call(this,a),this.needRowAvailable=!0},getRowData:function(){this.needRowAvailable;var a=this.getRowIndex(),b=this._cache[a];return b},getRowCount:function(){return this._rowCount},setSorters:function(a){j.prototype.$super.setSorters.call(this,a),this._cache=[],this._rowCount=-1},setFilters:function(a){j.prototype.$super.setFilters.call(this,a),this._cache=[],this._rowCount=-1},setGrouped:function(a){j.prototype.$super.setGrouped.call(this,a),this._cache=[],this._rowCount=-1}}),j}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.dataModel");c.factory("camelia.SortedDataModel",["$log","camelia.WrappedArrayDataModel","camelia.core",function(a,c,d){function e(a){c.call(this,a),this.sortSupport=!0}return d.extend(e,c,{processParentArray:function(a){if(!this._sorters)return a;var c=this._dataScope.$new(!0);try{b.forEach(this._sorters,function(b){c.$array=a;var d=b.expression;"orderBy:"===d&&b.column.$scope.fieldName&&(d+="'"+b.column.$scope.fieldName+"'");var e=c.$eval("$array | "+d);b.ascending||(e=e.reverse()),a=e})}finally{c.$destroy()}return a},delegateToParent:function(){return this.$parent.isSortSupport()||!this._sorters},getRowCount:function(){return this.$parent.getRowCount()}}),e}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.dataModel");d.factory("camelia.WrappedArrayDataModel",["camelia.ArrayDataModel","camelia.core",function(a,d){function e(b){a.call(this,c),this.$parent=b}var f="$$DELAGATE_PARENT$$",g="$$NO-DATA$$";return d.extend(e,a,{setSorters:function(a){this.$parent.setSorters(a),e.prototype.$super.setSorters.call(this,a)},setFilters:function(a){this.$parent.setFilters(a),e.prototype.$super.setFilters.call(this,a)},setGrouped:function(a){this.$parent.setGrouped(a),e.prototype.$super.setGrouped.call(this,a)},setDataScope:function(a){this.$parent.setDataScope(a),e.prototype.$super.setDataScope.call(this,a)},isFilterSupport:function(){return e.prototype.$super.isFilterSupport.call(this)||this.$parent.isFilterSupport()},isSortSupport:function(){return e.prototype.$super.isSortSupport.call(this)||this.$parent.isSortSupport()},isGroupSupport:function(){return e.prototype.$super.isGroupSupport.call(this)||this.$parent.isGroupSupport()},setFetchProperties:function(a){this.$parent.setFetchProperties(a),e.prototype.$super.setFetchProperties.call(this,a)},setRowIndex:function(a){this.$parent.setRowIndex(a),e.prototype.$super.setRowIndex.call(this,a)},getRowCount:function(){var a=this.getWrappedData();return a===c?-1:a===f?this.$parent.getRowCount():e.prototype.$super.getRowCount.call(this)},getRowData:function(){var a=this.getWrappedData();return a===f?this.$parent.getRowData():e.prototype.$super.getRowData.call(this)},isRowAvailable:function(){function a(a){return h=i.processParentArray(a),i.setWrappedData(h),e.prototype.$super.isRowAvailable.call(i)}function c(){var c=i.$parent.toArray();if(d.isPromise(c))return c.then(function(b){return a(b)});if(c||(c=[]),b.isArray(c))return a(c);throw new Error("Invalid toArray return !")}var h=this.getWrappedData();if(h===f)return this.$parent.isRowAvailable();if(h===g)return!1;if(h)return e.prototype.$super.isRowAvailable.call(this);var i=this,j=this.$parent.isRowAvailable();return j===!1?(this.setWrappedData(g),!1):d.isPromise(j)?j.then(function(a){return a===!1?(i.setWrappedData(g),!1):i.delegateToParent()?(i.setWrappedData(f),!0):c()}):this.delegateToParent()?(this.setWrappedData(f),!0):c()},delegateToParent:function(){return!1},processParentArray:function(a){return a}}),e}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.monitors",["camelia.core","camelia.i18n.progressMonitor"]),e="c:pm_computeName",f=500,g=0;d.factory("camelia.monitor.ProgressMonitor",["$log","$rootScope","$q","$injector","camelia.core","camelia.ScopeWrapper","camelia.i18n.ProgressMonitor",function(a,b,d,h,i,j,k){function l(c,d){this._options=d||{},j.call(this,(c||b).$new(!0)),this.id=this._options.id||"cm_progressMonitor_"+g++;var f=this;this.$on(e,function(a,b){f._canceled||f._done||f._taskName&&b.push(f._taskName)}),c instanceof l||this.$on(l.SUB_TASKNAME_CHANGED_EVENT,function(b){b.stopPropagation();var c,d=[];if(f._canceled)c=f._options.canceledMessage||i.lang(k,"canceled");else if(f._done)c=f._options.doneMessage||i.lang(k,"done");else switch(f.$broadcast(e,d),a.debug("Collect task name:",d),c=d[d.length-1],f._options.labelFormat){case"concat":c=d.join(" ")}f._computedTaskName!==c&&(f._computedTaskName=c,a.debug("Change taskName to '"+c),f.$broadcast(l.TASKNAME_CHANGED_EVENT,f,c,d))})}return l.TASKNAME_CHANGED_EVENT="c:pm_taskNameChanged",l.CANCELED_EVENT="c:pm_canceled",l.WORK_EVENT="c:pm_work",l.DONE_EVENT="c:pm_done",l._SUB_TASKNAME_CHANGED_EVENT="c:pm_subTaskNameChanged",l.BEGIN_PROGRESS_MONITOR_EVENT="c:pm_begin",i.extend(l,j,{getOptions:function(){return this._options},beginTask:function(b,d){if(this._totalWork!==c)throw new Error("BeginTask has already been called !");if(isNaN(d)||0>=d)throw new Error("Invalid totalWork parameter ("+d+")");this._totalWork=d,this._currentWork=0,this.setTaskName(b),a.debug("Begin task '",b,"' totalWork=",d),this.$emit(l.BEGIN_PROGRESS_MONITOR_EVENT,this)},done:function(){this._done||(this._done=!0,this._currentWork<this._totalWork&&(this._currentWork=this._totalWork,this.$broadcast(l.WORK_EVENT,this,1)),this.$broadcast(l.DONE_EVENT,this),this.release())},_childDone:function(){this.$emit(l._SUB_TASKNAME_CHANGED_EVENT)},isDone:function(){return this._done},isCanceled:function(){return this._canceled},setCanceled:function(){this._canceled||this._done||(this._canceled=!0,this.$broadcast(l.CANCELED_EVENT,name),this.$emit(l.SUB_TASKNAME_CHANGED_EVENT),this.release())},setTaskName:function(a){this._canceled||this._done||this._taskName===a||(this._taskName=a,this.$emit(l.SUB_TASKNAME_CHANGED_EVENT,a))},getTaskName:function(){return this._computedTaskName},worked:function(b){if(a.debug("Declare work ",b," currentWork=",this._currentWork," totalWork=",this._totalWork),isNaN(b)||0>b)throw new Error("Invalid work parameter ("+b+")");if(!this._canceled&&!this._done){this._currentWork+=b,this._currentWork>this._totalWork&&(this._currentWork=this._totalWork);var c=Date.now();if(!(c-this._lastTime<f)){this._lastTime=c;var d=this._currentWork/this._totalWork;a.debug("WORK_EVENT: ",d),this.$broadcast(l.WORK_EVENT,this,d)}}},release:function(){this.$destroy()},then:function(a,b,c,d){if(!i.isPromise(a))throw new Error("First parameter must be a promise ("+a+")");b||(b=1);var e=h.get("camelia.monitor.QProgressMonitor");return e.then(this,a,b,name,d)}}),l}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.monitors");c.factory("camelia.monitor.QProgressMonitor",["$log","$q","camelia.core","camelia.monitor.SubProgressMonitor",function(a,b,c,d){var e={};return e.then=function(a,c,e,f,g){var h=new d(a,e,g);h.beginTask(f,1);var i=b.defer();return c.then(function(a){h.done(),i.resolve(a)},function(a){h.done(),i.reject(a)},function(a){i.notify(a)}),i.promise},e}])}(window,window.angular),function(a,b,c){"use strict";var d=500,e=b.module("camelia.monitors");e.factory("camelia.monitor.SubProgressMonitor",["$log","$q","camelia.core","camelia.monitor.ProgressMonitor",function(a,b,e,f){function g(a,b,c){if(!(a instanceof f))throw new Error("Parent is not a progressMonitor !"+a);if(isNaN(b)||0>=b)throw new Error("Invalid ticks parameter ("+b+")");this._parent=a,f.call(this,a.$scope,c),this._canceled=a.isCanceled(),this._done=a.isDone(),this._ticks=b,this._ticksSent=0,this._waitingWork=0}return e.extend(g,f,{beginTask:function(a,b){if(this._totalWork!==c)throw new Error("BeginTask has already been called !");if(isNaN(b)||0>=b)throw new Error("Invalid totalWork parameter ("+b+")");this._totalWork=b,this._currentWork=0,a&&this.setTaskName(a)},done:function(){if(!this._done){this._done=!0;var a=this._ticks-this._ticksSent;a>0&&this._parent.worked(a),this.$broadcast(f.DONE_EVENT),this._parent._childDone(),this.release()}},isCanceled:function(){return this._canceled},setCanceled:function(){this._canceled||this._done||this._parent.setCanceled()},worked:function(a){if(isNaN(a)||0>a)throw new Error("Invalid work parameter ("+a+")");if(this.$$destroyed)throw new Error("Illegal state of subProgressMonitor");if(!this._canceled&&!this._done){var b=Date.now();if(b-this._lastTime<d)return void(this._waitingWork+=a);this._currentWork+=a+this._waitingWork,this._waitingWork=0,this._currentWork>this._totalWork&&(this._currentWork=this._totalWork),this._lastTime=b;var c=this._currentWork/this._totalWork*this._ticks;c-=this._ticksSent,0>=c||(this._ticksSent+=c,this._parent.worked(c))}}}),g}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.renderers.grid",["camelia.dataModel","camelia.selection","camelia.templateRegistry","camelia.renderers.popup","camelia.components.grid","camelia.animations.grid","camelia.i18n.grid"]);c.value("cm_grid_rowIndentPx",16),c.value("cm_grid_className","cm_dataGrid"),c.value("cm_grid_sizerPx",6),c.factory("camelia.renderers.GridProvider",["$log","camelia.renderers.grid.core","camelia.renderers.grid.group","camelia.renderers.grid.row","camelia.renderers.grid.table","camelia.renderers.grid.title","camelia.renderers.grid.utils",function(a,c,d,e,f,g,h){return b.forEach([d,e,f,g,h],function(a){b.extend(c.prototype,a)}),c}])}(window,window.angular),function(a,b,c){"use strict";var d=0,e=!1,f="cm:popup_requestOpen",g="cm:popup_opened",h="cm:popup_requestClose",i="cm:popup_closed",j="cm:propose_item",k="cm:select_item",l="cm:focus_input",m="cm:next_item",n="cm:prev_item",o="c:inputChanged",p="c:completeInput",q="c:filterChanged",r="popupRequest",s=b.module("camelia.renderers.combo",["camelia.components.combo","camelia.i18n.combo","camelia.renderers.items","camelia.monitors"]);s.value("cm_combo_className","cm_combo"),s.factory("camelia.renderers.Combo",["$log","$q","$exceptionHandler","$timeout","camelia.core","camelia.cmTypes","camelia.UI","cm_combo_className","camelia.Key","camelia.i18n.Combo","camelia.CharsetUtils","camelia.renderers.Items","camelia.monitor.ProgressMonitor",function(a,s,t,u,v,w,x,y,z,A,B,C,D){function E(a){return w.SearchElements({icon:null,button:null,input:null,label:null,tags:null,tag:null,tagRemove:null,popup:null,item:null,combo:null},"combo",a)}var F=function(a){C.call(this,a)};return v.extend(F,C,{render:function(c){var d=this.$scope,f=v.createElement(c,"div",{id:this.combo.id,$cm_type:"combo"});this.containerElement=f[0],f.on("mouseover",this._onMouseOver()),f.on("mouseout",this._onMouseOut()),f.on("mousedown",this._onMouseDown()),f.on("click",this._onSimpleClick()),f.on("mouseup",this._onMouseUp()),f.on("keydown",this._onKeyDown()),f.on("keypress",this._onKeyPress()),f.on("keyup",this._onKeyUp()),v.on(f,"focus",this._onFocus(),!0,d),v.on(f,"blur",this._onBlur(),!0,d);var h=this;d.$watch("style",function(a){a=a||"",f.attr("style",a)}),d.$watch("className",function(){h.comboStyleUpdate(f)}),d.$watch("selectItem",function(b){a.debug("SelectItem change detected",b),d.$broadcast(j,"watch",b,{})}),d.$on(g,function(){w.SwitchOnState(h,{combo:h.containerElement},"openedPopup")}),d.$on(i,function(){e||w.ClearState(h,{combo:h.containerElement},"openedPopup",!1)}),d.$on(k,function(b,c,e,f,g){var h=e;e&&e.$item&&(h=e.$item),g&&g.updateScope===!1||u(function(){d.selectedItem!==h&&(a.debug("Apply item=",h),d.$apply(function(){d.selectedItem=h}))},0,!1)});var l=[];d.$on(D.BEGIN_PROGRESS_MONITOR_EVENT,function(a,b){l.push(b),f.attr("cm_progressMonitor",!0),1===l.length&&h._showProgressMonitor(l[0]),b.$on("$destroy",function(){var a=l.indexOf(b);if(!(0>a)){if(l.splice(a,1),l.length)return void h._showProgressMonitor(l[0]);h._showProgressMonitor(null),f.removeAttr("cm_progressMonitor")}})}),f.on("cm_update",this._onStyleUpdate());var m=["begin","tags","input","openButton","end"],n={add:function(b,c,d){var e=-1;for(b&&(e=m.indexOf(b),0>e&&a.error("Can not find container Id '"+b+"'")),0>e?e=m.length:e++,isNaN(d)&&(d=0);;e++){var f=m[e];if(!f||"string"==typeof f)break;if(m[e].priority<d)break}m.splice(e,0,{promiseFunc:c,priority:d})}};this.comboRenderer(n);var o=v.createElement(f,"div",{className:"cm_combo_container"}),p=[];b.forEach(m,function(a){a.promiseFunc&&p.push(a.promiseFunc)});for(var q=null,r=0;r<p.length;r++){var s=p[r];if(q)q=q.then(v.callPromise(s,this,o));else{var t=s(o);if(!v.isPromise(t))continue;q=t}}return q=v.ensurePromise(q),q.then(function(){return h.comboStyleUpdate(f),f})},comboRenderer:function(a){a.add("input",this.inputRenderer.bind(this)),v.toBoolean(this.$scope.hasOpenPopupButton)===!1&&a.add("openButton",this.openButtonRenderer.bind(this)),this.$scope.tags!==c&&a.add("begin",this.tagsRenderer.bind(this))},inputRenderer:function(b){var c=this.$scope,d=this,e=v.createElement(b,"div",{className:"cm_combo_cinput"}),g=v.createElement(e,"input",{id:this.combo.id+"_shadowInput",className:"cm_combo_shadowInput",tabIndex:-1,disabled:!0,"aria-hidden":!0}),h=v.createElement(e,"input",{id:this.combo.id+"_input",$cm_type:"input",maxlength:this.$scope.maxLength,size:this.$scope.textSize,placeholder:this.$scope.placeholder});h.on("scroll",function(){g[0].scrollLeft=h[0].scrollLeft}),c.$watch("maxTextLength",function(a){h.attr("maxlength",a)}),c.$watch("textSize",function(a){h.attr("size",a)}),c.$watch("placeholder",function(a){h.attr("placeholder",a)});var i;return c.$on(o,function(b,d,e){var f=h.prop("cm_proposalLabel"),g=h.val();i!==g&&(i=g,a.debug("input#INPUT_CHANGED_EVENT: Input changed ! '"+g+"' proposal='"+f+"'"),c.$broadcast(q,g,d,e))}),c.$on(l,function(){h[0].focus()}),c.$on(k,function(b,c,d,e,f){a.debug("input#SELECT_ITEM_EVENT: item=",d," options=",f),f&&f.clearShadow===!1||g.val(""),f&&f.updateInput!==!0||(e=e||d&&d.label,h.val(e?e:""),u(function(){var a=h.val().length;h[0].setSelectionRange(a,a)},10,!1))}),c.$on(j,function(b,d,e,f,i){if(a.debug("input#PROPOSE_ITEM_EVENT: item=",e," option=",f),!e)return h.data("cm_proposal",null),h.prop("cm_proposalLabel",null),void c.$broadcast(k,"propose",null,null,f,i);h.prop("cm_proposalLabel",e.label),h.data("cm_proposal",e),f=f||{},f.clearShadow=!1;var j=h.val();if(j){var l=e.label;if(f&&f.mergeInput&&(l=j+l.substring(j.length)),g.val(l),g[0].scrollLeft=h[0].scrollLeft,l===j)return void c.$broadcast(k,"propose",e,l,f,i)}c.$broadcast(k,"propose",null,null,f,i)}),c.$on(p,function(a,b,d){var e=g.val();
if(e&&h.val()!==e){a.done=!0;var f=h.data("cm_proposal");c.$broadcast(k,"complete",f,e,{clearShadow:!0,updateInput:!0},d)}}),c.$on(f,function(a,b){d.processSuggestRequest(h.val(),null,b)}),c.$on(q,function(b,e,f){if(g.val(""),!d.isPopupOpened()){var i=h.val();if(!i)return void c.$broadcast(j,e,null,{clearShadow:!1},f);a.debug("input#FILTER_CHANGED_EVENT: value=",i,"  listItems ..."),d.listItems(i,1,d._buildCriterias()).then(function(a){c.$broadcast(j,e,a[0],{clearShadow:!1,mergeInput:!0},f)})}}),this.inputStyleUpdate(h),s.when(e)},openButtonRenderer:function(a){var b=v.createElement(a,"button",{id:this.combo.id+"_openButton",$cm_type:"button",$cm_actionType:r,$fa_classes:["fa","fa-caret-down"]});return this.buttonStyleUpdate(b),s.when(b)},tagsRenderer:function(a){var b=v.createElement(a,"ul",{id:"cm_ctags_"+d++,$cm_type:"tags",cssDisplay:"none"}),c=this;return this.$scope.$watchCollection("tags",function(a){c.constructTags(b,a)}),this.$scope.tags&&this.constructTags(b,this.$scope.tags),this.tagsStyleUpdate(b),s.when(b)},constructTags:function(a,c){for(var d=this,e=[],f=(a[0]||a).querySelectorAll(".cm_combo_tag"),g=0;g<f.length;g++){var h=b.element(f[g]);e.push(h.data("cm_tag"))}var i=document.createDocumentFragment(),j=null,k=[];b.forEach(c,function(a){var b=e.indexOf(a);if(b>=0)return k.push(f[b]),void(e[b]=null);j||(j={},["tagLabel","tagTooltip","tagClass"].forEach(function(a){var b=d.$scope[a+"RawExpression"];if(b){var c=d.$interpolate(b);j[a]=function(a){return a.$eval(c)}}}));var c=d.tagRenderer(i,a,j);c&&k.push(c)});for(var g=0;g<e.length;g++)e[g]&&b.element(f[g]).remove();return k.length?(a.css("display",""),i=b.element(document.createDocumentFragment()),b.forEach(k,function(a){i.append(a)}),void a.append(i)):void a.css("display","none")},tagRenderer:function(a,b,c){var e=v.createElement(a,"li",{id:"cm_ctag_"+d++,$cm_type:"tag",tabIndex:-1,$cm_focusable:!0}),f=this.$scope.$parent.$new();e.on("$destroy",function(){f.$destroy()}),f.$tag=b,this.$scope.tagVar&&(f[this.$scope.tagVar]=b);var g="";c.tagLabel&&(g=f.$eval(c.tagLabel)),"function"==typeof b.toTagText&&(g=b.toTagText()),g||(g=b.toString()),e.data("cm_tag",b),v.createElement(e,"span",{className:"cm_combo_tagBLabel",textNode:g});var h=v.createElement(e,"a",{$cm_type:"tagRemove",href:"javascript:void(0)","aria-hidden":!0,tabIndex:-1,$cm_classes:"fa fa-times"});this.tagRemoveStyleUpdate(h);var i="";c.tagTooltip&&(i=f.$eval(c.tagTooltip)),"function"==typeof b.toTagTooltip&&(i=b.toTagTooltip()),i&&e.attr("title",i);var j="";return c.tagClass&&(j=f.$eval(c.tagClass)),j&&e.prop("cm_classes",j),this.tagStyleUpdate(e),e},_onMouseOver:function(){var a=this;return function(b){var c=b.target,d=E(c);w.SwitchOnState(a,d,"over")}},_onMouseOut:function(){var a=this;return function(b){var c=b.relatedTarget,d=E(c);w.SwitchOffState(a,d,"over")}},_onFocus:function(){var a=this;return function(b){var c=b.target,d=E(c);w.SwitchOnState(a,d,"focus")}},_onBlur:function(){var b=this;return function(c){var d=c.relatedTarget;a.debug("blur=",c.relatedTarget,c.target,c.source);var e=E(d);w.SwitchOffState(b,e,"focus"),!e.combo&&b.isPopupOpened()&&u(function(){b.containerElement.hasAttribute("cm_focus")||b.$scope.$broadcast(h,"blur",c)},100,!1)}},_onMouseDown:function(){var a=this;return function(b){var c=b.target,d=E(c);w.SwitchOnState(a,d,"mouseDown")}},_onMouseUp:function(){var a=this;return function(){var b=E();w.ClearState(a,b,"mouseDown")}},_onKeyDown:function(){this.$scope;return function(a){var b=a.target,c=(E(b),!1);c&&(a.stopPropagation(),a.preventDefault())}},_onKeyPress:function(){{var c=this;this.$scope}return function(d){var e=d.target,f=E(e),g=(c.isPopupOpened(),!1);if(f.input){var h=f.input;switch(d.keyCode){case z.VK_BACK_SPACE:if(!h.selectionStart&&!h.selectionEnd){var i=x.GetPreviousFocusable(c.containerElement,e);if(i){var j=b.element(i).data("cm_tag");if(!j){a.error("No data associated to tag element "+f.tag);break}c.processTagRemove(j)}}}}else switch(d.keyCode){case z.VK_DELETE:case z.VK_BACK_SPACE:g=!0}g&&(d.stopPropagation(),d.preventDefault())}},_onKeyUp:function(){var c=this,d=this.$scope;return function(e){var g,i=e.target,j=E(i),q=!1,s=c.isPopupOpened();if(j.input){var t=j.input,u=!1;switch(e.keyCode){case z.VK_LEFT:t.selectionStart||t.selectionEnd||(g=x.GetPreviousFocusable(c.containerElement,i));break;case z.VK_RIGHT:if(t.selectionEnd===t.value.length){var v=d.$broadcast(p,"rightKey",e);!v.done}break;case z.VK_DOWN:if(q=!0,!s){d.$broadcast(f,"downKey",e);break}d.$broadcast(m,"downKey",e);break;case z.VK_UP:if(q=!0,!s){d.$broadcast(f,"upKey",e);break}d.$broadcast(n,"upKey",e);break;case z.VK_RETURN:case z.VK_ENTER:s?d.$broadcast(h,"enterKey",e):d.$broadcast("keyEnter",e);break;default:u=!0}u&&(j.input.cm_changed=!0,d.$broadcast(o,"key",e))}else if(j.item)switch(e.keyCode){case z.VK_UP:q=!0,g=x.GetPreviousFocusable(j.items,i);break;case z.VK_DOWN:q=!0,g=x.GetNextFocusable(j.items,i);break;case z.VK_RETURN:case z.VK_ENTER:var w=b.element(j.item).data("cm_item");w&&d.$broadcast(k,"itemClick",w,null,{clearShadow:!0,updateInput:!0},e),d.$broadcast(h,"itemClick",e),d.$broadcast(l,"itemClick",e)}else switch(e.keyCode){case z.VK_RIGHT:q=!0,g=x.GetNextFocusable(c.containerElement,i);break;case z.VK_LEFT:q=!0,g=x.GetPreviousFocusable(c.containerElement,i);break;case z.VK_DOWN:j.button&&j.button.cm_actionType===r&&!s&&(q=!0,d.$broadcast(f,"downKey",e),d.$broadcast(l,"popupOpened",e));break;case z.VK_UP:j.button&&j.button.cm_actionType===r&&s&&(q=!0,d.$broadcast(h,"upKey",e),d.$broadcast(l,"popupOpened",e));break;case z.VK_DELETE:case z.VK_BACK_SPACE:if(q=!0,j.tag){var y=j.tag&&b.element(j.tag).data("cm_tag");if(!y){a.error("No data associated to tag element "+j.tag);break}g=(e.keyCode===z.VK_DELETE?x.GetNextFocusable:x.GetPreviousFocusable).bind(x)(c.containerElement,i),c.processTagRemove(y)}}if(!q)switch(e.keyCode){case z.VK_ESCAPE:d.$broadcast(h,"escapeKey",e)}g&&g.focus(),q?(e.stopPropagation(),e.preventDefault()):d.$broadcast("cm:keyPress",e,j)}},_onSimpleClick:function(){var c=this,d=this.$scope;return function(e){var g=e.target,i=E(g);if(v.log("Simple click on ",g," elements=",i),i.tagRemove){var j=i.tag&&b.element(i.tag).data("cm_tag");if(!j)return void a.error("No data associated to tag element "+i.tag);c.processTagRemove(j),d.$broadcast(l,"tagRemoved",e)}else if(i.button)i.button.cm_actionType===r&&(c.isPopupOpened()?d.$broadcast(h,"buttonClick",e):d.$broadcast(f,"buttonClick",e),d.$broadcast(l,"popupOpened",e));else if(i.item){var m=b.element(i.item).data("cm_item");m&&d.$broadcast(k,"itemClick",m,null,{},e),d.$broadcast(h,"itemClick",e),d.$broadcast(l,"itemClick",e)}}},_onStyleUpdate:function(){var c=this;return function(d){var e=d.relatedTarget,f=w.GetCMType(e);if(f){var g=b.element(e),h=c[f+"StyleUpdate"];return h?(h.call(c,g),void d.stopPropagation()):void a.error("Can  not find function for "+f)}}},comboStyleUpdate:function(a){var b=y.split(" "),c=this.$scope.className;return c&&b.push(c),w.MixElementClasses(a,b)},iconStyleUpdate:function(a){a[0]&&(a=a[0]);var b=["cm_combo_icon"];return a.iconType&&b.push("cm_combo_icon_"+a.iconType),w.MixElementClasses(a,b,a.fa_classes)},inputStyleUpdate:function(a){return a[0]&&(a=a[0]),w.MixElementClasses(a,["cm_combo_input"])},labelStyleUpdate:function(a){a[0]&&(a=a[0]);var b=["cm_combo_label"];return a.labelType&&b.push("cm_combo_label_"+a.labelType),w.MixElementClasses(a,b,a.fa_classes)},buttonStyleUpdate:function(a){a[0]&&(a=a[0]);var b=["cm_combo_button"];return a.cm_actionType&&b.push("cm_combo_button_"+a.cm_actionType),w.MixElementClasses(a,b,a.fa_classes)},tagsStyleUpdate:function(a){a[0]&&(a=a[0]);var b=["cm_combo_tags"];return w.MixElementClasses(a,b,a.fa_classes)},tagStyleUpdate:function(a){a[0]&&(a=a[0]);var b=["cm_combo_tag"];return a.tagClassName&&b.push("cm_combo_tag_"+a.tagClassName),w.MixElementClasses(a,b,a.fa_classes)},tagRemoveStyleUpdate:function(a){a[0]&&(a=a[0]);var b=["cm_combo_tagRemove"];return w.MixElementClasses(a,b,a.cm_classes)},itemsStyleUpdate:function(a){a[0]&&(a=a[0]);var b=["cm_combo_items"];return w.MixElementClasses(a,b,a.cm_classes)},itemStyleUpdate:function(a){a[0]&&(a=a[0]);var b=["cm_combo_item"];return a.hasAttribute("cm_noSelectable")&&(b=["cm_combo_item_noSelectable"]),w.MixElementClasses(a,b,a.cm_classes)},processTagRemove:function(b){var c=this.$scope,d=c.tags;if(!d)return void a.error("No tags list ?");var e=d.indexOf(b);return 0>e?void a.error("Can not find tag '",b,"' in tags list ",d):void c.$apply(function(){d.splice(e,1)})},isPopupOpened:function(){var a=this.containerElement.querySelector(".cm_combo_items");return a?!0:!1},_renderItems:function(a,c){a.css("visibility","hidden");var e=a[0].getElementsByTagName("li");b.element(e).remove();var f=this.$scope.tabIndex||0,g=document.createDocumentFragment(),h=this;if(c.forEach(function(a){var b=v.createElement(g,"li",{id:"cm_comboItem_"+d++,$cm_type:"item",tabIndex:f,textNode:a.label||"*** no-label ***"});a.className&&b.prop("cm_classes",a.className),b.data("cm_item",a),h.itemStyleUpdate(b)}),!g.firstChild){var i=v.createElement(g,"li",{id:"cm_comboItem_"+d++,$cm_type:"item",tabIndex:f,textNode:v.lang(A,"no_result"),cm_noSelectable:!0});h.itemStyleUpdate(i)}a.append(g),a.css("visibility","")},_buildCriterias:function(){var a=this.$scope;return{ignoreAccents:a.suggestIgnoreAccents,ignoreCase:a.suggestIgnoreCase}},processSuggestRequest:function(c,d,f,l){function o(a,c){var d=y&&document.getElementById(y);d&&(d.removeAttribute("cm_selected"),w.itemStyleUpdate(d)),y=null;var e=null,d=("down"===a?x.GetNextFocusable:x.GetPreviousFocusable).bind(x)(s[0],d);d&&(y=d.id,d.setAttribute("cm_selected",!0),w.itemStyleUpdate(d),e=b.element(d).data("cm_item"),x.EnsureVisible(s[0],d)),p.$broadcast(k,"nextItem",e,null,{clearShadow:!0,updateInput:!0},c)}var p=this.$scope,r=document.createDocumentFragment(),s=v.createElement(r,"ul",{$cm_type:"items"}),t=p.popupMaxHeight;t&&(parseFloat(t)===t&&(t+="px"),s.attr("cm_popupHeight",!0),s.css("maxHeight",t));var u=p.$new(!0);s.on("$destroy",function(){u.$destroy()}),a.debug("Suggest ",c," listItems ...");var w=this,y=null,z=this.listItems(c,-1,this._buildCriterias());z.then(function(a){if(w._renderItems(s,a),"downKey"===f){var b=x.GetNextFocusable(s[0]);b.setAttribute("cm_selected",!0),w.itemStyleUpdate(b),y=b.id,p.$broadcast(j,"openPopup",a[0],null,{clearShadow:!0,updateInput:!1,mergeInput:!0},l)}w.itemsStyleUpdate(s),w.containerElement.appendChild(r),p.$broadcast(g,s)}),u.$on(h,function(){e||s.remove(),w.containerElement.setAttribute("cm_closedPopup",!0),p.$broadcast(i,s)}),u.$on(m,function(a,b,c){o("down",c)}),u.$on(n,function(a,b,c){o("up",c)}),u.$on(q,function(b,c,d,e){a.debug("Process POPUP FILTER_CHANGED_EVENT '"+c+"'  listItems ...");var f=w.listItems(c,-1,w._buildCriterias());f.then(function(a){w._renderItems(s,a),p.$broadcast(j,d,a[0],{clearShadow:!0,updateInput:!1,mergeInput:!0},e)})})},_showProgressMonitor:function(a){function d(a,c,d){var e=f._progressMonitorContainer,g=e&&e.querySelector(".cm_combo_pm_label");if(g){var h;h="string"==typeof d?d:c.getTaskName(),isNaN(d)||(h+=" ("+Math.floor(100*d)+"%)"),b.element(g).text(h)}}var e=this._progressMonitorContainer;if(!a){if(!e)return;return this._progressMonitorContainer=c,b.element(e).remove(),s.when(!1)}var f=this;return a.$on(D.TASKNAME_CHANGED_EVENT,d),a.$on(D.WORK_EVENT,d),e?(d(null,a),s.when(!0)):this._constructProgressMonitor(this.containerElement).then(function(b){return f._progressMonitorContainer=b[0]||b,d(null,a),!0})},_constructProgressMonitor:function(a){var b=v.createElement(a,"div",{id:"cm_cpm_"+d++,className:"cm_combo_pm"});return v.createElement(b,"span",{className:"cm_combo_pm_waitingCircle fa fa-circle-o-notch fa-spin"}),v.createElement(b,"label",{className:"cm_combo_pm_label"}),s.when(b)}}),F}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.renderers.grid");d.value("cm_grid_animation_pageChange","camelia.animations.grid.PageChange");var e={row:!0,group:!0},f={cell:!0,groupTitle:!0},g=300;d.factory("camelia.renderers.grid.core",["$log","$q","$window","$timeout","$exceptionHandler","camelia.core","camelia.cmTypes","camelia.animations.Animation","cm_grid_className","cm_grid_rowIndentPx","camelia.Key","camelia.SelectionProvider","camelia.CursorProvider","camelia.renderers.FiltersPopup","cm_grid_sizerPx","cm_grid_animation_pageChange",function(a,d,h,i,j,k,l,m,n,o,p,q,r,s,t,u){function v(a){var b=l.SearchElements({tcell:null,title:null,cell:null,row:null,table:null,grid:null,group:null,groupExpand:null},"grid",a);return b}function w(a){b.extend(this,a)}return w.prototype={render:function(c){var f=this.$scope;f.$broadcast("cm:dataGrid_rendering");var g=k.createElement(c,"div",{id:this.dataGrid.id,$cm_type:"grid"});this.container=g[0],f.$watch("style",function(a){a=a||"",g.attr("style",a)});var i=this;f.$watch("className",function(){i.gridStyleUpdate(g)});var j=f.tabIndex;(!j||0>j)&&(j=0),this.tabIndex=j,this.rowIndent=0,this.setupGroupProviders(),this.tableInstallWatchs(),f.$on(r.CURSOR_CHANGED,function(c,d){var f=i._selectionSourceEvent;if(a.debug("GridRenderer.CURSOR_CHANGED SourceEvent=",f),d.oldRow){var g=i.getElementFromValue(d.oldRow,e);g&&g.hasAttribute("cm_cursor")&&(g.removeAttribute("cm_cursor"),k.BubbleEvent(g,"cm_update"))}if(d.row){var h=i.getElementFromValue(d.row,e);h&&!h.hasAttribute("cm_cursor")&&(h.setAttribute("cm_cursor",!0),k.BubbleEvent(h,"cm_update"))}var j=i.selectionProvider;if(j){var l=d.row,m=l;if(i.groupProviders){var n=i.getElementFromValue(l,"group");n&&(m=b.element(n).data("cm_rowValues"))}j.run(function(){i.selectionStrategy.select(j,m,l,f,function(a){return i._computeRowRangeFromCursor(l,a)})})}}),g.on("mouseover",this._onMouseOver()),g.on("mouseout",this._onMouseOut()),g.on("mousedown",this._onMouseDown()),g.on("dblclick",this._onDoubleClick()),g.on("click",this._onSimpleClick()),g.on("mouseup",this._onMouseUp()),g.on("keydown",this._onKeyPress()),k.on(g,"focus",this._onFocus(),!0,f),k.on(g,"blur",this._onBlur(),!0,f),f.$on("$destroy",function(){i.tableDestroy();var a=i._deferredRefresh;a&&(i._deferredRefresh=null,a.reject({code:"DESTROYED",message:"Component is destroyed"}))}),g.on("cm_update",this._onGridStyleUpdate()),this.tablePrepareColumns(),f.$broadcast("cm:gridTitleRendering");var l=this.titleRenderer(g);return l=k.ensurePromise(l),l.then(function(c){return f.$broadcast("cm:gridTitleRendered"),i._title=c,f.$broadcast("cm:gridBodyRendering"),i._monitorPositions(function(){var c=b.element(document.createDocumentFragment()),e=k.createElement(c,"div",{styleClass:"cm_dataGrid_bcontainer"});i.bodyContainer=e[0];var j=i.tableViewPortRenderer(e);j=k.ensurePromise(j),j.then(function(e){i.tableViewPort=e,g.append(c),f.$broadcast("cm:gridBodyRendered");var j=b.element(h),l=i._onResize();j.on("resize",l),f.$on("$destroy",function(){j.off("resize",l)});var m=i.gridLayout();m=k.ensurePromise(m),m.then(function(){f.$broadcast("cm:gridRendered"),f.$on(q.SELECTION_CHANGED_EVENT,i._onSelectionChanged()),i._gridReady(g).then(function(){return f.$broadcast("cm:gridReady",!0),d.when(!0)},function(b){return f.$broadcast("cm:gridReady",!1,b),a.error("GridReady error ",b),d.reject(b)})})})}),g})},setupGroupProviders:function(){this.selectedGroupProvider=null;var a=this.groupProviders;if(a)for(var b=0;b<a.length;b++){var c=a[b];if(!k.toBoolean(c.disabled)){this.selectedGroupProvider=c;break}}if(this.selectedGroupProvider){this.rowIndent=1;var d=this;this.selectedGroupProvider.collapsedProvider.$on(q.SELECTION_CHANGED_EVENT,d._onCollapsedChanged())}},_gridReady:function(b,c){a.debug("Grid ready element=",b," focus=",c);var e,g;if(this.focusCellId&&(g=document.getElementById(this.focusCellId),g&&(e=g.parentNode)),!e&&this.selectionProvider){var h=this.selectionProvider.getFirstElement();h&&(e=this.getElementFromValue(h,"row"))}if(!e&&(e=this.getFirstRow(),!e))return d.when(!1);if(!g&&(g=l.GetNextType(e.firstChild,f),!g))return d.when(!1);if(!c)return this._setCursor(g),d.when(!0);var j=10;return i(function m(){return g.getBoundingClientRect().width?(k.setFocus(g),!0):--j>0?i(m,100,!1):d.reject({code:"COMPONENT_NOT_DRAWN",message:"The specified component is not drawn"})},100,!1)},_setCursor:function(a,c){var d=this.focusCellId;if(d&&(!a||a.id!==d)){this.focusCellId=null;var e=document.getElementById(d);e&&(e.tabIndex=-1)}if(a&&(this.focusCellId=a.id,a.tabIndex=this.tabIndex,this.cursorProvider)){var f=a.parentNode,g=b.element(f).data("cm_value");this.registerElement(f,g);var h=a.cm_lindex,i=this.columns[h];this.cursorProvider.requestCursor(g,i,c)}},gridStyleUpdate:function(a){var b=n.split(" "),c=this.$scope.className;return c&&b.push(c),l.MixElementClasses(a,b)},gridLayout:function(){var c=this.container,e=this.layoutState;this.layoutState="uninitialized",a.debug("GridLayout beginning (containerSize="+this._containerSizeSetted+")");var f,g=this,h=b.element(c);if(!this.tableViewPort){a.error("Table view port is NULL"),f=this.bodyContainer.getBoundingClientRect();var j=this.titleLayout(h,f.width);return j=k.ensurePromise(j),j.then(function(){return g.layoutState="bodyDone",g._alignColumns(!0),g._showBody(),g.layoutState="complete",d.when(!0)})}if(!this._containerSizeSetted){var l=this.container.style;if(l.width||l.height){var m=this.container.getBoundingClientRect();if(m.height&&m.width){this._containerSizeSetted=!0;var n=(this.titleViewPort.getBoundingClientRect(),this.tableViewPort.style);n.width=m.width+"px"}}else this._containerSizeSetted=!0}if(f=this.tableViewPort.getBoundingClientRect(),!f||f.width<1&&f.height<1)return a.debug("No bounding client rect ",f,"  => timeout 10ms"),"uninitialized"!==e&&this._hideBody(),i(function(){return g.gridLayout()},10,!1);if(this.gridWidth===f.width&&this.gridHeight===f.height)return a.debug("Begin layout : Already done"),g._alignColumns(!0),g._showBody(),this.layoutState="complete",d.when(!0);a.debug("Begin layout to "+f.width+","+f.height),this.gridWidth=f.width,this.gridHeight=f.height,this.$scope.$broadcast("cm:dataGrid_layout_begin");var j=this.titleLayout(h,f.width);return j=k.ensurePromise(j),j.then(function(){g.layoutState="titleDone";var a=g.tableLayout(h,f.width,f.height);return a=k.ensurePromise(a),a.then(function(){return g.layoutState="bodyDone",g._alignColumns(!0),g._showBody(),g.layoutState="complete",g.$scope.$broadcast("cm:gridLayoutEnd"),d.when(!0)})})},_hasData:function(){var a=this.getTableBody();return a&&a.firstChild},_alignColumns:function(d){a.debug("_alignColumns: Align column constraints=",d);var e=0,f=!1,g=this.rowIndent,h=this;if(b.forEach(this.visibleColumns,function(b){var i=b.titleElement.style,j=b.width;if(j===c)return f=!0,void(i.width="auto");var k=j;!b.visibleIndex&&g&&(k-=g*o),i.width=j+"px",h.tableViewPort&&(b.bodyColElement.style.width=d?k+"px":"auto"),e+=j,a.debug("_alignColumns: GridWidth["+b.id+"] set width="+j+" total="+e)}),a.debug("_alignColumns: GridWidth old="+this.gridWidth+" total="+e+" invalidLayout="+f),f)return this.tableElement.style.width="auto",void a.debug("_alignColumns: ... Invalid layout");var i=(this.gridWidth,0);this.hasResizableColumnVisible&&(i=t),this.rightColElement&&(this.rightColElement.style.width=i+"px",e+=i),this.tableElement.style.width=d?e+"px":"auto",a.debug("_alignColumns: total="+e+" sizer="+i+" columnConstraints="+d)},_computeRowRangeFromCursor:function(a,c){var d,f,g=[],h=this.getTableBody();if(!h)return null;for(var i=h.firstChild;i;i=i.nextSibling)if(i.nodeType===Node.ELEMENT_NODE){var j=l.GetCMType(i);if(e[j]){var k=b.element(i).data("cm_value");if(d||k!==c||(d=!0),f||k!==a||(f=!0),(d||f)&&g.push(k),d&&f)return g}}return null},_emitClick:function(a,c,d){var e=a.row;if(e){var f=b.element(e).data("cm_value"),g={grid:this.grid,event:d,row:e,rowValue:f},h=a.cell;if(h){g.cell=h;var i=h.cm_lindex;g.column=this.columns[i]}this.$scope.$emit(c,g)}},onKeyPress_Cell:function(a,d,g){function h(){if((!r||r.id===n.id)&&w.rows>0){var a=w.first-w.rows;0>a&&(a=0),w.first>a&&w.setFirst(a),r=null}}function i(){if((!r||r.id===n.id)&&w.rows>0){var a=w.first+w.rows;(w.rowCount<0||a<w.rowCount)&&w.setFirst(a),r=null}}var j,m,n=a.parentNode,o=n.parentNode,q=a.cm_lindex,r=n,s=!1,t=!1,u=!1,v=this.tableViewPort;g&&(j=b.element(g).data("cm_value"),m=this.selectedGroupProvider.getCollapsedProvider());var w=this.dataGrid;switch(d.keyCode){case p.VK_DOWN:s=!0,r=l.GetNextType(n.nextSibling,e),i();break;case p.VK_PAGE_DOWN:s=!0,r=l.GetPreviousVisibleType(v,o.lastChild,e),r&&r.id===n.id&&v.scrollHeight>v.offsetHeight&&(v.scrollTop+=v.clientHeight-n.offsetHeight,r=l.GetPreviousVisibleType(v,o.lastChild,e)),i();break;case p.VK_END:s=!0,r=l.GetPreviousType(o.lastChild,e),i();break;case p.VK_UP:s=!0,r=l.GetPreviousType(n.previousSibling,e),h();break;case p.VK_PAGE_UP:s=!0,r=l.GetNextVisibleType(v,o.firstChild,e),r&&r.id===n.id&&(v.scrollTop-=v.clientHeight-n.offsetHeight,r=l.GetNextVisibleType(v,o.firstChild,e)),h();break;case p.VK_HOME:s=!0,r=l.GetNextType(o.firstChild,e),h();break;case p.VK_SPACE:s=!0,t=!0;break;case p.VK_RIGHT:if(s=!0,g)m.contains(j)&&this._toggleGroupExpand(g);else if(b.isNumber(q)){var x=this.columns[q],y=this.visibleColumns[x.visibleIndex+1];y&&(q=y.logicalIndex,u=!0)}break;case p.VK_LEFT:if(s=!0,g)m.contains(j)||this._toggleGroupExpand(g);else if(b.isNumber(q)){var x=this.columns[q];if(x.visibleIndex>0){var y=this.visibleColumns[x.visibleIndex-1];q=y.logicalIndex,u=!0}}}var z=this;if(t){var A=this.selectionStrategy;if(A){var B=b.element(r).data("cm_value");this.registerElement(r,B);var C=B;if(this.groupProviders){var g=this.getElementFromValue(C,"group");g&&(B=b.element(g).data("cm_rowValues"))}A.select(this.selectionProvider,B,C,d,function(a){return z._computeRowRangeFromCursor(C,a)},!0)}}if(r&&r.id!==n.id&&(this.registerElement(r),u=!0),u){var a=l.GetNextType(r.firstChild,f,function(a){return a.cm_lindex===c||q===c?!0:a.cm_lindex===q});a&&(this._registerSelectionEvent(d),k.setFocus(a))}s&&(d.stopPropagation(),d.preventDefault())},_onCollapsedChanged:function(){var a=this;return function(c,d){a._switchElementsFromEvent(d,"group","_collapsed",function(b,c){a.removeRowsOfGroup(c,b)},function(c){var d=b.element(c).data("cm_value");a.addRowsOfGroup(d,c)})}},_onSelectionChanged:function(){var a=this;return function(b,c){a._switchElementsFromEvent(c,"row","_selected")}},_switchElementsFromEvent:function(a,c,d,e,f){var g=a.removed.length+a.added.length,h=g>1?{}:null,i="cm"+d,j=this;a.clearAll&&!a.removed.length?this.forEachBodyElement(c,function(a){a.hasAttribute(i)&&(a.removeAttribute(i),k.BubbleEvent(a,"cm_update"),f&&f(a))},c):b.forEach(a.removed,function(a){var b=j.getElementFromValue(a,c,h);b&&b.hasAttribute(i)&&(b.removeAttribute(i),k.BubbleEvent(b,"cm_update"),f&&f(b))}),b.forEach(a.added,function(a){var b=j.getElementFromValue(a,c,h);b&&!b.hasAttribute(i)&&(b.setAttribute(i,!0),k.BubbleEvent(b,"cm_update"),e&&e(b,a))})},_onResizeColumnMoving:function(a,b){var c=b.clientX-this.columnMoveClientX,d=this.columnResizingWidth+c;d<a.computedMinWidth&&(d=a.computedMinWidth),a.maxWidth&&d>a.maxWidth&&(d=a.maxWidth),d!==a.width&&(a.width=d,a.specifiedWidth=d,this._alignColumns(!0)),b.preventDefault(),b.stopPropagation()},_onResizeColumnMouseUp:function(b,c){a.debug("On resize column mouse up"),this._onResizeColumnRelease(),this.$scope.$broadcast("cm:dataGrid_resized",b),c.preventDefault(),c.stopPropagation()},_onResizeColumnRelease:function(){a.debug("On resize column release"),this.columnMouseMoveListener&&(document.removeEventListener("mousemove",this.columnMouseMoveListener,!0),this.columnMouseMoveListener=c),this.columnMouseUpListener&&(document.removeEventListener("mouseup",this.columnMouseUpListener,!0),this.columnMouseUpListener=c),this.columnResizing=c,this.columnResizingWidth=c},_onResizeColumn:function(c,d,e){a.debug("On resize column "+c),this._allWidthSpecified||(this._allWidthSpecified=!0,b.forEach(this.visibleColumns,function(a){a.specifiedWidth=a.width})),this.$scope.$broadcast("cm:dataGrid_resizing",c),this.columnResizing&&this._onResizeColumnRelease();var f=this;this.columnMouseUpListener=function(a){return f._onResizeColumnMouseUp(c,a)},this.columnMouseMoveListener=function(a){return f._onResizeColumnMoving(c,a)},document.addEventListener("mousemove",this.columnMouseMoveListener,!0),document.addEventListener("mouseup",this.columnMouseUpListener,!0),this.columnResizing=!0,this.columnResizingWidth=c.width,this.columnMoveClientX=e.clientX,e.preventDefault(),e.stopPropagation()},_toggleColumnSort:function(c){a.debug("Toggle column sort column=",c),this.$scope.$broadcast("cm:dataGrid_sorting");var e=this.sorters,f={},g=!0;e&&b.forEach(e,function(a){var b=a.column;b===c&&(g=!a.ascending);var d=b.titleElement;d&&(d.removeAttribute("cm_ascending"),d.removeAttribute("cm_descending")),f[b.columnId]=b});var h=[];this.sorters=h,h.push({column:c,ascending:g}),b.forEach(h,function(a){var b=a.column,c=b.titleElement,d=!!a.ascending;d?(c.setAttribute("cm_ascending",!0),c.removeAttribute("cm_descending")):(c.setAttribute("cm_descending",!0),c.removeAttribute("cm_ascending")),f[b.columnId]=b}),b.forEach(f,function(a){var b=a.titleElement;b&&k.BubbleEvent(b,"cm_update")});var i=this._refreshRows(),j=this;return i.then(function(){return j.$scope.$broadcast("cm:gridSorted",!0),!0},function(a){return j.$scope.$broadcast("cm:gridSorted",!1,a),d.reject(a)})},_monitorPositions:function(a){var b=this.dataGrid.first,c=this.dataGrid.rows,d=this.dataGrid.rowCount,e=this.dataGrid.maxRows,f=a.call(this);f=k.ensurePromise(f);var g=this;return f.then(function(){var a=g.dataGrid,f=g.$scope,h=a.first,i=a.rows,j=a.rowCount,k=a.maxRows,l={first:h,rows:i,rowCount:j,maxRows:k},m=!1;b!==a.first&&(l.firstChanged=!0,m=!0,f.$broadcast("cm:firstChanged",a.first)),c!==a.rows&&(l.rowsChanged=!0,m=!0,f.$broadcast("cm:rowsChanged",a.rows)),d!==a.rowCount&&(l.rowCountChanged=!0,m=!0,f.rowCount=j,f.$broadcast("cm:rowCountChanged",a.rowCount)),e!==a.maxRows&&(l.maxRowsChanged=!0,m=!0,f.maxRows=k,f.$broadcast("cm:maxRowsChanged",a.maxRows)),m&&f.$broadcast("cm:positionsChanged",l)})},updateData:function(b,e){a.debug("UpdateData updateColumnWidths="+b+" setFocus="+e),b===c&&(b=!0);var f=this;return this._monitorPositions(function(){return f._refreshRows(b,e).then(null,function(b){return a.error("UpdateData failed ",b),d.reject(b)})})},_hideBody:function(){if(this.tableViewPort){var b=this.tableViewPort.style;b.width="auto",b.visibility="hidden",a.debug("DatagridRenderer.Hide body")}},_showBody:function(){if(this.tableViewPort){var b=this.tableViewPort.style;b.visibility="",a.debug("DatagridRenderer.Show body")}},_clearPageAnimation:function(){var a=this._pageAnimation;if(a){this._pageAnimation=c;try{a.cancel()}catch(b){j(b,"Page Animation cancel() error")}finally{try{a.$destroy()}catch(b){}}}},runPromise:function(a){if(!this._refreshing)try{var b=a();return k.ensurePromise(b)}catch(c){return d.reject(c)}return this._deferredRefresh?this._deferredRefresh:(this._deferredRefresh=d.defer(),this._deferredRefresh)},_refreshRows:function(e,f){if(a.debug("Refresh rows updateColumnWidths=",e,"focus=",f),this.$scope.refreshing)return d.reject({code:"ALREADY_REFRESHING",message:"Already refreshing"});this.$scope.refreshing=!0,e&&(this._naturalWidths=c,this._containerSizeSetted=c,this.gridWidth=-1,this.visibleColumns.forEach(function(a){delete a.naturalWidth,delete a.width})),this._clearPageAnimation();var g=this.dataGrid,h=this.$scope.first;(!b.isNumber(h)||0>h)&&(h=0),g.first=h;var j=this.$scope.rows;b.isNumber(j)||(j=-1),g.rows=j;var l=this.tableViewPort;this.tableViewPort=null;var n=this.errorPage;this.errorPage=null;var o=m.newInstance(u,this.$scope,{first:h,oldFirst:this._renderedFirst,rows:j,renderer:this,oldTableViewPort:l,oldErrorPage:n}),p=this;this._pageAnimation=o;var q=o.start();return q=k.ensurePromise(q),q.then(function(){function b(a,b){o.end().then(function(c){return p.tableViewPort=c,p.gridLayout().then(function(){var c=p._gridReady(p.container,!!f);return p.$scope.$broadcast(a||"cm:gridRefreshed",b),p.container._errored&&(p.container._errored=!1,k.BubbleEvent(p.container,"cm_update"),p.$scope.$emit("cm:error",{source:p.dataGrid,error:!1})),c})})}var e=p.tableRowsRenderer();return e=k.ensurePromise(e),e.then(function(c){c[0]&&(c=c[0]);var d=p.dataGrid;if(a.debug("first=",d.first,"visibleRows=",d.visibleRows,"rows="+d.rows,"maxRows=",d.maxRows,"rowCount="+d.rowCount),!d.visibleRows&&d.first){var e=0;d.maxRows>0&&(e=Math.floor((d.maxRows-1)/d.rows)*d.rows,0>e&&(e=0)),i(function(){a.debug("Change first to "+e),p.$scope.first=e,p.$scope.$digest()},10,!1)}return b()},function(b){a.error("Catch process failed message ",b),o.showErrorPage(b).then(function(a){return a[0]&&(a=a[0]),p.errorPage=a,p.gridLayout().then(function(){p._gridReady(p.container,f!==!1);return p.$scope.$broadcast("cm:gridErrored",b),p.container._errored||(p.container._errored=!0,k.BubbleEvent(p.container,"cm_update"),p.$scope.$emit("cm:error",{source:p.dataGrid,error:!1})),d.reject(b)})})},function(a){return a})["finally"](function(){a.debug("Refresh: finally ..."),p.$scope.refreshing=!1;var b=p._deferredRefresh;b&&(p._deferredRefresh=c,i(function(){b.resolve(!0)},0,!1))})})},_moveColumn:function(a,d,e){var f=this.visibleColumns,g=f[d+(d>a.visibleIndex?1:0)];this._lastVisibleColumn=f[f.length-1],f.splice(a.visibleIndex,1),f.splice(d,0,a);var h=0;b.forEach(f,function(a){a.beforeMovingVisibleIndex=a.visibleIndex,a.visibleIndex=h++});var i=this.moveColumnTitle(a,g);i=k.ensurePromise(i);var j=this;i.then(function(){var b=j.moveColumnTable(a,g);b=k.ensurePromise(b),b.then(function(){j._lastVisibleColumn=c,a.beforeMovingVisibleIndex&&a.visibleIndex||j._alignColumns(!0),e!==!1&&a.buttonElement.focus()})})},_registerSelectionEvent:function(b){a.debug("Register event ",b),this._selectionSourceEvent=b;var d=this;i(function(){a.debug("Unregister event ",b),d._selectionSourceEvent=c},10,!1)},_toggleGroupExpand:function(a){var c=b.element(a),d=c.data("cm_value"),e=this.selectedGroupProvider.getCollapsedProvider(),f=!e.contains(d);f?e.add(d):e.remove(d)},_onTitleCellMouseDown:function(a,c){var d=a.clientX,e=b.element(c).data("cm_column");this._onTitleCellClear(),this.titleCellMoving=!0,this.titleCellMovingClientX=d,this.titleCellMovingLayerX=a.layerX;var f=this;this.titleCellMouseUpListener=function(a){return f._onTitleCellMouseUp(c,a,e)},this.titleCellMouseMoveListener=function(a){return f._onTitleCellMouseMoving(c,a,e)},document.addEventListener("mousemove",this.titleCellMouseMoveListener,!0),document.addEventListener("mouseup",this.titleCellMouseUpListener,!0)},_onTitleCellMouseMoving:function(a,b,c){var d=b.clientX-this.titleCellMovingClientX;(-20>d||d>20)&&(this.titleCellColumnMoving||(this.titleCellColumnMoving=c,this.beginMovingTitleCell(c,b,d,this.titleCellMovingLayerX))),this.titleCellColumnMoving&&this.movingTitleCell(c,b,d,this.titleCellMovingLayerX)},_onTitleCellMouseUp:function(a,c,d){var e=v(c.target);if(this.titleCellColumnMoving){var f=c.clientX-this.titleCellMovingClientX,g=this.endMovingTitleCell(d,c,f);b.isNumber(g)&&this._moveColumn(d,g)}else e.tcell&&e.tcell.id===a.id&&(e.tparams?this._showFilterPopup(d,e.tparams,c,e):a.hasAttribute("cm_sortable")&&this._toggleColumnSort(d,c));return this._onTitleCellClear(),l.ClearState(this,e,"mouseDown"),c.stopPropagation(),!1},_showFilterPopup:function(b,c,e,f){var g=this.dataModel,h=this,i=new s(this.$scope,{},b,g,function(){var b=h._monitorPositions(function(){return h._refreshRows(!1,!1)});return b.then(function(){return h.gridLayout().then(function(a){return h.$scope.$broadcast("cm:gridFiltred",!0),a})},function(b){return a.error("Can not refreshRows failed ",b),h.$scope.$broadcast("cm:gridFiltred",!1,b),d.reject(b)})});return i.$scope.$on("cm:popup_opened",function(){l.SwitchOnState(h,f,"openedPopup")}),i.$scope.$on("cm:popup_closed",function(){l.ClearState(h,f,"openedPopup")}),i.open({reference:c,valign:"bottom",deltaY:2})},_onTitleCellClear:function(){this.titleCellColumnMoving&&(this.endMovingTitleCell(this.titleCellColumnMoving),this.titleCellColumnMoving=c),this.titleCellMouseMoveListener&&(document.removeEventListener("mousemove",this.titleCellMouseMoveListener,!0),this.titleCellMouseMoveListener=c),this.titleCellMouseUpListener&&(document.removeEventListener("mouseup",this.titleCellMouseUpListener,!0),this.titleCellMouseUpListener=c),this.titleCellMoving=c,this.titleCellColumnMoving=c
},onKeyPress_Title:function(a,c,d){var e=a,f=!1,g=b.element(a).data("cm_column");switch(c.keyCode){case p.VK_LEFT:f=!0,c.ctrlKey?g.visibleIndex&&this._moveColumn(g,g.visibleIndex-1):(e=l.GetPreviousType(a.previousSibling,"tcell"),e||(e=l.GetPreviousType(a.parentNode.lastChild,"tcell")));break;case p.VK_RIGHT:f=!0,c.ctrlKey?g.visibleIndex<this.visibleColumns.length-1&&this._moveColumn(g,g.visibleIndex+1):(e=l.GetNextType(a.nextSibling,"tcell"),e||(e=l.GetNextType(a.parentNode.firstChild,"tcell")));break;case p.VK_HOME:f=!0,e=l.GetNextType(a.parentNode.firstChild,"tcell");break;case p.VK_END:f=!0,e=l.GetPreviousType(a.parentNode.lastChild,"tcell");break;case p.VK_SPACE:f=!0,this._toggleColumnSort(g,c);break;case p.VK_DOWN:f=!0,g.titleElement._filtreable&&(d.tparams=g.parametersElement,this._showFilterPopup(g,d.tparams,c,d))}if(e&&e.id!==a.id){var g=b.element(e).data("cm_column");g.buttonElement.focus()}f&&(c.stopPropagation(),c.preventDefault())},_onResize:function(){a.debug("On resize ...");var b=this;return function(){try{b.gridLayout()}catch(a){j(a,"Exception while resizing")}}},_onMouseOver:function(){var a=this;return function(b){var c=b.target;if(!a.columnResizing&&!a.titleCellMoving){var d=v(c);l.SwitchOnState(a,d,"over")}}},_onMouseOut:function(){var a=this;return function(b){var c=b.relatedTarget,d=v(c);l.SwitchOffState(a,d,"over")}},_onFocus:function(){var a=this;return function(b){var c=b.target,d=v(c);a._lastFocusEventData=Date.now(),l.SwitchOnState(a,d,"focus",function(c){var d=c.cell||c.groupTitle;d&&a._setCursor(d,b)})}},_onBlur:function(){var a=this;return function(b){var c=b.relatedTarget,d=v(c);l.SwitchOffState(a,d,"focus")}},_onDoubleClick:function(){var a=this;return function(b){var d=b.target,e=v(d);if(e.group){var f=a._groupSimpleClickPromise;return f&&(a._groupSimpleClickPromise=c,i.cancel(f)),void a._toggleGroupExpand(e.group)}a._emitClick(e,"RowDoubleClick",b)}},_onSimpleClick:function(){var a=this;return function(c){var d=c.target,e=v(d);if(!a._lastFocusEventData&&e.row&&e.cell){var f=b.element(e.row).data("cm_value");a.registerElement(e.row,f);var g=e.cell.cm_lindex,h=a.columns[g],i=a.cursorProvider,j=i.getRow(),k=i.getColumn();if(h===k&&f===j){var l=a.selectionProvider;l&&l.run(function(){a.selectionStrategy.select(l,f,f,c,function(b){return a._computeRowRangeFromCursor(f,b)})})}}a._lastFocusEventData=0,a._emitClick(e,"RowClick",c)}},_onMouseDown:function(){var a=this;return function(d){var e=d.target,f=v(e);l.SwitchOnState(a,f,"mouseDown",function(e){var f=e.tsizer;if(f){var h;if(e.tcell){var j=b.element(e.tcell).data("cm_column"),k=j.visibleIndex;h=a.visibleColumns[k-1]}else h=a.visibleColumns[a.visibleColumns.length-1];return a._onResizeColumn(h,f,d),!1}var l=e.groupExpand;if(l)return a._toggleGroupExpand(e.group),!1;var m=e.row;m&&(a.registerElement(m),a._registerSelectionEvent(d,!1));var n=e.tcell;if(n)return a._onTitleCellMouseDown(d,n),d.stopPropagation(),!1;if(e.group){var o=a._groupSimpleClickPromise;return o&&(a._groupSimpleClickPromise=c,i.cancel(o)),a._groupSimpleClickPromise=i(function(){a._groupSimpleClickPromise=c,a.registerElement(e.group),a._registerSelectionEvent(d,!1),e.groupTitle&&e.groupTitle.focus()},g,!1),d.stopPropagation(),d.preventDefault(),!1}return d.stopPropagation(),!1})}},_onMouseUp:function(){var a=this;return function(){var b=v();l.ClearState(a,b,"mouseDown",function(){})}},_onKeyPress:function(){var a=this;return function(b){var c=b.target,d=v(c);return d.tcell?a.onKeyPress_Title(d.tcell,b,d):d.cell?a.onKeyPress_Cell(d.cell,b):d.groupTitle?a.onKeyPress_Cell(d.groupTitle,b,d.group):void 0}},_onGridStyleUpdate:function(){var a={grid:"gridStyleUpdate",table:"tableStyleUpdate",row:"rowStyleUpdate",cell:"cellStyleUpdate",title:"titleStyleUpdate",tcell:"titleCellStyleUpdate",group:"groupStyleUpdate"},c=this;return function(d){var e=d.relatedTarget,f=l.GetCMType(e);if(f){var g=b.element(e),h=c[a[f]];return h?(h.call(c,g),void d.stopPropagation()):void 0}}}},w}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.renderers.grid"),e=0;d.factory("camelia.renderers.grid.group",["$log","camelia.core","camelia.cmTypes",function(a,d,f){return{groupRenderer:function(a,f,g,h,i,j){var k=(a.ownerDocument||document,d.createElement(a,"tr",{id:"cm_group_"+e++,role:"row",tabIndex:-1,$cm_groupIndex:h,cm_collapsed:i?!0:c})),l=k[0],m=f.titleClassMode;if(m===c){m=0;var n=f.$scope.titleClassRawExpression;if(n&&n.length){var o=this.$interpolate,p=n;m=3,n.indexOf(o.startSymbol())>=0?(m=1,p=this.$interpolate(n)):"{"===n.charAt(0)&&"}"===n.charAt(n.length-1)&&(m=2),f.titleClassExpression=p}f.titleClassMode=m}if(m){var q=f.titleClassExpression;if(3!==m&&(q=g.$eval(q)),q)if(b.isString(q))l.cm_groupClasses=q.split(" ");else if(b.isObject(q)){var r=[];b.forEach(q,function(a,b){a&&r.push(b)}),r.length&&(l.cm_groupClasses=r)}}this.groupStyleUpdate(k);{var s=d.createElement(k,"td",{id:"cm_groupTitle_"+e++,tabIndex:-1,nowrap:"nowrap",role:"rowgroup",className:"cm_dataGrid_gcell",colspan:this.visibleColumns.length+1+this.rowIndent});this.groupTitleRenderer(s,f,g,h,j)}return k},groupTitleRenderer:function(a,b,c){var f=d.createElement(a,"div",{className:"cm_dataGrid_gcontainer"}),g=(d.createElement(f,"div",{className:"cm_dataGrid_gexpand",id:"cm_groupExpand_"+e++}),d.createElement(f,"label",{className:"cm_dataGrid_glabel"})),h=b.interpolatedTitleExpression;if(!h){var i=b.$scope.titleRawExpression;i&&(h=this.$interpolate(i),b.interpolatedTitleExpression=h)}if(h){var j=c.$eval(h);j&&g.text(j)}d.createElement(f,"div",{className:"cm_dataGrid_gline"})},groupStyleUpdate:function(a){var b=a;b[0]&&(b=b[0]);var c=["cm_dataGrid_group"];return b.cm_groupClasses&&c.push.apply(c,b.cm_groupClasses),f.MixElementClasses(b,c)}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.renderers.grid"),e=0;d.factory("camelia.renderers.grid.row",["$log","$interpolate","camelia.core","camelia.cmTypes",function(a,d,f,g){return{rowRenderer:function(a,d,g,h,i){if(!d)throw new Error("RowScope is invalid "+d);var j=(a.ownerDocument||document,f.createElement(a,"tr",{id:"cm_row_"+e++,role:"row",tabIndex:-1,$cm_rowIndex:g})),k=j[0];k._rowIdent=h;var l=this.rowClassMode;if(l===c){l=0;var m=this.$scope.rowClassRawExpression;if(m&&m.length){var n=this.$interpolate,o=m;l=3,m.indexOf(n.startSymbol())>=0?(l=1,o=this.$interpolate(m)):"{"===m.charAt(0)&&"}"===m.charAt(m.length-1)&&(l=2),this.rowClassExpression=o}this.rowClassMode=l}if(l){var p=this.rowClassExpression;if(3!==l&&(p=d.$eval(p)),p)if(b.isString(p))k.cm_rowClasses=p.split(" ");else if(b.isObject(p)){var q=[];b.forEach(p,function(a,b){a&&q.push(b)}),q.length&&(k.cm_rowClasses=q)}}var r=this.selectionProvider;r&&r.contains(d.$row)&&k.setAttribute("cm_selected",!0),this.rowStyleUpdate(j);for(var s=0;h>s;s++){f.createElement(j,"td",{id:"cm_cindent_"+e++,"aria-hidden":"true"})}var t=this,u=0;return b.forEach(this.visibleColumns,function(a){var b=a.scope?"th":"td",c=e++,h=f.createElement(j,b,{id:"cm_cell_"+c,"aria-labelledBy":a.labelElement.id+" cm_cell_"+c,tabIndex:-1,nowrap:"nowrap",role:"gridcell",$cm_lindex:a.logicalIndex});h.attr("cm_"+(a.cellAlign||"left"),!0),a.visibleIndex||h.attr("cm_first",!0),a.visibleIndex===t.visibleColumns.length-1&&h.attr("cm_last",!0),a.scope&&h.attr("scope","row"),t.cellStyleUpdate(h),t.cellRenderer(h,d,g,a,u,i),u++}),f.createElement(j,"td",{"aria-hidden":"true"}),j},rowStyleUpdate:function(a){var b=a;b[0]&&(b=b[0]);var c=b.cm_rowIndex,d=["cm_dataGrid_row","cm_dataGrid_row_"+(c%2?"odd":"even")];b.cm_rowClasses&&d.push.apply(d,b.cm_rowClasses);var e=b.hasAttribute("cm_selected"),f=0;return e&&(f|=1),b.ariaState!==f&&(b.ariaState=f,e?b.setAttribute("aria-selected",!0):b.removeAttribute("aria-selected")),g.MixElementClasses(b,d)},cellRenderer:function(a,b,d,e,g,h){var i,j=e.cellTemplates;if(j)for(var k=j.templates,l=0;l<k.length;l++){var m=k[l],n=j.enabledExpressions[m.id];if(!n||b.$eval(n)!==!1){var o=m.transclude(a,b);return h.value=!1,e.editable===!1,o}}var p=f.createElement(a,"label",{className:"cm_dataGrid_clabel"}),q=e.valueExpression;return q?(e.$scope.watched?(h.value=!1,b.$watch(e.interpolatedExpression,function(a){p.text(a===c?"":a)})):(q&&(i=q(b)),i&&p.text(i)),p):p},cellStyleUpdate:function(a){var b=a;b[0]&&(b=b[0]);var c=b.cm_lindex,d=this.columns[c],e=[],f=["cm_dataGrid_cell"];return d.cellClasses&&f.push.apply(f,d.cellClasses),b.cm_cellClasses&&f.push.apply(f,b.cm_cellClasses),g.MixElementClasses(b,f,e)},computeColumnsNaturalWidths:function(){a.debug("Compute natural widths");var c=this.getFirstRow();if(c){var d=this.tableElement.style.width;if(d&&"auto"!==d)return console.error("**** RESET WIDTH"),this.tableElement.style.width="auto",this.tableElement.style.tableLayout="auto",!1;var e=c.getBoundingClientRect();if(e.width<1)return!1;var f=c.cells,g=this.rowIndent,h=0;b.forEach(this.visibleColumns,function(b){var c=f[b.visibleIndex+g];if(c){var d=c.getBoundingClientRect();b.naturalWidth=d.width,h+=d.width,a.debug("Natural width of #",b.visibleIndex,"=",b.naturalWidth)}}),this._naturalWidths=h}},moveColumnRow:function(a,b,c){var d=a.cells,e=a._rowIdent,f=this.visibleColumns,g=b.beforeMovingVisibleIndex,h=d[g+e],i=c&&d[c.beforeMovingVisibleIndex+e];if(i||(i=d[this._lastVisibleColumn.beforeMovingVisibleIndex+e].nextSibling),a.removeChild(h),a.insertBefore(h,i),!b.visibleIndex){h.setAttribute("cm_first",!0);var j=d[e];c&&j.id===c.id||j.removeAttribute("cm_first")}if(b.visibleIndex===f.length-1){h.setAttribute("cm_last",!0);var k=d[e+f.length-1];c&&k.id===c.id||k.removeAttribute("cm_last")}}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.renderers.grid");d.value("cm_grid_group_animation",0);var e=200,f=0;d.factory("camelia.renderers.grid.table",["$log","$q","$timeout","$injector","$interpolate","$exceptionHandler","camelia.core","camelia.cmTypes","cm_grid_rowIndentPx","cm_grid_group_animation","camelia.TemplateRegistry",function(a,d,g,h,i,j,k,l,m,n,o){function p(a){return function(){a.$destroy()}}return{tableInstallWatchs:function(){var a=this;this.$scope.$watch("caption",function(c){var d=a.tableElement;if(d){var e=d.getElementsByTagName("caption")[0];if(!e){if(!c)return;e=k.createElement(d,"caption",{className:"cm_dataGrid_caption"})}e.text(b.isString(c)?c:"")}});var c=this.visibleColumns;b.forEach(c,function(a){a.$scope.$watch("title",function(c){var d=a.bodyTitleElement;d&&b.element(d).text(c?c:"")})})},tableViewPortRenderer:function(a){var c,d=k.createElement(a,"div",{id:"cm_table_"+f++,className:"cm_dataGrid_table"}),e=d[0],g=this;d.on("scroll",function(){g.titleViewPort.scrollLeft=e.scrollLeft});var h=k.createElement(d,"table",{role:"grid",className:"cm_dataGrid_ttable",cellPadding:0,cellSpacing:0});this.tableElement=h[0];var i=this.$scope.caption;if(i){var j=k.createElement(h,"caption",{className:"cm_dataGrid_caption"});j.text(b.isString(i)?i:"")}var l=this.rowIndent;if(l){var n=k.createElement(h,"colgroup",{className:"cm_dataGrid_colgroupIndent","aria-hidden":"true"});for(c=0;l>c;c++){var o=k.createElement(n,"col",{className:"cm_dataGrid_colIndent"});o[0].style.width=m+"px"}}var p=k.createElement(h,"colgroup",{className:"cm_dataGrid_colgroup"}),q=this.visibleColumns;if(b.forEach(q,function(a){var b=k.createElement(p,"col",{className:"cm_dataGrid_col"});a.bodyColElement=b[0]}),this.hasResizableColumnVisible){var r=k.createElement(p,"col",{"aria-hidden":!0,className:"cm_dataGrid_colSizer"});this.rightColElement=r[0]}var s=k.createElement(h,"thead",{className:"cm_dataGrid_thead"}),t=k.createElement(s,"tr");for(c=0;l>c;c++)k.createElement(t,"th",{className:"cm_dataGrid_thIndent","aria-hidden":"true"});return b.forEach(q,function(a){var b=k.createElement(t,"th",{id:a.columnId,scope:"col"});a.bodyTitleElement=b[0],0===a.visibleIndex&&l&&(b.colspan=1+l);var c=a.$scope.title;c&&b.text(c)}),this.tableStyleUpdate(d),e},tableDestroy:function(){this.lastDataModel=c,this.lastParametersKey=c},newCriteriasExpression:function(a,c){var d=function(b,d){var e=a.$scope.criteriaValue;if(!e&&(e=a.interpolatedExpression,!e))return!1;for(var f=b.$eval(e),g=a._criterias,h=0;h<g.length;h++){var i=g[h],j=c[i.id];if(j&&i.filterData(j,f,b,d,a)!==!1)return!0}return!1};return d.toJson=function(){{var d=[],e={id:a.$scope.criteriaValue||a.$scope.fieldName||a.$scope.id,filters:d};a._criterias}return b.forEach(c,function(a){b.forEach(a,function(b){if(b.enabled){var c={type:b.type||a.type||b.id};d.push(c);var e=b.toJson&&b.toJson();e&&(c.parameters=e)}})}),d.length?e:null},d},tableClearRows:function(a){g(function(){b.element(a).empty()},50,!1)},tablePrepareDataModel:function(a){var c,d=this.visibleColumns,e=this.$scope.varName,f={varName:e},g=null,i=this;b.forEach(d,function(a){var d=a._criterias;if(d&&d.length){var e=a._criteriasContext,h={},j=0;b.forEach(d,function(a){var c=e[a.id];b.forEach(c,function(b){if(b.enabled){var c=h[a.id];c||(c=[],c.type=a.type,h[a.id]=c),c.push(b),j++}})});var l=!!j,m=a.titleElement;if(m.hasAttribute("cm_filtred")!==l&&(l?m.setAttribute("cm_filtred",!0):m.removeAttribute("cm_filtred"),k.BubbleEvent(m,"cm_update")),j){g||(g=[]);var n=i.newCriteriasExpression(a,h);g.push(n);var o=n.toJson();o&&(c||(c=[],f.filters=c),c.push(o))}}});var j,l=this.sorters;if(l&&l.length){j=[];var m=[];f.sorters=m,b.forEach(l,function(a){var b=a.column,c=b.$scope.sorter;c&&(j.push({expression:c,column:b.$scope.id||b.$scope.fieldName||b.id,ascending:a.ascending}),m.push({expression:c,column:b.$scope.id||b.$scope.fieldName||b.id,ascending:a.ascending}))})}var n=this.selectedGroupProvider;n&&(f.groupProvider=n.$scope.id||n.id);var o=b.toJson(f);if(this.lastDataModel===a&&this.lastParametersKey===o)return this.lastDecoratedDataModel;this.lastDataModel=a,this.lastParametersKey=o,this.lastDecoratedDataModel&&(this.lastDecoratedDataModel.$destroyChildren(),this.lastDecoratedDataModel=null),g&&(a.isFilterSupport()||(a=h.invoke(["camelia.FiltredDataModel",function(b){return new b(a,e)}]))),a.setFilters(g),j&&(a.isSortSupport()||(a=h.invoke(["camelia.SortedDataModel",function(b){return new b(a)}]))),a.setSorters(j);var p=!1;n&&(a.isGroupSupport()||(a=h.invoke(["camelia.GroupedDataModel",function(b){return new b(a,n,e)}]),p=!0),a.setGrouped(p)),a.setDataScope(this.$scope.$parent),this.lastDecoratedDataModel=a;var q=this.dataGrid;return q.rowCount=-1,q.maxRows=-1,q.visibleRows=-1,a},tablePrepareColumns:function(){var a=this,d=this.columns,e=[];this.visibleColumns=e,b.forEach(d,function(b){if(!b.visible)return void(b.visibleIndex=-1);b.visibleIndex=e.length,e.push(b);var d=b.valueExpression;if(d===c){d=!1;var f=b.$scope.valueRawExpression;if(!f){var g=b.$scope.fieldName||b.$scope.id;g&&(b.$scope.watched?f=i.startSymbol()+"$row."+g+i.endSymbol():d=function(a){return!a.$row,a.$row[g]})}var h=null;f&&(h=a.$interpolate(f),d=function(a){return a.$eval(h)}),b.interpolatedExpression=h,b.valueExpression=d}var j=b.cellTemplates;j===c&&(b.cellTemplates=o.PrepareTemplates(b.$scope.templates,a.$interpolate,"cell"),b.titleCellTemplates=o.PrepareTemplates(b.$scope.templates,a.$interpolate,"title"))})},tableRowsRenderer:function(){var c=this.dataModel;if(!c)return d.when(!1);var e=this,f=b.element(document.createDocumentFragment()),g=this.tableViewPortRenderer(f);return g=k.ensurePromise(g),g.then(function(b){return e.$scope.$broadcast("cm:tableViewPortCreated",{newTableViewPort:b}),e._tableRowsRenderer1(f).then(function(c){return a.debug("Receive promise success ",c),b},function(b){return a.debug("Receive promise error ",b),e.$scope.$broadcast("cm:pageError",{error:b}),d.reject(b)},function(b){return a.debug("Receive promise notification ",b),e.$scope.$broadcast(b.type,b),b})})},_tableRowsRenderer1:function(){a.debug("_tableRowsRenderer1: start rendering");var c=this,g=this.tableElement,h=this.dataGrid,i=k.createElement(g,"tbody",{className:"cm_dataGrid_tbody",id:"cm_tbody_"+f++});this._alignColumns(!0);var j=this.dataModel;j=this.tablePrepareDataModel(j);var l;j.isGrouped&&j.isGrouped()&&(l=j);var m=l?1:0,n=h.first,o=h.rows,q=n;b.isNumber(h.maxRows)||(h.maxRows=-1),o>0&&j.setFetchProperties({rows:o});var r=j.getRowCount(!1);return r=k.ensurePromise(r),r.then(function(b){function f(a){c._renderedFirst=n,s?(a&&(h.rowCount=n+s),h.maxRows=Math.max(h.maxRows,n+s)):n||(h.rowCount=0,h.maxRows=0),h.visibleRows=s}function g(b){if(!b)return y.notify({type:"rowRendered",count:s}),j.setRowIndex(-1),u&&u.$destroy(),v&&v.$destroy(),f(!0),!1;for(var d=!1;0>o||o>s;){var h;if(y){var i=Date.now();i>z&&(z=i+e,y.notify({type:"rowRendering",count:s,rows:o}))}try{var n=j.getRowData();if(l){v||(v=c.$scope.$parent.$new()),v.$group=null,v.$count=null,v.$row=n,A&&(v[A]=n);var r=l.getGroup(v,n);if(r!==w){w=r,x++,d=B.getCollapsedProvider().contains(r),v.$group=r,v.$count=l.getGroupCount(r);var C={value:!0},D=c.groupRenderer(t,B,v,x,d,C);D.data("cm_rowValues",l.getGroupValues(r)),D.data("cm_value",r),C.value||(D.on("$destroy",p(v)),v.$digest(),v=null);var E=D[0];E._visibleIndex=s,E._rowIndex=q}}if(!d){u||(u=c.$scope.$parent.$new()),u.$index=s,u.$odd=!(1&s),u.$even=!u.$odd,u.$first=0===s,u.$pageNumber=-1,u.$pageCount=-1,u.$rowIndex=q,u.$row=n,u.$grid=c.$scope,A&&(u[A]=n);var F={value:!0},G=c.rowRenderer(t,u,q,m,F);G.data("cm_value",n),F.value||(G.on("$destroy",p(u)),u=null)}if(q++,s++,o>0&&s>=o)break;j.setRowIndex(q),h=j.isRowAvailable()}catch(H){throw j.setRowIndex(-1),u&&u.$destroy(),v&&v.$destroy(),a.error("isRowAvailable() returns error ",H),H}if(k.isPromise(h))return h.then(function(a){return g(a)});if(h!==!0)break}return y.notify({type:"rowRendered",rows:o}),j.setRowIndex(-1),u&&u.$destroy(),v&&v.$destroy(),f(o>0&&o>s),y.resolve(s)}0>b&&(b=-1),h.rowCount=b;var r,s=0,t=i[0]||i,u=null,v=null,w=null,x=-1,y=d.defer(),z=0,A=c.$scope.varName,B=c.selectedGroupProvider;try{j.setRowIndex(q),r=j.isRowAvailable()}catch(C){return j.setRowIndex(-1),u&&u.$destroy(),h.rowCount=-1,h.maxRows=-1,h.visibleRows=s,d.reject(C)}return r=k.ensurePromise(r),r.then(function(a){return g(a)},function(b){return a.debug("First: error ",b),y.reject(b)},function(a){return y.notify(a)}),y.promise})},tableStyleUpdate:function(a){return l.MixElementClasses(a,["cm_dataGrid_table"],["cm_dataGrid_table_scroll"])},tableLayout:function(){},moveColumnTable:function(a,b){function c(c){var e=a[c],f=b&&b[c];f||(f=d._lastVisibleColumn[c].nextSibling);var g=e.parentNode;g.removeChild(e),g.insertBefore(e,f)}var d=this;c("bodyColElement"),c("bodyTitleElement"),this.forEachBodyElement("row",function(c){d.moveColumnRow(c,a,b)})},removeRowsOfGroup:function(a,c){function d(){var a=e.shift();return b.element(a).remove(),e.length?g(d,n,!1):void 0}for(var e=[],f=c.nextSibling;f;){var h=f.nextSibling,i=l.GetCMType(f);if("group"===i)break;n?e.push(f):b.element(f).remove(),f=h}e.length&&g(d,n,!1)},addRowsOfGroup:function(a,c){function d(){var a=o.$scope.$parent.$new(),b={value:!0};try{var k=h.shift();a.$index=e,a.$odd=!(1&e),a.$even=!a.$odd,a.$first=0===e,a.$pageNumber=-1,a.$pageCount=-1,a.$rowIndex=f,a.$row=k,j&&(a[j]=k);var q=o.rowRenderer(i,a,f,l,b);q.data("cm_value",k),b.value||(q.on("$destroy",p(a)),a.$digest(),a=null),f++,e++}finally{a&&a.$destroy()}return n&&(c.parentNode.insertBefore(i,m),h.length)?g(d,n,!1):void 0}var e=c._visibleIndex,f=c._rowIndex,h=k.CloneArray(b.element(c).data("cm_rowValues"));if(h.length){var i=document.createDocumentFragment(),j=this.$scope.varName,l=this.rowIndent,m=c.nextSibling,o=this;if(!n){for(;h.length;)d();return void c.parentNode.insertBefore(i,m)}g(d,n,!1)}}}}])}(window,window.angular),function(a,b,c){"use strict";var d=32,e=b.module("camelia.renderers.grid"),f=0;e.factory("camelia.renderers.grid.title",["$log","$timeout","camelia.core","camelia.cmTypes","cm_grid_rowIndentPx","cm_grid_sizerPx","camelia.i18n.Grid",function(a,e,g,h,i,j,k){function l(a){return function(){a.$destroy()}}return{titleRenderer:function(a){var c=g.createElement(a,"div",{id:"cm_title_"+f++,className:"cm_dataGrid_title"});this.titleViewPort=c[0];var d=g.createElement(c,"ul",{className:"cm_dataGrid_ttitle"});this.titleBarElement=d[0],this.titleStyleUpdate(c);var e=this.columns,h=0,i=-1;this.hasResizableColumnVisible=!1;var j=this;b.forEach(e,function(a){if(a.logicalIndex=h,a.columnId="cm_column_"+f++,a.scope&&(i>=0?a.scope=!1:i=h),a.visible){var b=g.createElement(d,"li",{id:"cm_tcell_"+f++,$cm_columnIndex:h});a.titleElement=b[0],b.data("cm_column",a),j.titleCellRenderer(b,a,h),j.titleCellStyleUpdate(b),a.$scope.resizeable&&(j.hasResizableColumnVisible=!0)}h++}),0>i&&e[0]&&(e[0].scope=!0);var k=g.createElement(d,"li",{className:["cm_dataGrid_tcell","cm_dataGrid_tcell"],"aria-hidden":!0,cm_align:"right"});return g.createElement(k,"span"),this.titleCellRenderer(k),this.lastTitleCellElement=k[0],c},titleStyleUpdate:function(a){return h.MixElementClasses(a,["cm_dataGrid_title"])},titleCellTemplate:function(a,b){var c=b.titleCellTemplates;if(!c)return!1;var d=c.templates,e=this.$scope.$parent.$new();e.$index=b.logicalIndex,e.$visibleIndex=b.visibleIndex,e.$odd=!(1&b.visibleIndex),e.$even=!e.$odd,e.$column=b.$scope,e.$grid=this.$scope;for(var f=0;f<d.length;f++){var g=d[f],h=c.enabledExpressions[g.id];if(!h||e.$eval(h)!==!1){var i=g.transclude(a,e);return a.on("$destroy",l(e)),i}}return e.$destroy(),!1},titleCellRenderer:function(a,b){a[0]&&(a=a[0]);var c=a,d=null,e=!1,h=this;if(b){var i=f++,j=c,k=g.createElement(j,"button",{className:"cm_dataGrid_tbutton",tabIndex:this.tabIndex,role:"columnheader"});b.buttonElement=k[0],j=k;var l=b.$scope.sorter;if(l){{g.createElement(c,"div",{className:"cm_dataGrid_tcursor"})}c.setAttribute("cm_sortable",!0)}var m=(b.$scope.title,this.titleCellTemplate(j,b));if(!m){var n=g.createElement(j,"label",{className:"cm_dataGrid_tlabel"});b.$scope.$watch("title",function(c){n.text(c?c:""),h.titleAriaMessages(a,b,!0)}),m=n[0]}if(m.id||(m.id="cm_tlab_"+i),b.labelElement=m,b._criterias&&b._criterias.length){var o=g.createElement(c,"button",{className:"cm_dataGrid_tparams",tabIndex:-1,"aria-hidden":!0,id:"cm_tparams_"+f++});b.parametersElement=o[0],k.attr("aria-expanded",!1),g.createElement(o,"div",{className:"cm_dataGrid_tpArrow fa fa-caret-down"}),g.createElement(o,"div",{className:"cm_dataGrid_tpFiltred fa fa-check"}),e=!0,c.setAttribute("cm_filtreable",!0)}var p=b.visibleIndex-1;p>=0&&(d=this.visibleColumns[p])}else d=this.visibleColumns[this.visibleColumns.length-1];var q=g.createElement(c,"div",{className:"cm_dataGrid_tsizer "+(e?"cm_dataGrid_tsizerHP":""),id:"cm_tsizer_"+f++}),r=q[0];b?b.sizerElement=r:this.lastSizerElement=r,d&&g.toBoolean(d.$scope.resizeable)||(r.style.display="none")},titleCellStyleUpdate:function(a){a[0]&&(a=a[0]);var c=a,d=c.cm_columnIndex,e=this.columns[d];this.titleAriaMessages(a,e);var f=null,g=b.isString(e.titleAlign)?e.titleAlign:e.cellAlign;return g&&(f=["cm_dataGrid_talign_"+g]),h.MixElementClasses(a,["cm_dataGrid_tcell"],f)},titleAriaMessages:function(a,b,c){var d=0,e=null;a.hasAttribute("cm_sortable")&&(d|=1,e="sortableColumn",a.hasAttribute("cm_ascending")?(d|=2,e="sortAscending"):a.hasAttribute("cm_descending")&&(d|=4,e="sortDescending")),(c||b._ariaSorter!==d)&&(b._ariaSorter=d,g.setAudioDescription(b.buttonElement,e&&g.lang(k,e),"sorter"));var f=0,h=null;a.hasAttribute("cm_filtreable")&&(f|=1,h="filtreableColumn",a.hasAttribute("cm_filtred")&&(d|=2,h="filtredColumn")),(c||b._ariaFiltred!==f)&&(b._ariaFiltred=f,g.setAudioDescription(b.buttonElement,h&&g.lang(k,h),"filtred"))},titleLayout:function(f,g){var h=this;if(a.debug("Title layout begining width=",g,"hasResizableColumnVisible=",this.hasResizableColumnVisible,"sizePx=",j),this._hasData()&&!this._naturalWidths){var k=this.computeColumnsNaturalWidths();if(a.debug("computeColumnsNaturalWidths returns",k),k===!1)return void e(function(){return h.titleLayout(f,g)},10,!1)}var l=g,m=0,n=0,o=[],p=this.rowIndent;if(this.hasResizableColumnVisible&&(l-=j),b.forEach(this.visibleColumns,function(b){var e=!b.visibleIndex&&p*i,f=b.minWidth||0;(!f||d+e>f)&&(f=d+e),b.computedMinWidth=f;var g=b.specifiedWidth;if(g!==c&&g>0)return l-=g,b.width=g,b.widthType="specified",void a.debug("compute column fixed #",b.visibleIndex,"cminWidth=",b.minWidth,"minWidth=",f,"specifiedWidth=",g);var h=b.specifiedWidthPercent;if(h!==c&&h>0)return n++,b.widthType="percent",b.layoutFinished=c,b.width=f,l-=f,b.naturalWidth>f&&(m+=b.naturalWidth-f),a.debug("compute column % #",b.visibleIndex,"cminWidth=",b.minWidth,"minWidth=",f,"naturalWidth=",b.naturalWidth),void o.push(b);var j=b.naturalWidth||0;j<b.computedMinWidth&&(j=b.computedMinWidth),b.maxWidth&&j>b.maxWidth&&(j=b.maxWidth),b.width=j,l-=j,b.widthType="natural",a.debug("compute column natural #",b.visibleIndex,"cminWidth=",b.minWidth,"cmaxWidth=",b.maxWidth,"minWidth=",f,"width=",j,"naturalWidth=",b.naturalWidth,"computedMinWidth=",b.computedMinWidth)}),n)for(var q=!0;q&&l>=1;){var r=0;b.forEach(o,function(a){a.layoutFinished||(r+=a.specifiedWidthPercent)});var s=l;b.forEach(o,function(a){if(!a.layoutFinished){var b=s*(a.specifiedWidthPercent/r);b>l&&(b=l);var c=a.width+b;if(a.minWidth&&c<a.minWidth&&(c=a.minWidth),a.maxWidth&&c>a.maxWidth&&(c=a.maxWidth),c===a.width)return void(a.layoutFinished=!0);l-=c-a.width,a.width=c,q=!0}})}else this.fillWidth;a.debug("Total leftWidth=",l,"totalNatural=",m,"countPercent=",n)},titleCellLayout:function(){},moveColumnTitle:function(a,b){var c=a.titleElement,d=b&&b.titleElement;d||(d=this._lastVisibleColumn.titleElement.nextSibling);var e=c.parentNode;e.removeChild(c),e.insertBefore(c,d);for(var f,h=this.visibleColumns,i=0;i<h.length;i++){var j=h[i].sizerElement;f=i&&g.toBoolean(h[i-1].$scope.resizeable),j.style.display=f?"block":"none"}this.lastSizerElement&&(f=g.toBoolean(h[i-1].$scope.resizeable),this.lastSizerElement.style.display=f?"block":"none")},beginMovingTitleCell:function(a){var c=this.titleBarElement,d=c.getBoundingClientRect(),e=c.style;e.height=d.height+"px",b.forEach(this.visibleColumns,function(a){var b=a.titleElement;a._movingLeft=b.offsetLeft});var f=this.lastTitleCellElement.offsetLeft;a.titleElement.style.zIndex="1000",a.titleElement.style.backgroundColor="transparent",b.forEach(this.visibleColumns,function(a){var b=a.titleElement,c=b.style;c.left=a._movingLeft+"px",c.position="absolute"}),e=this.lastTitleCellElement.style,e.left=f+"px",e.height=d.height+"px",e.position="absolute"},movingTitleCell:function(a,d,e,f){var g=a._movingLeft+e;a.titleElement.style.left=g+"px";var h=g+f;this._movingOverColumnIndex=c;var i=this;b.forEach(this.visibleColumns,function(b){var c=b.titleElement;if(c.id!==a.titleElement.id){var d=b._movingLeft;h<b._movingLeft+b.width&&b._movingLeft<a._movingLeft&&(d+=a.width),h>=b._movingLeft&&(b._movingLeft>a._movingLeft&&(d-=a.width),h<b._movingLeft+b.width&&(i._movingOverColumnIndex=b.visibleIndex)),c.style.left=d+"px",c.style.transition="300ms ease-in-out"}})},endMovingTitleCell:function(a){var d=this._movingOverColumnIndex;this._movingOverColumn=c,a.titleElement.style.zIndex="",a.titleElement.style.backgroundColor="",b.forEach(this.visibleColumns,function(a){var b=a.titleElement,d=b.style;d.left="",d.position="",d.transition="",a._movingLeft=c});var e=this.lastTitleCellElement.style;e.left="",e.height="",e.position="";var f=this.titleBarElement;return e=f.style,e.height="",e.width="",d}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.renderers.grid");d.factory("camelia.renderers.grid.utils",["$log","$timeout","camelia.core","camelia.cmTypes",function(a,d,e,f){return{getTableBody:function(){var a=this.tableElement;if(a)return a.tBodies[0]},getFirstRow:function(){var a=this.getTableBody();return a?f.GetNextType(a.firstChild,"row"):null},forEachBodyElement:function(a,b){var c=this.getTableBody();if(c){var d=c.rows;return f.ForEachElement(d,a,b)}},registerElement:function(a,e){if(!this._cacheValues){this._cacheValues=[],this._cacheElements=[],this._cacheFilled=!1;var f=this;d(function(){delete f._cacheValues,delete f._cacheElements,delete f._cacheFilled},50,!1)}e===c&&(e=b.element(a).data("cm_value"),e===c||this._cacheValues.indexOf(e)>=0)||(this._cacheElements.push(a),this._cacheValues.push(e))},getElementFromValue:function(a,c,d){var e=this._cacheValues;if(e){var g=e.indexOf(a);if(g>=0){var h=this._cacheElements[g];if(c){var i=f.GetCMType(h);if(b.isString(c)){if(i!==c)return null}else if(!c[i])return null}return h}if(this._cacheFilled)return null}var j=this,k=null;return this.forEachBodyElement(c,function(c){var e=b.element(c).data("cm_value");return j.registerElement(c,e),e!==a||(k=c,d)?void 0:!1},c),d&&(this._cacheFilled=!0),k}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.renderers.grid");d.value("cm_filtersPopup_className","cm_popup cm_filtersPopup");var e=0,f="rfilter";d.factory("camelia.renderers.FiltersPopup",["$log","$q","$exceptionHandler","$timeout","camelia.core","camelia.cmTypes","cm_filtersPopup_className","camelia.Key","camelia.renderers.Popup","camelia.i18n.Grid",function(a,d,g,h,i,j,k,l,m,n){function o(a){return j.SearchElements({lfilter:null,ifilter:null,rfilter:null,popup:null},"popup",a)}var p=function(a,b,c,d,e){b=b||{},b.className="cm_filtersPopup",m.call(this,a.$new(!0),b),this._refreshFunc=e,this._column=c,this._dataModel=d,this._closeDestroy=!0};return p.prototype=Object.create(m.prototype),b.extend(p.prototype,{constructor:p,_fillBody:function(a){var c=i.createElement(a,"ul",{className:"cm_filtersPopup_list",role:"group"}),d=this._column._criterias,g=this._column._criteriasContext,h=this;b.forEach(d,function(a){var d=a.contributeFilters(h.dataModel),j=g[a.id]||{},k={};g[a.id]=k;var l=0;b.forEach(d,function(b){var d=b.id;d||(d=a.id+"__"+l++,b.id=d);var g=j[d];g||(g=b),k[d]=g;var m=e++,n=i.createElement(c,"li",{id:"cm_"+f+"_"+m});n.data("context",g);var o=i.createElement(n,"input",{id:"cm_ifilter_"+m,type:"checkbox",className:"cm_filtersPopup_input",name:d});g.enabled&&(o[0].checked=!0);{var p=i.createElement(n,"div",{id:"cm_lfilter_"+m,$inputTarget:o[0].id});i.createElement(p,"label",{id:"cm_llfilter_"+m,className:"cm_filtersPopup_label","for":o[0].id,textNode:b.name||"### unknown ###"})}b.contributeDOM&&b.contributeDOM(c,g,a,h._column),h._labelStyleUpdate(p),h._rowStyleUpdate(n)})});var j=i.createElement(c,"abbr",{id:"cm_filtersPopup_desc_"+e++,className:"cm_audioDescription",textNode:i.lang(n,"criteriaList",{title:this._column.$scope.title})});return c.attr("aria-describedby",j[0].id),this._popupStyleUpdate(a),c},_open:function(a){a.on("keydown",this._onKeyPress()),a.on("mouseover",this._onMouseOver()),a.on("mouseout",this._onMouseOut()),a.on("mouseleave",this._onMouseLeave()),a.on("click",this._onClick()),this._mouseDownListener=this._onMouseDown(),document.body.addEventListener("mousedown",this._mouseDownListener,!0),this._focusListener=this._onFocus(),document.body.addEventListener("focus",this._focusListener,!0),this._blurListener=this._onBlur(),document.body.addEventListener("blur",this._blurListener,!0),a.on("cm_update",this._onStyleUpdate());var b=a.isolateScope(),c=this;b.$on("$destroy",function(){c._close()});var d=a[0].querySelector(".cm_filtersPopup_input");d&&i.setFocus(d)},_close:function(){var a=this._focusListener;a&&(this._focusListener=c,document.body.removeEventListener("focus",a,!0)),a=this._blurListener,a&&(this._blurListener=c,document.body.removeEventListener("blur",a,!0)),a=this._mouseDownListener,a&&(this._mouseDownListener=c,document.body.removeEventListener("mousedown",a,!0))},_popupStyleUpdate:function(a){return j.MixElementClasses(a,["cm_popup","cm_filtersPopup"])},_rowStyleUpdate:function(a){return j.MixElementClasses(a,["cm_filtersPopup_item"])},_labelStyleUpdate:function(a){return j.MixElementClasses(a,["cm_filtersPopup_right"])},_refreshDatas:function(){this._column;this._refreshFunc()},_onMouseOver:function(){var a=this;return function(b){var c=b.target,d=o(c);j.SwitchOnState(a,d,"over")}},_onMouseOut:function(){var a=this;return function(b){var c=b.relatedTarget,d=o(c);j.SwitchOffState(a,d,"over")}},_onMouseLeave:function(){var a=this;
return function(b){var c=b.target,d=o(c);j.SwitchOffState(a,d,"over")}},_onFocus:function(){var a=this;return function(b){var c=b.target,d=o(c);return i.log("FiltersPopup.OnFocus ",c,d,b.relatedTarget),d.popup?void j.SwitchOnState(a,d,"focus",function(){}):void a.close()}},_onBlur:function(){var a=this;return function(b){var c=b.relatedTarget,d=o(c);return i.log("FiltersPopup.OnBlur relatedTarget=",c,"target=",b.target,d),c||b.target?void j.SwitchOffState(a,d,"focus"):void a.close()}},_onClick:function(){var a=this;return function(c){var d=c.target,e=o(d);e.ifilter&&(b.element(e.rfilter).data("context").enabled=!!e.ifilter.checked,a._refreshDatas())}},_onMouseDown:function(){var a=this;return function(c){var d=c.target,e=o(d);if(i.log("FiltersPopup.OnMouseDown ",d,e),!e.popup)return a.close(),c.stopPropagation(),void c.preventDefault();if(e.lfilter){var f=document.getElementById(e.lfilter.inputTarget);f.checked=!f.checked,b.element(e.rfilter).data("context").enabled=f.checked,a._refreshDatas(),h(function(){a.close()},0,!1)}j.SwitchOnState(a,e,"mouseDown",function(){}),c.stopPropagation(),c.preventDefault()}},_onStyleUpdate:function(){var a={popup:"_popupStyleUpdate",rfilter:"_rowStyleUpdate",lfilter:"_labelStyleUpdate"},c=this;return function(d){var e=d.relatedTarget,f=j.GetCMType(e);if(f){var g=b.element(e),h=c[a[f]];return h?(h(g),void d.stopPropagation()):void 0}}},_onKeyPress:function(){var a=this;return function(b){var c=b.target,d=o(c);return d.ifilter?a.performKeyPress_input(d.ifilter,b,d):void 0}},performKeyPress_input:function(a,b,c){var d,e=c.rfilter,g=e.parentNode,k=null,m=this.container,n=this;switch(b.keyCode){case l.VK_DOWN:d=!0,k=j.GetNextType(e.nextSibling,f),k||(k=j.GetNextType(g.firstChild,f));break;case l.VK_PAGE_DOWN:d=!0,k=j.GetPreviousVisibleType(m,g.lastChild,f),k&&k.id===e.id&&m.scrollHeight>m.offsetHeight&&(m.scrollTop+=m.clientHeight-e.offsetHeight,k=j.GetPreviousVisibleType(m,g.lastChild,f));break;case l.VK_END:d=!0,k=j.GetPreviousType(g.lastChild,f);break;case l.VK_UP:d=!0,k=j.GetPreviousType(e.previousSibling,f),k||(k=j.GetPreviousType(g.lastChild,f));break;case l.VK_PAGE_UP:d=!0,k=j.GetNextVisibleType(m,g.firstChild,f),k&&k.id===e.id&&(m.scrollTop-=m.clientHeight-e.offsetHeight,k=j.GetNextVisibleType(m,g.firstChild,f));break;case l.VK_HOME:d=!0,k=j.GetNextType(g.firstChild,f);break;case l.VK_ESCAPE:d=!0,h(function(){n.close()},0,!1)}if(k){var o=k.querySelector(".cm_filtersPopup_input");o&&i.setFocus(o)}d&&(b.stopPropagation(),b.preventDefault())}}),p}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.renderers.items",["camelia.core","camelia.monitors","camelia.i18n.items"]),d=64;c.factory("camelia.renderers.Items",["$log","$q","$exceptionHandler","camelia.core","camelia.CharsetUtils","camelia.monitor.ProgressMonitor","camelia.i18n.Items",function(a,c,e,f,g,h,i){function j(a){b.extend(this,a)}return j.prototype={listItems:function(e,j,k){(!j||0>j||j>d)&&(j=d);var l={inputValue:e,maxItems:j,criterias:k},m=b.toJson(l);if(this._lastKey===m)return c.when(this._lastItems);k=k||{};var n=[],o={list:n,ignoreAccents:k.ignoreAccents,ignoreCase:k.ignoreCase,maxItems:j||this.$scope.maxItems||-1,offset:0,$interpolate:this.$interpolate,$scope:this.$scope};o.ignoreAccents&&(e=g.removeAccents(e)),e&&(o.filterRegexp=new RegExp("^"+f.escapeRegexp(e)+".*$",o.ignoreCase?"i":""));var p=this.$scope.items||[],q=new h(this.$scope);q.beginTask(f.lang(i,"searching"),p.length);for(var r=null,s=this,t=0;t<p.length;t++){var u=p[t];if(u.isVisible()!==!1){var v=u.filter(o,e);if(r)r=q.then(v,1),r=r.then(function(){return o.maxItems>0&&o.list.length>=o.maxItems?void 0:f.callPromise(v,s)});else{if(!f.isPromise(v)){if(o.maxItems>0&&o.list.length>=o.maxItems)break;q.worked(1);continue}r=q.then(v,1)}}else q.worked(1)}return r||(r=c.when(n)),r.then(function(){return q.done(),a.debug("Search of '"+e+"' maxItems="+o.maxItems+" returns "+n.length+" items"),s._lastKey=m,s._lastItems=n,n})}},j}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.renderers.pager",["camelia.components.pager","camelia.i18n.pager"]);d.value("cm_pager_className","cm_pager");var e=0;d.factory("camelia.renderers.Pager",["$log","$q","$exceptionHandler","camelia.core","camelia.cmTypes","camelia.UI","cm_pager_className","camelia.Key","camelia.i18n.Pager",function(a,d,f,g,h,i,j,k,l){function m(a){return h.SearchElements({lpager:null,vpager:null,bpager:null,pager:null},"pager",a)}var n=function(a){b.extend(this,a)};return n.prototype={render:function(a){var b=this.$scope,c=g.createElement(a,"div",{id:this.pager.id,$cm_type:"pager"});this.containerElement=c[0];var d=this;return b.$watch("style",function(a){a=a||"",c.attr("style",a)}),b.$watch("className",function(){d.pagerStyleUpdate(c)}),c.on("mouseover",this._onMouseOver()),c.on("mouseout",this._onMouseOut()),c.on("mousedown",this._onMouseDown()),c.on("click",this._onSimpleClick()),c.on("mouseup",this._onMouseUp()),c.on("keydown",this._onKeyPress()),g.on(c,"focus",this._onFocus(),!0,b),g.on(c,"blur",this._onBlur(),!0,b),c.on("cm_update",this._onStyleUpdate()),c},_onMouseOver:function(){var a=this;return function(b){var c=b.target,d=m(c);h.SwitchOnState(a,d,"over")}},_onMouseOut:function(){var a=this;return function(b){var c=b.relatedTarget,d=m(c);h.SwitchOffState(a,d,"over")}},_onFocus:function(){var a=this;return function(b){var c=b.target,d=m(c);h.SwitchOnState(a,d,"focus")}},_onBlur:function(){var a=this;return function(b){var c=b.relatedTarget,d=m(c);h.SwitchOffState(a,d,"focus")}},_onMouseDown:function(){var a=this;return function(b){var c=b.target,d=m(c);h.SwitchOnState(a,d,"mouseDown")}},_onMouseUp:function(){var a=this;return function(){var b=m();h.ClearState(a,b,"mouseDown")}},_onKeyPress:function(){var a=this;return function(b){var c,d=b.target,e=(m(d),!1);switch(b.keyCode){case k.VK_RIGHT:e=!0,c=i.GetNextFocusable(a.containerElement,d);break;case k.VK_LEFT:e=!0,c=i.GetPreviousFocusable(a.containerElement,d)}e&&(b.stopPropagation(),b.preventDefault()),c&&c.focus()}},_onSimpleClick:function(){var a=this;return function(b){var c=b.target,d=m(c),e=d.bpager;e&&e.value&&!e.disabled&&(a.targetScope.first=parseInt(e.value,10),a.targetScope.$digest())}},_onStyleUpdate:function(){var a={pager:"pagerStyleUpdate",vpager:"valueStyleUpdate",bpager:"buttonStyleUpdate",lpager:"labelStyleUpdate"},c=this;return function(d){var e=d.relatedTarget,f=h.GetCMType(e);if(f){var g=b.element(e),i=c[a[f]];return i?(i.call(c,g),void d.stopPropagation()):void 0}}},pagerPositionsUpdate:function(a){var c=b.element(this.containerElement),d=this.bpager_focus,e=null;if(d){var f=document.getElementById(d);f&&(e={type:f.pagerType,value:f.getAttribute("value")})}c.empty();var h=document.createDocumentFragment(),i={};if(this.renderExpression(h,this.format,a,i),c.append(h),e){var j;switch(e.type){case"bprev":j=["bprev","bnext","index:i0","index:i1"];break;case"bnext":j=["bnext","bprev","index:i0","index:i1"];break;case"uindex":j=["uindex","bprev","index:i0"];break;case"index":var k=parseInt(e.value,10);j=["index:p"+(k+this.$scope.rows),"uindex","index:p"+(k-this.$scope.rows),"bnext","bprev"]}if(j)for(var l=0;l<j.length;l++){var m=i[j[l]];if(m&&!m.attr("disabled")){g.setFocus(m);break}}}},renderExpression:function(a,b,d,e){var f=this.$scope;f.first=d.first,f.rowCount=d.rowCount,f.maxRows=d.maxRows,f.rows=d.rows;var g=f.$new(!1);try{for(var h=null,i=0;i<b.length;){var j=b.charAt(i++);if("{"!==j)if("'"!==j)h||(h=[]),h.push(j);else{h||(h=[]);for(var k=i;;){var l=b.indexOf("'",k);if(0>l){h.push(b.substring(k)),i=b.length;break}{if("'"!==b.charAt(l+1)){h.push(b.substring(k,l)),i=l+1;break}h.push(b.substring(k,l),"'"),k=l+2}}}else{var l=b.indexOf("}",i),m=b.substring(i,l).toLowerCase();i=l+1,h&&h.length&&(this.renderSpan(a,h.join("")),h=null);var n=c,o=m.indexOf(":");if(o>=0){var p=m.substring(o+1);m=m.substring(0,o),n={};for(var q=p.split(";"),k=0;k<q.length;k++){var r=q[k],s="",t=r.indexOf("=");t>=0&&(s=r.substring(t+1),r=r.substring(0,t)),n[r]=s}}this.renderType(a,m,n,e,g)}}h&&h.length&&this.renderSpan(a,h.join(""))}finally{g.$destroy()}},renderSpan:function(a,b){var c=g.createElement(a,"span",{textNode:b,id:"cm_lpager_"+e++});return this.labelStyleUpdate(c),c},renderButton:function(a,b,c,d,f){var h=g.lang(l,c+"_label",d),i=g.lang(l,c+"_tooltip",d),j=g.lang(l,c+"_className",d);f.$value=b,f.$text=h,f.$tooltip=i,f.$disabled=0>b;try{if(this._templates){var k=this._templates[c];if(k){var m=k.transclude(a,f);return m}}var n=g.createElement(a,"button",{id:"cm_bpager_"+e++,$value:b,$pagerType:c}),o=g.createElement(n,"span",{className:"cm_bpager_span "+(j?j:""),textNode:h?h:null});return f.$tooltip&&(n.attr("title",f.$tooltip),n.attr("aria-label",f.$tooltip),o.attr("aria-hidden",!0)),f.$disabled&&n.attr("disabled",!0),this.buttonStyleUpdate(n),n}finally{delete f.$value,delete f.$text,delete f.$tooltip,delete f.$disabled}},renderValue:function(a,b,c,d){if(this._templates){var f=this._templates[c];if(f){var h=f.transclude(a,d);return h}}var i=g.createElement(a,"span",{textNode:b,id:"cm_vpager_"+e++,$pagerType:c});return this.valueStyleUpdate(i),i},renderType:function(a,b,c,d,e){var f=this.$scope,g=f.first,h=f.rowCount,i=f.maxRows,j=f.rows;if(j){e.$parameters=c,e.$type=b;try{switch(b){case"first":case"position":this.renderValue(a,g+1,"first",e);break;case"last":var k=g+j;h>=0&&k>=h?k=h:i>0&&k>=i&&(k=i),this.renderValue(a,k,"last",e);break;case"rowcount":if(0>h)return;this.renderValue(a,h,"rowCount",e);break;case"pagecount":if(0>h||0>=j)return;var l=Math.floor((h-1)/j+1);this.renderValue(a,l,"pageCount",e);break;case"pageposition":if(0>=j)return;var m=Math.floor(g/j)+1;this.renderValue(a,m,"pagePosition",e);break;case"bprev":var n=g-j;0>n&&(n=0);var o=this.renderButton(a,g>0?n:-1,"bprev",null,e);d.bprev=o;break;case"bnext":var n=g+j,p=-1;h>=0?(n+j>h&&(n=h-(h+j-1)%j-1,0>n&&(n=0)),n>g&&(p=n)):p=n;var q=this.renderButton(a,p,"bnext",null,e);d.bnext=q;break;case"bpages":this.appendBPages(a,c,d,e)}}finally{delete e.$value,delete e.$parameters,delete e.$type}}},appendBPages:function(a,b,c,d){var e=this.$scope,f=e.first,h=e.rowCount,i=e.maxRows,j=e.rows;if(!i)return void this.renderValue(a,g.lang(l,"noPages"),"noPages",d);var k=7,m=null;b&&(b.separator&&(m=b.separator),b.pages&&(k=parseInt(b.pages,10)));var n,o=Math.floor(f/j);n=0>h?Math.floor((i+j-1)/j)+1:Math.floor((h+j-1)/j);var p=n;p>k&&(p=k);var q=0;n>p&&(q=o-Math.floor(p/2),q+p>n&&(q=n-p),0>q&&(q=0)),null===m&&(m=g.lang(l,"separator"));for(var r=0;p>r;r++){r>0&&this.renderSpan(a,m,"sep");var s=q+r,t="index",u=s+1;0>h&&s+1===n?(u="...",t="uindex"):s===o&&(t="cindex");var v={pageIndex:s+1};d.$index=r,d.$pageIndex=s,d.$rowIndex=s*j,d.$currentPage=s===o;try{var w=this.renderButton(a,s===o?-1:s*j,t,v,d);"index"===t?(c["index:p"+s*j]=w,c["index:i"+r]=w):c[t]=w}finally{delete d.$index,delete d.$pageIndex,delete d.$rowIndex,delete d.$currentPage}}},pagerStyleUpdate:function(a){var b=j.split(" "),c=this.$scope.className;return c&&b.push(c),h.MixElementClasses(a,b)},labelStyleUpdate:function(a){return a[0]&&(a=a[0]),h.MixElementClasses(a,["cm_pager_label"])},valueStyleUpdate:function(a){return a[0]&&(a=a[0]),h.MixElementClasses(a,["cm_pager_value","cm_pager_value_"+a.pagerType])},buttonStyleUpdate:function(a){return a[0]&&(a=a[0]),h.MixElementClasses(a,["cm_pager_button","cm_pager_button_"+a.pagerType])}},n}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.renderers.popup",["camelia.components.popup"]);d.value("cm_popup_className","cm_popup");var e=0;d.factory("camelia.renderers.Popup",["$log","$q","$exceptionHandler","$timeout","$rootScope","camelia.core","camelia.cmTypes","cm_popup_className","camelia.Key",function(a,d,f,g,h,i,j,k){function l(a,b){b&&(this.configuration=b),this._releaseScope=!0,this.$scope=a||h.$new(!0)}return l.INITIALIZING=1,l.INITIALIZED=2,l.RENDERING=4,l.RENDERED=8,l.OPENED=16,l.CLOSED=32,l.DESTROYED=64,l.prototype={_setState:function(a,b){var c=this._state&~a|(b||0);this._state!==c&&(this._state=c)},_addState:function(a){this._state&a||(this._state|=a)},containsState:function(a){return a?this._state&a:this._state},initialize:function(){if(this.containsState(l.DESTROYED))throw new Error("Already destroyed");if(!this.containsState(l.INITIALIZING)){this._addState(l.INITIALIZING);var a=this._initialize.apply(this,arguments);a=i.ensurePromise(a);var b=this;return a.then(function(){b._addState(l.INITIALIZED);var a=b.render();return a=i.ensurePromise(a)})}},_initialize:function(){},render:function(){if(this.containsState(l.DESTROYED))throw new Error("Already destroyed");if(!this.containsState(l.RENDERING)){this._addState(l.RENDERING),this.$emit("cm:popup_rendering");var a=b.element(document.createDocumentFragment()),c=k;this.configuration.className&&(c+=" "+this.configuration.className);var d=i.createElement(a,"div",{id:"cm_popup_"+e++,className:c});this.container=d[0];var f=this;d.on("$destroy",function(){f.$scope.$destroy()});var g=this._render(b.element(this.container));return g=i.ensurePromise(g),g.then(function(){document.body.appendChild(f.container),f._addState(l.RENDERED),f.$emit("cm:popup_rendered")})}},_render:function(a){return this._fillBody(a,a)},open:function(a){function c(){var e=d.container;return e.offsetWidth||e.offsetHeight?(d.$emit("cm:popup_DOMReady"),e.style.display="",d._updatePosition(e,a),d.$emit("cm:popup_opened"),d._addState(l.OPENED),d._open(b.element(e)),e):g(c,10,!1)}var d=this;if(this.containsState(l.DESTROYED))throw new Error("Already destroyed");if(!this.containsState(l.RENDERED)){if(!this.containsState(l.INITIALIZING)){var e=this.initialize();return e=i.ensurePromise(e),e.then(function(){return d.open(a)})}return null}return this.containsState(l.OPENED)?null:(this._setState(l.CLOSED,0),this._position=a,g(c,10,!1))},_open:function(){},_updatePosition:function(a,c){c=c||{};var d,e;if(b.isNumber(c.X)&&b.isNumber(c.Y))d=c.X,e=c.Y;else if(c.reference){var f=c.reference.getBoundingClientRect();switch(d=f.left,e=f.top,c.halign){case"right":d+=f.width,c.deltaX&&(d+=c.deltaX)}switch(c.valign){case"bottom":e+=f.height,c.deltaY&&(e+=c.deltaY)}}if(!b.isNumber(d))return!1;var g=a.style;return g.left=d+"px",g.top=e+"px",!0},close:function(){if(this.containsState(l.DESTROYED))throw new Error("Already destroyed");if(this.containsState(l.CLOSED)||!this.containsState(l.OPENED))return!1;this._setState(l.OPENED,l.CLOSED);var a=this.container;return a?(a.style.display="none",this._close(b.element(a)),this.$emit("cm:popup_closed"),this._closeDestroy&&this.destroy(),!0):!1},_close:function(){},destroy:function(){if(!this.containsState(l.CLOSED)||this.containsState(l.DESTROYED))return!1;this._setState(l.OPENED,l.DESTROYED);var a=this.container;return a?(this.container=c,b.element(a).remove(),this.$emit("cm:popup_destroyed"),this.$scope&&this._releaseScope&&(this.$scope.$destroy(),this.$scope=c),!0):!1},_fillBody:function(a,b){return b.fillPopup?b.fillPopup(a):void 0},$emit:function(){this.$scope&&this.$scope.$emit.apply(this.$scope,arguments)}},l}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.directives.combo",["camelia.core","camelia.directives.template","camelia.directives.items","camelia.components.combo"]);c.value("cm_combo_componentProviderName","camelia.components.combo:camelia.components.Combo"),c.directive("cmCombo",["$injector","$interpolate","$log","$q","$exceptionHandler","camelia.core","cm_combo_componentProviderName","camelia.directives.TemplateContainer","camelia.directives.ItemsContainer",function(a,b,c,d,e,f,g,h,i){return{restrict:"E",scope:{id:"@",forElementId:"@for",selectedItem:"=?selecteditem",style:"@",className:"@class",maxTextLength:"@maxtextlength",textSize:"@textsize",tabIndex:"@tabindex",tags:"=?",tagVar:"@tagvar",value:"=?",popupMaxHeight:"@popupmaxheight",maxItems:"@maxitems",placeholder:"@placeholder",suggestIgnoreAccents:"@suggestignoreaccents",suggestIgnoreCase:"@suggestignorecase",hasOpenPopupButton:"@hasopenpopupbutton"},controller:["$scope",function(a){var b=a.componentProvider;if(!b){var c=a.componentProviderName||g;b=f.LoadProvider(c)}this.componentProvider=b}],compile:function(){return{pre:function(a,b){h.MarkTemplateContainer(a,b),i.MarkItemsContainer(a,b);var c=b.attr("tags");c&&(a.tagVar=b.attr("tagVar"),a.tagLabelRawExpression=b.attr("tagLabel"),a.tagTooltipRawExpression=b.attr("tagTooltip"),a.tagClassRawExpression=b.attr("tagClass"))},post:function(g,i,j,k){h.RegisterTemplates(g);var l=new k.componentProvider(g,i,b),m=a.invoke(l.construct,l);f.isPromise(m)||(m=d.when(m)),m.then(function(a){c.info("Combo created ",a),i.replaceWith(a)},function(a){a instanceof Error?e(a):c.error("Failed to create combo ",a)})}}}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.directives.grid",["camelia.core","camelia.directives.template","camelia.components.grid"]);c.value("cm_grid_componentProviderName","camelia.components.grid:camelia.components.GridProvider"),c.directive("cmDatagrid",["$injector","$interpolate","$log","$q","$exceptionHandler","camelia.core","cm_grid_componentProviderName","camelia.directives.TemplateContainer",function(a,b,c,d,e,f,g,h){return{restrict:"E",scope:{dataModelProvider:"=?datamodelprovider",componentProvider:"=?componentprovider",rendererProvider:"=?rendererprovider",selectionProvider:"=?selectionprovider",value:"=",varName:"@var",style:"@",className:"@class",lookId:"@lookid",caption:"@",tabIndex:"@tabindex",id:"@",selection:"=?",cursor:"=?",columnCursor:"=?columncursor",first:"=?",rows:"=?",rowCount:"=?rowcount",selectable:"@",selectionCardinality:"@selectioncardinality"},controller:["$scope",function(a){var b=a.componentProvider;if(!b){var c=a.componentProviderName||g;b=f.LoadProvider(c)}this.componentProvider=b,a.columns=[],this.appendColumn=function(b){a.columns.push(b)},this.getColumnIndex=function(){return a.columns.length},a.groupProviders=[],this.appendGroupProvider=function(b){a.groupProviders.push(b)},this.getProviderIndex=function(){return a.groupProviders.length}}],compile:function(){return{pre:function(a,c,d,e){a.rowClassRawExpression=c.attr("rowClass");var f=new e.componentProvider.DataGrid(a,c,b);e.dataGrid=f,h.MarkTemplateContainer(a,c)},post:function(b,g,i,j){h.RegisterTemplates(b);var k=j.dataGrid,l=a.invoke(k.construct,k);f.isPromise(l)||(l=d.when(l)),l.then(function(a){c.info("Table created ",a),g.replaceWith(a)},function(a){a instanceof Error?e(a):c.error("Failed to create table ",a)})}}}}}]),c.directive("cmDatacolumn",["camelia.core","camelia.directives.TemplateContainer",function(a,c){return{require:"^cmDatagrid",restrict:"E",replace:!0,scope:{id:"@",visible:"@",titleAlign:"@titlealign",cellAlign:"@cellalign",width:"@",maxWidth:"@maxwidth",minWidth:"@minwidth",title:"@",cellClass:"@",columnClass:"@",sorter:"@",resizeable:"@",checkable:"@",fieldName:"@fieldname",checkList:"=?",columnImageURL:"@columnimageurl",cellImageURL:"@cellimageurl",criteriaValue:"@criteriavalue",watched:"@",editable:"@"},controller:function(){this.criterias=[]},compile:function(){return{pre:function(a,b){a.valueRawExpression=b.attr("text")||b.attr("value"),c.MarkTemplateContainer(a,b)},post:function(a,d,e,f){if(c.RegisterTemplates(a),a.fieldName&&/[^\w]/.test(a.fieldName))throw new Error("Invalid fieldName expression '"+a.fieldName+"' use value='{{"+a.fieldName+"}}' instead !");var g=d.controller("cmDatacolumn"),h=new f.componentProvider.DataColumn(a,f.getColumnIndex()+1);b.forEach(g.criterias,function(a){h.addCriteria(a)}),f.appendColumn(h)}}}}}]),c.directive("cmDatagroup",["camelia.core","camelia.directives.TemplateContainer",function(a,b){return{require:"^cmDatagrid",restrict:"E",scope:{title:"@",value:"@",closeable:"@",disabled:"@",collapsedGroups:"=?collapsedgroups",className:"@class",sorter:"@"},compile:function(){return{pre:function(a,c){a.titleRawExpression=c.attr("title"),a.titleClassRawExpression=c.attr("titleclass"),a.valueRawExpression=c.attr("value"),b.MarkTemplateContainer(a,c)},post:function(a,c,d,e){b.RegisterTemplates(a);var f=new e.componentProvider.DataGroup(a,e.getProviderIndex()+1);e.appendGroupProvider(f)}}}}}]),c.directive("cmCriteria",["camelia.core","$log","$injector","camelia.directives.TemplateContainer",function(a,c,d,e){return{require:"^cmDatacolumn",restrict:"E",scope:{type:"@"},compile:function(){return{pre:function(a,b){e.MarkTemplateContainer(a,b)},post:function(a,f,g,h){e.RegisterTemplates(a);var i=a.type;if(!b.isString(i)||!i.length)throw new Error("Invalid criteria type ("+i+")");var j,k=i.indexOf(".");j=k>=0?i:"camelia.criteria."+i;var l=h.criterias;try{d.invoke([j,function(b){var c=new b(a,f,g);l.push(c)}])}catch(m){c.error("Can not instantiate criteria '"+j+"'",m)}}}}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.directives.items",["camelia.components.items"]);c.factory("camelia.directives.ItemsContainer",[function(){return{MarkItemsContainer:function(a,b){b.data("$cmItemsContainerController",a)}}}]),c.directive("cmItem",["$log","camelia.components.Item",function(a,b){return{restrict:"E",require:"^cmItemsContainer",scope:{label:"@",id:"@",className:"@class",value:"=",disabled:"@",tooltip:"@",searchWords:"@",visible:"@"},compile:function(){return{pre:function(){},post:function(a,c,d,e,f){new b(a,c,e,f);c.remove()}}}}}]),c.directive("cmItems",["$log","camelia.components.Items",function(a,b){return{restrict:"E",require:"^cmItemsContainer",scope:{id:"@",value:"=",varName:"@var",itemColumn:"@itemcolumn",visible:"@"},compile:function(){return{pre:function(a,b){["itemLabel","itemClass","itemDisabed","itemTooltip","itemSearchWords"].forEach(function(c){a[c+"RawExpression"]=b.attr(c)})},post:function(a,c,d,e,f){new b(a,c,e,f);c.remove()}}}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.directives.pager",["camelia.core","camelia.directives.template","camelia.components.pager"]);c.value("cm_pager_componentProviderName","camelia.components.pager:camelia.components.Pager"),c.directive("cmPager",["$injector","$interpolate","$log","$q","$exceptionHandler","camelia.core","cm_pager_componentProviderName","camelia.directives.TemplateContainer",function(a,b,c,d,e,f,g,h){return{restrict:"E",scope:{forElementId:"@for",target:"=?",style:"@",className:"@class",lookId:"@",caption:"@",tabIndex:"@",id:"@",format:"=?"},controller:["$scope",function(a){var b=a.componentProvider;if(!b){var c=a.componentProviderName||g;b=f.LoadProvider(c)}this.componentProvider=b}],compile:function(){return{pre:function(a,b){h.MarkTemplateContainer(a,b)},post:function(b,g,i,j){h.RegisterTemplates(b);var k=new j.componentProvider(b,g),l=a.invoke(k.construct,k);f.isPromise(l)||(l=d.when(l)),l.then(function(a){c.info("Pager created ",a),g.replaceWith(a)},function(a){a instanceof Error?e(a):c.error("Failed to create pager ",a)})}}}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.directives.template",["camelia.components.template","camelia.templateRegistry"]);c.factory("camelia.directives.TemplateContainer",["camelia.TemplateRegistry",function(a){return{MarkTemplateContainer:function(a,b){b.data("$cmTemplateContainerController",a)},RegisterTemplates:function(b){a.RegisterTemplates(b)}}}]),c.directive("cmTemplate",["$log","camelia.components.Template",function(a,b){return{require:"^cmTemplateContainer",restrict:"E",scope:{name:"@",id:"@",refId:"@"},transclude:!0,compile:function(){return{pre:function(a,b){a.enabledExpresion=b.attr("enabled")},post:function(a,c,d,e,f){new b(a,c,e,f);c.remove()}}}}}])}(window,window.angular),function(a,b){"use strict";b.module("camelia.animations.grid",["camelia.animations","camelia.i18n.grid"])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.animations",["camelia.core"]);d.factory("camelia.animations.Animation",["$log","$timeout","$rootScope","$q","camelia.core","camelia.ScopeWrapper",function(a,b,d,e,f,g){function h(a,b){g.call(this,a.$new(!0)),this._params=b;var c=this;this.$on("$destroy",function(){c._destroyed||(c._destroyed=!0,c._processDestroy())})}return h.newInstance=function(a,b,c){var d=f.LoadProvider(a);if(!d)throw new Error("Can not find animation '"+a+"'");return new d(b,c)},f.extend(h,g,{start:function(){if(this._timeout){var a=this;this._showTimerPromise=b(function(){a.end("timeout")},this._timeout,!1)}var c=this._processStart();return f.isPromise(c)?c:e.when(c)},_processStart:function(){return e.when(!1)},cancel:function(){if(!this.canceled&&!this.ended){this.canceled=!0;var a=this._showTimerPromise;a&&(this._showTimerPromise=null,b.cancel(a)),this._processCancel()}},_processCancel:function(){this._destroy()},end:function(a){if(!this.ended&&!this.canceled){this.ended=!0;var c=this._showTimerPromise;c&&(this._showTimerPromise=null,b.cancel(c));var d=this._processEnd(a);return f.isPromise(d)?d:e.when(d)}},_processEnd:function(){return this._destroy(),e.when(!1)},_destroy:function(){this._params=c;var a=this._showTimerPromise;a&&b.cancel(a);var d=this;b(function(){d.$destroy()},0,!1)},_processDestroy:function(){this._params=c;var a=this._showTimerPromise;a&&b.cancel(a)},toString:function(){return"[Animation $id="+this.$scope.$id+"]"}}),h}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("camelia.animations.grid"),e=500;d.value("cm_grid_pageChange_timeout",e),d.factory("camelia.animations.grid.PageChange",["$log","$timeout","$q","camelia.animations.Animation","camelia.core","camelia.i18n.Grid","cm_grid_pageChange_timeout",function(a,d,f,g,h,i,j){function k(a,b){g.call(this,a,b),h.Assert(b,"PageChange must define params !");var c=this,d=this.$on("cm:tableViewPortCreated",function(a,b){d(),c._newTableViewPort=b.newTableViewPort;var e=c._params.oldTableViewPort;e&&(e.style.visibility="hidden")});this.$on("cm:dataLoaded",function(a,b){c._dataLoaded=b});var e=this.$on("cm:pageError",function(){e()})}var l=0;return h.extend(k,g,{showErrorPage:function(a){this._clearPage();var b=this;return this._showErrorPage(a).then(function(a){return g.prototype._processEnd.call(b).then(function(){return a})})},_processStart:function(){var a=this._params.renderer,b=a.container,c=b.style.height;if(!c||"auto"===c){this._forceHeight=!0;var f=b.getBoundingClientRect();b.style.height=f.height+"px"}var g=this;this._showLoadingPagePromise=d(function h(){return g._newTableViewPort?void g._showWaitingPage().then(function(a){g._waitingPage=a}):(g._showLoadingPagePromise=d(h,1e3,!1),g._showLoadingPagePromise)},j||e,!1)},_showWaitingPage:function(){a.debug("Show waiting page !!!!");var c=b.element(document.createDocumentFragment()),e=this;return this._renderWaitingPage(c).then(function(a){a[0]&&(a=a[0]),a.cm_type="gridWaitingPage",e._setPageSize(a);var f=e._params.renderer;return b.element(f.bodyContainer).append(c),d(function(){a.setAttribute("cm_shown",!0)},100,!1),a})},_renderWaitingPage:function(a){var c=h.createElement(a,"div",{id:"cm_grid_waitingPage_"+l++,className:"cm_grid_waitingPage"}),d=(h.createElement(c,"span",{className:"cm_grid_waitingCircle fa fa-circle-o-notch fa-spin fa-2x "}),h.createElement(c,"label",{textnode:h.lang(i,"loadingData")}));return this._dataLoaded&&b.element(d).text(h.lang(i,"receivingData",{count:this._dataLoaded.count})),this.$on("cm:dataLoaded",function(a,c){b.element(d).text(h.lang(i,"receivingData",{count:c.count}))}),f.when(c)},_showErrorPage:function(c){a.debug("Show error page !!!!");var d=b.element(document.createDocumentFragment()),e=this;return this._renderErrorPage(d,c).then(function(a){a[0]&&(a=a[0]),a.cm_type="gridErrorPage",e._setPageSize(a);var c=e._params.renderer;return b.element(c.bodyContainer).append(d),a})},_setPageSize:function(a){var b=this._params.renderer,c=b.titleViewPort.getBoundingClientRect(),d=b.container.getBoundingClientRect(),e=a.style;e.height=d.height-c.height-2+"px"},_renderErrorPage:function(b){a.debug("Show error page !!!!");{var c=h.createElement(b,"div",{id:"cm_grid_errorPage_"+l++,className:"cm_grid_errorPage"});h.createElement(c,"span",{className:"cm_grid_errorIcon fa fa-exclamation-triangle fa-2x "}),h.createElement(c,"label",{textnode:h.lang(i,"loadingError")})}return f.when(c)},_clearPage:function(){var a=this._params.oldTableViewPort;a&&b.element(a).remove();var e=this._params.oldErrorPage;e&&b.element(e).remove();var f=this._showLoadingPagePromise;f&&(this._showLoadingPagePromise=c,d.cancel(f));var g=this._waitingPage;g&&(this._waitingPage=c,b.element(g).remove())},_processEnd:function(){var c=this;this._clearPage();var e=this._newTableViewPort,f=e;f.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&(e=f.firstChild);var h=this._params.renderer;b.element(h.bodyContainer).append(f),h.tableElement.style.tableLayout="fixed",e.style.visibility="hidden";var i=20;return d(function j(){var b=e.getBoundingClientRect();if(!b.width){if(--i>0)return d(j,50,!1);a.error("Timeout when getting size of newTableViewPort")}if(c._forceHeight)h.container.style.height="auto",h.bodyContainer.style.height="auto";else{var f=h.titleViewPort.getBoundingClientRect(),k=h.container.getBoundingClientRect(),l=Math.floor(k.height-f.height)-1;e.style.height=l+"px",h.bodyContainer.style.height=l+"px"}return e.style.visibility="visible",g.prototype._processEnd.call(c).then(function(){return e})},10,!1)}}),k}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.combo",[]);c.factory("camelia.i18n.Combo",[function(){return{en:{no_result:"No result"}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.combo");c.config(["$provide",function(a){a.decorator("camelia.i18n.Combo",["$delegate",function(a){return b.extend(a,{fr:{no_result:"Aucun résultat"}})}])}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.criteria",[]);c.factory("camelia.i18n.Criteria",[function(){return{en:{alphabetic_others:"Others"}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.criteria");c.config(["$provide",function(a){a.decorator("camelia.i18n.Criteria",["$delegate",function(a){return b.extend(a,{fr:{alphabetic_others:"Autres"}})}])}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.grid",[]);c.factory("camelia.i18n.Grid",[function(){return{en:{sortableColumn:"(Sortable)",ascending:"(Sorted order ascending)",descending:"(Sorted order descending)",filtreableColumn:"",filtredColumn:"(Filtred)",loadingData:"Loading data ...",receivingData:"{count} rows received ...",loadingError:"Loading error",criteriaList:"Filters list of column {title} :"}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.grid");c.config(["$provide",function(a){a.decorator("camelia.i18n.Grid",["$delegate",function(a){return b.extend(a,{fr:{sortableColumn:"(Triable)",ascending:"(Trié ordre croissant)",descending:"(Trié ordre decroissant)",filtreableColumn:"",filtredColumn:"(Filtrée)",loadingData:"Chargement des données ...",receivingData:"{count} lignes reçues ...",loadingError:"Erreur de chargement",criteriaList:"Liste des filtres de la colonne {title} :"}})}])}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.items",[]);c.factory("camelia.i18n.Items",[function(){return{en:{searching:"Searching ..."}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.items");c.config(["$provide",function(a){a.decorator("camelia.i18n.Items",["$delegate",function(a){return b.extend(a,{fr:{searching:"Recherche en cours ..."}})}])}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.pager",[]);c.factory("camelia.i18n.Pager",[function(){return{en:{bfirst_label:"First",blast_label:"Last",bprev_label:"",bprev_className:"fa fa-angle-left",bprev_tooltip:"Show previous page",bnext_label:"",bnext_className:"fa fa-angle-right",bnext_tooltip:"Show next page",index_label:"{pageIndex}",index_tooltip:"Show page #{pageIndex}",cindex_label:"{pageIndex}",cindex_tooltip:"Current page #{pageIndex}",uindex_label:"...",uindex_tooltip:"Show next page",separator:" ",noPages:"No pages"}}
}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.pager");c.config(["$provide",function(a){a.decorator("camelia.i18n.Pager",["$delegate",function(a){return b.extend(a,{fr:{bfirst_label:"Premier",blast_label:"Dernier",bprev_label:"",bprev_className:"fa fa-angle-left",bprev_tooltip:"Voir la page précédente",bnext_label:"",bnext_className:"fa fa-angle-right",bnext_tooltip:"Voir la page suivante",index_label:"{pageIndex}",index_tooltip:"Voir page #{pageIndex}",cindex_label:"{pageIndex}",cindex_tooltip:"Page courrante #{pageIndex}",uindex_label:"...",uindex_tooltip:"Voir la page suivante",separator:" ",noPages:"Aucune page"}})}])}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.progressMonitor",[]);c.factory("camelia.i18n.ProgressMonitor",[function(){return{en:{canceled:"Canceled task",done:"Finished task"}}}])}(window,window.angular),function(a,b){"use strict";var c=b.module("camelia.i18n.progressMonitor");c.config(["$provide",function(a){a.decorator("camelia.i18n.ProgressMonitor",["$delegate",function(a){return b.extend(a,{fr:{canceled:"Tâche annulée",done:"Tâche finie"}})}])}])}(window,window.angular);
//# sourceMappingURL=dist/camelia.min.js.map